---
id: E06-F04-T02
title: Selection Status Display
type: Task
priority: P0 (MVP)
status: Draft
parent: E06-F04
created: 2025-12-26
estimated_hours: 2
actual_hours:
effort: Small
tags:
  - ui
  - statusbar
  - selection
---

# Spec: E06-F04-T02 - Selection Status Display

## 1. Overview

### 1.1 Problem Statement

Users need immediate visual feedback about how many objects are currently selected during multi-select operations. The status bar should display the current selection count and update automatically whenever the selection changes.

### 1.2 Goals

- Display current selection count in status bar
- Update selection count in real-time when selection changes
- Show "Selected: 0" when nothing is selected
- Connect to selection service for automatic updates
- Ensure updates occur with minimal latency (<100ms)

---

## 2. Technical Requirements

### 2.1 Status Update Method

**File**: `src/ink/presentation/main_window.py`

```python
def update_selection_status(self, count: int):
    """Update selection count in status bar.

    Args:
        count: Number of currently selected objects
    """
    self.selection_label.setText(f"Selected: {count}")
```

### 2.2 Signal Connection

```python
def _connect_status_signals(self):
    """Connect signals to status bar update methods."""
    # Selection changes from selection service
    if hasattr(self, 'selection_service'):
        self.selection_service.selection_changed.connect(
            lambda items: self.update_selection_status(len(items))
        )
```

### 2.3 Selection Count Logic

| Scenario | Display | Count Source |
|----------|---------|--------------|
| No selection | "Selected: 0" | Empty selection set |
| Single cell | "Selected: 1" | 1 cell in selection |
| Multiple cells | "Selected: N" | N cells in selection |
| Mixed objects | "Selected: N" | Total count (cells + nets + pins) |

### 2.4 Update Triggers

- Single-click selection on canvas item
- Multi-select via Ctrl+Click
- Box selection (drag select)
- Select All (Ctrl+A)
- Deselect All (Esc or click empty area)
- Selection cleared (file close, new file load)

---

## 3. Dependencies

- **Upstream**:
  - E06-F04-T01 (Status Bar Setup - `selection_label` widget exists)
  - E04-F01 (Selection Service - `selection_changed` signal)
- **Downstream**: None
- **External**: PySide6 signals/slots

---

## 4. Acceptance Criteria

- [ ] `update_selection_status()` method implemented
- [ ] Method updates `selection_label` text with format "Selected: N"
- [ ] Signal connected to selection service `selection_changed`
- [ ] Selection count updates immediately on selection change
- [ ] Count shows 0 when nothing selected
- [ ] Count shows correct number for single and multi-select
- [ ] Status updates within 100ms of selection change
- [ ] No errors when selection service not yet initialized
- [ ] Unit tests verify correct text formatting
- [ ] Integration tests verify signal connection

---

## 5. Testing Strategy

### 5.1 Manual Testing

```python
# Test checklist:
# 1. Launch app with sample .ckt file
# 2. Verify "Selected: 0" shown initially
# 3. Click on a cell - verify "Selected: 1"
# 4. Ctrl+Click another cell - verify "Selected: 2"
# 5. Click empty area - verify "Selected: 0"
# 6. Box select multiple cells - verify correct count
# 7. Press Ctrl+A - verify total cell count
# 8. Press Esc - verify "Selected: 0"
```

### 5.2 Unit Tests

```python
# tests/unit/presentation/test_main_window_selection_status.py

def test_update_selection_status_zero(main_window):
    """Selection status should show 0 for empty selection."""
    main_window.update_selection_status(0)
    assert main_window.selection_label.text() == "Selected: 0"

def test_update_selection_status_single(main_window):
    """Selection status should show 1 for single selection."""
    main_window.update_selection_status(1)
    assert main_window.selection_label.text() == "Selected: 1"

def test_update_selection_status_multiple(main_window):
    """Selection status should show correct count for multiple selections."""
    main_window.update_selection_status(5)
    assert main_window.selection_label.text() == "Selected: 5"

    main_window.update_selection_status(42)
    assert main_window.selection_label.text() == "Selected: 42"
```

### 5.3 Integration Tests

```python
# tests/integration/presentation/test_selection_status_integration.py

def test_selection_signal_updates_status(main_window, selection_service):
    """Selection changes should trigger status update."""
    # Emit selection changed signal with 3 items
    mock_items = [Mock(), Mock(), Mock()]
    selection_service.selection_changed.emit(mock_items)

    # Status should update
    assert main_window.selection_label.text() == "Selected: 3"

def test_selection_cleared_updates_status(main_window, selection_service):
    """Clearing selection should show 0."""
    # Set initial selection
    selection_service.selection_changed.emit([Mock(), Mock()])
    assert main_window.selection_label.text() == "Selected: 2"

    # Clear selection
    selection_service.selection_changed.emit([])
    assert main_window.selection_label.text() == "Selected: 0"
```

---

## 6. Implementation Checklist

- [ ] Implement `update_selection_status(count: int)` method
- [ ] Add `_connect_status_signals()` method (or extend existing)
- [ ] Connect `selection_service.selection_changed` signal
- [ ] Handle case where selection_service not yet initialized
- [ ] Call `_connect_status_signals()` in `__init__()` after services setup
- [ ] Write unit tests for status update method
- [ ] Write integration tests for signal connection
- [ ] Test with various selection scenarios
- [ ] Verify update latency is acceptable
- [ ] Document any edge cases or limitations

---

## 7. Edge Cases

| Edge Case | Behavior |
|-----------|----------|
| Selection service not initialized | Skip signal connection, no errors |
| Rapid selection changes | Only show final count (Qt coalesces signals) |
| Large selection (1000+ items) | Display count normally, no performance impact |
| Selection during file load | Clear to 0 when new file loaded |
| Invalid count (negative) | Display as-is (trust signal source) |

---

## Revision History

| Date | Version | Author | Changes |
|------|---------|--------|---------|
| 2025-12-26 | 0.1 | Claude | Initial task creation from E06-F04 split |
