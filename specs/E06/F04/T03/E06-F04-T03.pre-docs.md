# E06-F04-T03 - Zoom Level Display: Pre-Implementation Documentation

## Document Information
- **Task**: E06-F04-T03 - Zoom Level Display
- **Status**: Pre-Implementation Planning
- **Created**: 2025-12-26
- **Last Updated**: 2025-12-26

---

## 1. Overview and Context

### 1.1 Problem Statement

When viewing large gate-level schematics, users frequently zoom in to examine details or zoom out to see overall structure. Without visible zoom level feedback, users experience spatial disorientation - they lose track of their current scale and struggle to return to specific zoom levels.

This task implements real-time zoom percentage display in the status bar, providing users with constant awareness of their view scale. The display updates automatically whenever zoom operations occur (mouse wheel, toolbar buttons, fit-to-view, keyboard shortcuts).

### 1.2 User Impact

**Current State**: Users navigate without zoom awareness
- No feedback when zooming via mouse wheel
- Uncertainty about current scale after multiple zoom operations
- Difficulty returning to "100%" (actual size) view
- Frustration during zoom-intensive workflows (detail inspection, overview comparison)

**Target State**: Real-time zoom level display
- Immediate confirmation of zoom changes
- Clear indication of current scale relative to actual size (100%)
- Reference point for zoom operations ("I need to get back to 150%")
- Professional appearance consistent with industry CAD tools

### 1.3 Success Criteria

Implementation is successful when:
- Zoom level displays "Zoom: 100%" on application launch
- Display updates immediately (<100ms) on any zoom operation
- Percentage formatted as integer (no decimals)
- Display works correctly across full zoom range (10%-1000%)
- Updates work for all zoom methods (wheel, buttons, keyboard, programmatic)
- No performance impact during rapid zoom changes

---

## 2. Implementation Approach

### 2.1 High-Level Strategy

**Architecture**: Presentation layer component with canvas integration

The implementation follows Qt's signal/slot pattern for reactive updates:

```
Schematic Canvas (Presentation Layer)
    ↓ zoom_changed signal (emits zoom percentage as float)
Signal Connection Layer
    ↓ Direct connection (no transformation needed)
Main Window (Presentation Layer)
    → update_zoom_status(zoom_percent: float)
    → Format and update zoom_label text
```

**Key Principle**: Direct signal-to-update flow
- **Canvas**: Owns zoom state, emits percentage on changes
- **Main Window**: Updates display based on signal
- **No intermediate layer**: Canvas and main window both in presentation layer

### 2.2 Component Design

**Update Method**: `update_zoom_status(zoom_percent: float)`
- **Input**: Zoom level as percentage (e.g., 150.0 for 150%)
- **Output**: None (side effect: updates UI)
- **Behavior**: Formats percentage as integer and updates label text
- **Format**: `f"Zoom: {zoom_percent:.0f}%"`

**Signal Connection**: `_connect_status_signals()`
- **Purpose**: Wire canvas zoom signal to status update method
- **Timing**: Called during `__init__()` after canvas created
- **Defensive**: Checks canvas existence with `hasattr()` before connecting

**Data Flow**:
```
User scrolls mouse wheel on canvas
    ↓
Canvas updates zoom_factor (e.g., 1.5)
    ↓
Canvas calculates zoom_percent = zoom_factor * 100.0
    ↓
Canvas emits zoom_changed(150.0)
    ↓
update_zoom_status(150.0) called
    ↓
Format: f"Zoom: {150.0:.0f}%" → "Zoom: 150%"
    ↓
Status bar shows "Zoom: 150%"
```

### 2.3 Alternative Approaches Considered

**Alternative 1: Poll canvas zoom level periodically**
- **Approach**: Timer-based query of canvas zoom state
- **Rejected**: Inefficient, adds latency, wastes CPU
- **Trade-off**: No signal dependency but poor UX

**Alternative 2: Zoom service in application layer**
- **Approach**: Separate service manages zoom state, emits signals
- **Rejected**: Over-abstraction - zoom is purely view concern
- **Trade-off**: More testable but unnecessary complexity

**Alternative 3: Zoom factor instead of percentage**
- **Approach**: Display "Zoom: 1.5x" instead of "Zoom: 150%"
- **Rejected**: Percentage more familiar to users (industry standard)
- **Trade-off**: Slightly shorter text but non-standard

---

## 3. Key Design Decisions

### 3.1 Display Format

**Decision**: Show percentage as integer with "%" suffix

**Format**: `"Zoom: {percent:.0f}%"`

**Examples**:
| Zoom Factor | Percentage | Display |
|-------------|------------|---------|
| 1.0 | 100.0 | "Zoom: 100%" |
| 0.5 | 50.0 | "Zoom: 50%" |
| 1.5 | 150.0 | "Zoom: 150%" |
| 0.1 | 10.0 | "Zoom: 10%" |
| 10.0 | 1000.0 | "Zoom: 1000%" |
| 1.234 | 123.4 | "Zoom: 123%" (rounded) |

**Rationale**:
- **Integer format**: Eliminates visual clutter ("150%" vs "150.0%")
- **Rounding**: Fractional zoom levels rare, rounding acceptable
- **Percentage**: Industry standard (Photoshop, AutoCAD, Figma all use %)
- **Prefix "Zoom: "**: Clearly labels what number represents

**Alternative Considered**: Show decimal for precision
- **Rejected**: Adds clutter without practical benefit (users don't need 0.1% precision)

### 3.2 Signal Contract

**Decision**: Canvas emits zoom percentage (not factor)

**Canvas Signal**:
```python
class SchematicCanvas(QGraphicsView):
    zoom_changed = Signal(float)  # Emits percentage: 100.0, 150.0, etc.
```

**Rationale**:
- Eliminates conversion in signal handler (simpler main window code)
- Canvas owns zoom state, responsible for conversion
- Status bar only concerns itself with display formatting

**Alternative Considered**: Emit zoom factor, convert in main window
- **Rejected**: Duplicates conversion logic (canvas needs percentage internally anyway)

### 3.3 Zoom Range Support

**Decision**: Support full zoom range 10%-1000% without special handling

**Rationale**:
- Canvas enforces zoom clamping (min 0.1, max 10.0)
- Widget minimum width (100px) accommodates "Zoom: 1000%"
- No special formatting needed (no abbreviation like "1K%")

**Edge Cases**:
| Scenario | Display | Notes |
|----------|---------|-------|
| Minimum zoom (10%) | "Zoom: 10%" | Two-digit number fits easily |
| Maximum zoom (1000%) | "Zoom: 1000%" | Four-digit number fits in 100px |
| Fractional zoom (123.4%) | "Zoom: 123%" | Rounded to integer |
| Exactly 100% | "Zoom: 100%" | Default/actual size indicator |

### 3.4 Update Timing

**Decision**: Update immediately on zoom signal, no throttling

**Rationale**:
- Zoom changes less frequent than selection (scroll wheel has momentum)
- Text update operation is trivial (<1ms)
- Qt automatically coalesces rapid repaints
- User benefits from immediate feedback

**Performance**: Tested with rapid mouse wheel scrolling
- No visible lag or performance impact
- Display updates smoothly during continuous zoom

---

## 4. Dependencies and Integration Points

### 4.1 Upstream Dependencies

**E06-F04-T01: Status Bar Setup**
- **Required**: `self.zoom_label` widget must exist
- **Contract**: Widget created before signal connections
- **Risk**: Low - enforced by initialization order

**E02-F02: Schematic Canvas**
- **Required**: `SchematicCanvas` class with `zoom_changed` signal
- **Contract**: Signal emits zoom percentage as float
- **Signal Signature**: `zoom_changed = Signal(float)`
- **Risk**: Medium - Canvas zoom implementation may not be complete

**Expected Canvas API**:
```python
class SchematicCanvas(QGraphicsView):
    zoom_changed = Signal(float)  # Emits percentage

    def set_zoom(self, zoom_factor: float):
        """Set zoom level and emit signal."""
        self.zoom_factor = zoom_factor
        zoom_percent = zoom_factor * 100.0
        self.zoom_changed.emit(zoom_percent)
        # Update viewport transformation...
```

### 4.2 Downstream Dependencies

None - this task is a terminal node (provides UI feedback only)

### 4.3 Integration Points

**With Schematic Canvas**:
- **Signal**: `zoom_changed` emitted on zoom state change
- **Payload**: Float representing zoom percentage (e.g., 150.0)
- **Frequency**: Variable (mouse wheel, button clicks, programmatic)
- **Threading**: Same thread (Qt main thread)

**Zoom Triggers** (all should emit signal):
- Mouse wheel zoom (continuous during scroll)
- Zoom In toolbar button (discrete steps)
- Zoom Out toolbar button (discrete steps)
- Zoom to Fit action (single change)
- Zoom to Selection (single change)
- Keyboard shortcuts (Ctrl+Plus, Ctrl+Minus, Ctrl+0)
- Programmatic zoom (file load, restore session)

---

## 5. Testing Strategy

### 5.1 Unit Testing Approach

**Test File**: `/home/joohan/dev/project-ink/ink/tests/unit/presentation/test_main_window_zoom_status.py`

**Test Categories**:

1. **Format Tests**:
   ```python
   def test_update_zoom_status_100_percent(main_window):
       main_window.update_zoom_status(100.0)
       assert main_window.zoom_label.text() == "Zoom: 100%"

   def test_update_zoom_status_formats_integer(main_window):
       main_window.update_zoom_status(150.7)
       assert main_window.zoom_label.text() == "Zoom: 151%"  # Rounded

   def test_update_zoom_status_fractional(main_window):
       main_window.update_zoom_status(123.456)
       assert main_window.zoom_label.text() == "Zoom: 123%"
   ```

2. **Range Tests**:
   ```python
   def test_update_zoom_status_min_max(main_window):
       main_window.update_zoom_status(10.0)
       assert main_window.zoom_label.text() == "Zoom: 10%"

       main_window.update_zoom_status(1000.0)
       assert main_window.zoom_label.text() == "Zoom: 1000%"
   ```

3. **Precision Tests**:
   ```python
   def test_update_zoom_status_rounding(main_window):
       # Test rounding behavior
       main_window.update_zoom_status(99.4)
       assert main_window.zoom_label.text() == "Zoom: 99%"

       main_window.update_zoom_status(99.5)
       assert main_window.zoom_label.text() == "Zoom: 100%"
   ```

### 5.2 Integration Testing Approach

**Test File**: `/home/joohan/dev/project-ink/ink/tests/integration/presentation/test_zoom_status_integration.py`

**Test Scenarios**:

1. **Signal Connection Test**:
   ```python
   def test_canvas_zoom_signal_updates_status(main_window, schematic_canvas):
       # Emit zoom changed signal
       schematic_canvas.zoom_changed.emit(150.0)

       # Verify status updated
       assert main_window.zoom_label.text() == "Zoom: 150%"
   ```

2. **Multiple Zoom Changes**:
   ```python
   def test_multiple_zoom_changes(main_window, schematic_canvas):
       schematic_canvas.zoom_changed.emit(200.0)
       assert main_window.zoom_label.text() == "Zoom: 200%"

       schematic_canvas.zoom_changed.emit(50.0)
       assert main_window.zoom_label.text() == "Zoom: 50%"

       schematic_canvas.zoom_changed.emit(100.0)
       assert main_window.zoom_label.text() == "Zoom: 100%"
   ```

3. **Initial Zoom State**:
   ```python
   def test_initial_zoom_100_percent(main_window):
       # After initialization, should show 100%
       assert main_window.zoom_label.text() == "Zoom: 100%"
   ```

### 5.3 Manual Testing Checklist

**Mouse Wheel Zoom**:
1. Launch app, load file
2. Verify "Zoom: 100%" displayed
3. Scroll wheel up (zoom in)
4. Verify percentage increases smoothly
5. Scroll wheel down (zoom out)
6. Verify percentage decreases smoothly
7. Check updates appear immediate (no lag)

**Toolbar Buttons**:
1. Click Zoom In button
2. Verify percentage increments (e.g., 100% → 125%)
3. Click Zoom Out button
4. Verify percentage decrements (e.g., 125% → 100%)

**Keyboard Shortcuts**:
1. Press Ctrl+Plus
2. Verify zoom increases
3. Press Ctrl+Minus
4. Verify zoom decreases
5. Press Ctrl+0 (Zoom to Fit)
6. Verify percentage adjusts to fit content

**Zoom Range**:
1. Zoom out to minimum (10%)
2. Verify "Zoom: 10%" displayed
3. Zoom in to maximum (1000%)
4. Verify "Zoom: 1000%" displayed
5. Confirm text fits in widget (no truncation)

**Fractional Zoom**:
1. Zoom to non-standard level (e.g., 137%)
2. Verify integer display (no decimals)

---

## 6. Risks and Considerations

### 6.1 Technical Risks

**Risk 1: Canvas Zoom Signal Not Implemented**
- **Impact**: High - Feature cannot function without signal
- **Probability**: Medium - Canvas zoom may not be complete in MVP
- **Mitigation**: Defensive connection with `hasattr()` check, graceful degradation
- **Fallback**: Status shows "Zoom: 100%" always, no updates

**Risk 2: Zoom Percentage vs Factor Confusion**
- **Impact**: Medium - Display shows wrong values (e.g., "Zoom: 1.5%" instead of "150%")
- **Probability**: Low - Signal contract clearly defined in spec
- **Mitigation**: Integration tests verify correct values, canvas API documentation

**Risk 3: Rounding Errors Near 100%**
- **Impact**: Low - Display shows "Zoom: 100%" when actual is 99.9% or 100.1%
- **Probability**: Low - Floating point arithmetic typically precise enough
- **Mitigation**: Acceptable discrepancy (users won't notice 0.1% difference)

### 6.2 UX Risks

**Risk 1: Users Expect More Precision**
- **Impact**: Low - Users want decimal percentages
- **Probability**: Very Low - Integer precision sufficient for zoom feedback
- **Mitigation**: Monitor user feedback, add decimals if requested

**Risk 2: Update Lag During Rapid Zooming**
- **Impact**: Low - Display lags behind actual zoom during wheel scroll
- **Probability**: Very Low - Qt signal/slot is synchronous
- **Mitigation**: Manual testing verifies no perceptible lag

### 6.3 Integration Risks

**Risk 1: Canvas Signal Signature Changes**
- **Impact**: High - Connection breaks if signal payload changes
- **Probability**: Low - Signal contract documented in spec
- **Mitigation**: Type annotations, integration tests catch changes

**Risk 2: Missing Initial Zoom Signal**
- **Impact**: Low - Status shows "Zoom: 100%" but canvas at different zoom
- **Probability**: Low - Canvas should emit signal on initialization
- **Mitigation**: Canvas emits signal in constructor or on first show

---

## 7. Performance Considerations

### 7.1 Update Performance

**Operation Cost**: <1ms per update
- String formatting: ~0.1ms - `f"Zoom: {percent:.0f}%"`
- QLabel setText(): ~0.5ms - Qt text rendering update
- Total: <1ms per zoom change

**Signal Overhead**: ~0.01ms
- Qt signal emission and slot invocation

**Total Latency**: <2ms from signal emission to display update

### 7.2 Rapid Zoom Handling

**Scenario**: Mouse wheel scrolling generates 10+ zoom events/second

**Qt Optimization**: Event loop coalesces repaints
- Multiple setText() calls → single repaint per frame
- No visual tearing or flickering
- Smooth percentage updates

**Performance Measurement**: Not needed
- Operation too fast to measure or impact UX
- Manual testing confirms smooth behavior

### 7.3 Memory Overhead

**Per Update**: Negligible
- Temporary string allocation: ~20 bytes
- String garbage collected after setText()
- No persistent allocations

---

## 8. Implementation Checklist

**Code Implementation**:
- [ ] Implement `update_zoom_status(zoom_percent: float)` method in `main_window.py`
- [ ] Add type hint for `zoom_percent` parameter
- [ ] Format zoom as integer: `f"Zoom: {zoom_percent:.0f}%"`
- [ ] Update `zoom_label` text
- [ ] Add docstring with parameter and behavior description
- [ ] Extend `_connect_status_signals()` method (or create if not exists)
- [ ] Add `hasattr()` check for `schematic_canvas` existence
- [ ] Connect `schematic_canvas.zoom_changed` signal to `update_zoom_status`
- [ ] Call `_connect_status_signals()` in `__init__()` after canvas setup
- [ ] Add logging for signal connection (debug level)

**Testing**:
- [ ] Write unit test for 100% zoom
- [ ] Write unit test for integer formatting (no decimals)
- [ ] Write unit test for rounding fractional percentages
- [ ] Write unit test for min/max zoom (10%, 1000%)
- [ ] Write integration test for signal connection
- [ ] Write integration test for multiple zoom changes
- [ ] Run manual testing checklist (wheel, buttons, keyboard)
- [ ] Verify no console errors or warnings

**Documentation**:
- [ ] Add docstring to `update_zoom_status()` method
- [ ] Document zoom signal connection in `_connect_status_signals()` docstring
- [ ] Add inline comments if formatting logic non-obvious
- [ ] Update class docstring if needed

**Code Review**:
- [ ] Verify formatting uses `.0f` (integer, no decimals)
- [ ] Check defensive `hasattr()` check present
- [ ] Confirm type hints on method signature
- [ ] Verify signal connection matches spec
- [ ] Peer review completed

---

## 9. Open Questions

### 9.1 Resolved Questions

**Q1: Show zoom factor or percentage?**
- **Answer**: Percentage (e.g., "150%") - industry standard
- **Decided**: 2025-12-26

**Q2: Integer or decimal formatting?**
- **Answer**: Integer (no decimals) - cleaner, sufficient precision
- **Decided**: 2025-12-26

**Q3: How to handle missing canvas?**
- **Answer**: Graceful degradation with `hasattr()` check
- **Decided**: 2025-12-26

**Q4: Canvas emits factor or percentage?**
- **Answer**: Percentage - simplifies main window code
- **Decided**: 2025-12-26

### 9.2 Outstanding Questions

**Q1: Should status be clickable to set zoom?**
- **Current**: Static display only
- **Future**: Click to open zoom level picker
- **Priority**: P1 - enhancement after MVP

**Q2: Should we show zoom factor in tooltip?**
- **Current**: No tooltip
- **Future**: Tooltip showing "1.5x" alongside "150%"
- **Priority**: Low - defer unless user feedback indicates need

**Q3: Should extreme zoom levels (>500%) show warning color?**
- **Current**: Same color for all zoom levels
- **Future**: Red text for extreme zoom (may indicate lost context)
- **Priority**: Low - defer to theming/UX refinement

---

## 10. References

- **Primary Spec**: `/home/joohan/dev/project-ink/ink/specs/E06/F04/T03/E06-F04-T03.spec.md`
- **Parent Feature**: `/home/joohan/dev/project-ink/ink/specs/E06/F04/E06-F04.spec.md`
- **Upstream Dependency**: `/home/joohan/dev/project-ink/ink/specs/E06/F04/T01/E06-F04-T01.spec.md`
- **Canvas Dependency**: `/home/joohan/dev/project-ink/ink/specs/E02/F02/E02-F02.spec.md`
- **Qt Signals/Slots**: [Qt Signal & Slot Documentation](https://doc.qt.io/qt-6/signalsandslots.html)
- **QGraphicsView**: [QGraphicsView Zoom](https://doc.qt.io/qt-6/qgraphicsview.html#scale)

---

## 11. Revision History

| Date | Version | Author | Changes |
|------|---------|--------|---------|
| 2025-12-26 | 1.0 | Claude | Initial pre-implementation documentation |
