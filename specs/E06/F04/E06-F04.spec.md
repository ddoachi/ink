# Spec: E06-F04 - Status Bar

## Metadata
- **ID**: E06-F04
- **Type**: Feature
- **Priority**: P0 (MVP)
- **Status**: Draft
- **Parent**: [E06](../E06.spec.md)
- **Created**: 2025-12-26

---

## 1. Overview

### 1.1 Problem Statement

Users need immediate visual feedback about the application state without interrupting their workflow. A status bar provides persistent, non-intrusive display of contextual information like loaded file, zoom level, selection count, and visible object counts, enabling users to maintain situational awareness during schematic exploration.

### 1.2 Goals

- Display current file name in status bar
- Show real-time zoom level percentage
- Display selection count for multi-select operations
- Show visible cell/net counts in current view
- Update status information automatically as context changes
- Provide visual separation between status sections

---

## 2. User Stories

### US-E06-04: Status Bar
**As a** circuit designer
**I want to** see context information
**So that** I know current state

**Acceptance Criteria:**
- [ ] Loaded file name
- [ ] Zoom level percentage
- [ ] Selection count
- [ ] Cell/net count in view

---

## 3. Technical Requirements

### 3.1 Status Bar Layout

```
┌────────────────────────────────────────────────────────────────────┐
│ File: design.ckt  │  Zoom: 100%  │  Selected: 3  │  Cells: 45 / Nets: 67 │
└────────────────────────────────────────────────────────────────────┘
  Permanent           Permanent      Permanent       Permanent
  Widget              Widget         Widget          Widget
```

### 3.2 Status Bar Implementation

```python
# src/ink/presentation/main_window.py (extension)

from PySide6.QtWidgets import QStatusBar, QLabel

class InkMainWindow(QMainWindow):
    def _setup_status_bar(self):
        """Create status bar with persistent status widgets."""
        status = QStatusBar()
        self.setStatusBar(status)

        # File name label (left side)
        self.file_label = QLabel("No file loaded")
        self.file_label.setMinimumWidth(200)
        status.addPermanentWidget(self.file_label)

        # Separator
        status.addPermanentWidget(self._create_separator())

        # Zoom level label
        self.zoom_label = QLabel("Zoom: 100%")
        self.zoom_label.setMinimumWidth(100)
        status.addPermanentWidget(self.zoom_label)

        # Separator
        status.addPermanentWidget(self._create_separator())

        # Selection count label
        self.selection_label = QLabel("Selected: 0")
        self.selection_label.setMinimumWidth(100)
        status.addPermanentWidget(self.selection_label)

        # Separator
        status.addPermanentWidget(self._create_separator())

        # Object count label
        self.object_count_label = QLabel("Cells: 0 / Nets: 0")
        self.object_count_label.setMinimumWidth(150)
        status.addPermanentWidget(self.object_count_label)

    def _create_separator(self) -> QLabel:
        """Create vertical separator for status bar."""
        sep = QLabel(" │ ")
        sep.setStyleSheet("color: gray;")
        return sep

    # Status update methods
    def update_file_status(self, file_path: str | None):
        """Update file name in status bar."""
        if file_path:
            from pathlib import Path
            file_name = Path(file_path).name
            self.file_label.setText(f"File: {file_name}")
            self.file_label.setToolTip(file_path)  # Full path on hover
        else:
            self.file_label.setText("No file loaded")
            self.file_label.setToolTip("")

    def update_zoom_status(self, zoom_percent: float):
        """Update zoom level in status bar."""
        self.zoom_label.setText(f"Zoom: {zoom_percent:.0f}%")

    def update_selection_status(self, count: int):
        """Update selection count in status bar."""
        self.selection_label.setText(f"Selected: {count}")

    def update_object_count_status(self, cell_count: int, net_count: int):
        """Update visible object counts in status bar."""
        self.object_count_label.setText(f"Cells: {cell_count} / Nets: {net_count}")
```

### 3.3 Status Update Triggers

| Status Field | Update Trigger | Data Source |
|--------------|----------------|-------------|
| File name | File loaded/closed | File service |
| Zoom level | Canvas zoom changed | Schematic canvas viewport |
| Selection count | Selection changed | Selection service |
| Cell/Net count | View changed (expand/collapse) | Expansion state |

### 3.4 Status Bar Behavior

- **File name**:
  - Shows base filename only (e.g., `design.ckt`)
  - Full path shown in tooltip on hover
  - Shows "No file loaded" when no file open

- **Zoom level**:
  - Format: "Zoom: XXX%" (e.g., "Zoom: 150%")
  - Updates on every zoom change (wheel, buttons, fit)
  - Range: 10% - 1000%

- **Selection count**:
  - Format: "Selected: N"
  - Shows 0 when nothing selected
  - Updates immediately on selection change

- **Object counts**:
  - Format: "Cells: N / Nets: M"
  - Shows counts of currently visible/rendered objects
  - Updates after expand/collapse operations

### 3.5 Signal Connections

```python
# Example signal connections in main window
def _connect_status_signals(self):
    """Connect signals to status bar update methods."""
    # Zoom changes from canvas
    self.schematic_canvas.zoom_changed.connect(self.update_zoom_status)

    # Selection changes from selection service
    self.selection_service.selection_changed.connect(
        lambda items: self.update_selection_status(len(items))
    )

    # View changes from expansion service
    self.expansion_service.view_changed.connect(self._update_view_counts)

def _update_view_counts(self):
    """Query and update visible object counts."""
    cell_count = len(self.expansion_state.visible_cells)
    net_count = len(self.expansion_state.visible_nets)
    self.update_object_count_status(cell_count, net_count)
```

---

## 4. Dependencies

- **Upstream**:
  - E06-F01 (Main Window Shell - status bar attachment point)
- **Downstream**:
  - E01 (Data Model - file loading integration)
  - E02 (Rendering - zoom level tracking)
  - E04 (Interaction - selection tracking)
  - E03 (Expansion - visible object counts)
- **External**: PySide6 (`QStatusBar`, `QLabel`)

---

## 5. Acceptance Criteria

- [ ] Status bar visible at bottom of main window
- [ ] File name displayed and updates when file loaded
- [ ] File name shows "No file loaded" initially
- [ ] Tooltip shows full file path on file name hover
- [ ] Zoom percentage displays and updates on zoom changes
- [ ] Selection count displays and updates on selection changes
- [ ] Cell/net counts display and update on expand/collapse
- [ ] Visual separators between status sections
- [ ] Status bar has minimum height for readability
- [ ] All status fields remain visible when window resized
- [ ] Status updates occur in real-time (<100ms latency)

---

## 6. Child Specs

*To be created via `/spec_work E06-F04 --split tasks`*

| ID | Task | Status |
|----|------|--------|

---

## Revision History

| Date | Version | Author | Changes |
|------|---------|--------|---------|
| 2025-12-26 | 0.1 | Claude | Initial feature creation from E06 split |
