# Spec: E06-F03-T02 - View Control Tools

## Metadata
- **ID**: E06-F03-T02
- **Type**: Task
- **Priority**: P0 (MVP)
- **Status**: Draft
- **Parent**: [E06-F03](../E06-F03.spec.md)
- **Created**: 2025-12-26
- **Estimated Hours**: 4
- **Actual Hours**:
- **Effort**: Small
- **Tags**: [ui, toolbar, view-controls, zoom]

---

## 1. Overview

### 1.1 Problem Statement

Users need quick access to view manipulation controls during schematic exploration. Zoom in, zoom out, and fit-to-view operations are fundamental to navigating large schematics and must be accessible via toolbar buttons with keyboard shortcuts.

### 1.2 Goals

- Add Zoom In toolbar button with `Ctrl+=` shortcut
- Add Zoom Out toolbar button with `Ctrl+-` shortcut
- Add Fit View toolbar button with `Ctrl+0` shortcut
- Implement action handlers for zoom and fit operations
- Integrate with schematic canvas view control methods
- Provide tooltips showing action name and keyboard shortcut

---

## 2. Technical Requirements

### 2.1 View Actions Implementation

**Location**: `src/ink/presentation/main_window.py`

```python
from PySide6.QtGui import QAction, QIcon, QKeySequence
from PySide6.QtWidgets import QToolBar

class InkMainWindow(QMainWindow):
    def _setup_toolbar(self):
        """Create main toolbar with action buttons."""
        # ... existing toolbar setup from T01 ...

        # Add File group (from T03)
        # self._add_file_actions(toolbar)
        # toolbar.addSeparator()

        # Add Edit group (from T03)
        # self._add_edit_actions(toolbar)
        # toolbar.addSeparator()

        # View Group
        self._add_view_actions(self._toolbar)
        self._toolbar.addSeparator()

    def _add_view_actions(self, toolbar: QToolBar):
        """Add view-related toolbar actions."""
        # Zoom out button
        zoom_out_action = QAction(
            QIcon.fromTheme("zoom-out"),
            "Zoom Out",
            self
        )
        zoom_out_action.setToolTip("Zoom out (Ctrl+-)")
        zoom_out_action.setShortcut(QKeySequence.StandardKey.ZoomOut)
        zoom_out_action.triggered.connect(self._on_zoom_out)
        toolbar.addAction(zoom_out_action)

        # Zoom in button
        zoom_in_action = QAction(
            QIcon.fromTheme("zoom-in"),
            "Zoom In",
            self
        )
        zoom_in_action.setToolTip("Zoom in (Ctrl+=)")
        zoom_in_action.setShortcut(QKeySequence.StandardKey.ZoomIn)
        zoom_in_action.triggered.connect(self._on_zoom_in)
        toolbar.addAction(zoom_in_action)

        # Fit view button
        fit_view_action = QAction(
            QIcon.fromTheme("zoom-fit-best"),
            "Fit View",
            self
        )
        fit_view_action.setToolTip("Fit view to content (Ctrl+0)")
        fit_view_action.setShortcut(QKeySequence("Ctrl+0"))
        fit_view_action.triggered.connect(self._on_fit_view)
        toolbar.addAction(fit_view_action)

    # Action Handlers
    def _on_zoom_in(self):
        """Handle zoom in action."""
        if hasattr(self, '_canvas') and self._canvas:
            self._canvas.zoom_in()

    def _on_zoom_out(self):
        """Handle zoom out action."""
        if hasattr(self, '_canvas') and self._canvas:
            self._canvas.zoom_out()

    def _on_fit_view(self):
        """Handle fit view action."""
        if hasattr(self, '_canvas') and self._canvas:
            self._canvas.fit_view()
```

### 2.2 Canvas View Control Integration

**Assumption**: Schematic canvas (from E02) provides these methods:

```python
# src/ink/presentation/canvas/schematic_canvas.py
class SchematicCanvas(QGraphicsView):
    def zoom_in(self, factor: float = 1.2):
        """Zoom in by scaling factor."""
        self.scale(factor, factor)

    def zoom_out(self, factor: float = 1.2):
        """Zoom out by inverse scaling factor."""
        self.scale(1.0 / factor, 1.0 / factor)

    def fit_view(self):
        """Fit all visible items in view."""
        self.fitInView(self.scene().itemsBoundingRect(), Qt.AspectRatioMode.KeepAspectRatio)
```

If canvas doesn't exist yet, action handlers should gracefully handle missing canvas.

### 2.3 Button Specifications

| Button | Icon Theme | Tooltip | Shortcut | State |
|--------|-----------|---------|----------|-------|
| Zoom Out | `zoom-out` | "Zoom out (Ctrl+-)" | `Ctrl+-` | Always enabled |
| Zoom In | `zoom-in` | "Zoom in (Ctrl+=)" | `Ctrl+=` | Always enabled |
| Fit View | `zoom-fit-best` | "Fit view to content (Ctrl+0)" | `Ctrl+0` | Always enabled |

### 2.4 Keyboard Shortcuts

- **Zoom In**: `Ctrl+=` or `Ctrl++` (Qt standard)
- **Zoom Out**: `Ctrl+-` (Qt standard)
- **Fit View**: `Ctrl+0` (custom, industry convention)

Shortcuts work when:
1. Toolbar button has focus
2. Main window has focus (global application shortcuts)
3. Canvas has focus

---

## 3. Dependencies

### 3.1 Upstream Dependencies
- **E06-F03-T01**: Toolbar Setup (provides toolbar infrastructure)
- **E02**: Schematic Rendering (provides canvas with zoom/fit methods)

### 3.2 Downstream Dependencies
- **E06-F03-T04**: Icon Resources (provides fallback icons if theme missing)

### 3.3 External Dependencies
- PySide6: `QAction`, `QIcon`, `QKeySequence`
- Icon theme: System-provided icons (`zoom-in`, `zoom-out`, `zoom-fit-best`)

---

## 4. Acceptance Criteria

- [ ] Zoom In button appears in toolbar with zoom-in icon
- [ ] Zoom Out button appears in toolbar with zoom-out icon
- [ ] Fit View button appears in toolbar with fit-view icon
- [ ] Buttons arranged in order: Zoom Out, Zoom In, Fit View
- [ ] Visual separator before and after view group
- [ ] Tooltips display on hover with action name and shortcut
- [ ] `Ctrl+=` triggers zoom in when pressed
- [ ] `Ctrl+-` triggers zoom out when pressed
- [ ] `Ctrl+0` triggers fit view when pressed
- [ ] Clicking Zoom In button zooms canvas in
- [ ] Clicking Zoom Out button zooms canvas out
- [ ] Clicking Fit View button fits content to view
- [ ] Actions work when canvas is loaded
- [ ] Actions gracefully handle missing canvas (no crash)
- [ ] Buttons remain enabled at all times

---

## 5. Testing Strategy

### 5.1 Unit Tests

**Test file**: `tests/unit/presentation/test_main_window.py`

```python
def test_view_actions_created(main_window):
    """Test view control actions are added to toolbar."""
    toolbar = main_window.findChild(QToolBar, "MainToolBar")
    actions = toolbar.actions()

    # Check view actions exist
    zoom_in = next((a for a in actions if a.text() == "Zoom In"), None)
    zoom_out = next((a for a in actions if a.text() == "Zoom Out"), None)
    fit_view = next((a for a in actions if a.text() == "Fit View"), None)

    assert zoom_in is not None
    assert zoom_out is not None
    assert fit_view is not None

def test_view_action_shortcuts(main_window):
    """Test view actions have correct keyboard shortcuts."""
    toolbar = main_window.findChild(QToolBar, "MainToolBar")
    actions = toolbar.actions()

    zoom_in = next((a for a in actions if a.text() == "Zoom In"), None)
    zoom_out = next((a for a in actions if a.text() == "Zoom Out"), None)
    fit_view = next((a for a in actions if a.text() == "Fit View"), None)

    assert zoom_in.shortcut() == QKeySequence.StandardKey.ZoomIn
    assert zoom_out.shortcut() == QKeySequence.StandardKey.ZoomOut
    assert fit_view.shortcut() == QKeySequence("Ctrl+0")

def test_zoom_in_triggered(main_window, mock_canvas):
    """Test zoom in action calls canvas.zoom_in()."""
    main_window._canvas = mock_canvas
    toolbar = main_window.findChild(QToolBar, "MainToolBar")
    zoom_in = next((a for a in toolbar.actions() if a.text() == "Zoom In"), None)

    zoom_in.trigger()
    mock_canvas.zoom_in.assert_called_once()

def test_view_actions_without_canvas(main_window):
    """Test view actions don't crash when canvas is missing."""
    main_window._canvas = None
    toolbar = main_window.findChild(QToolBar, "MainToolBar")

    # Should not raise exception
    for action in toolbar.actions():
        if action.text() in ["Zoom In", "Zoom Out", "Fit View"]:
            action.trigger()
```

### 5.2 Integration Tests

**Test file**: `tests/integration/ui/test_toolbar_view_controls.py`

```python
def test_zoom_in_integration(app, main_window, loaded_design):
    """Test zoom in actually scales the canvas."""
    canvas = main_window._canvas
    initial_scale = canvas.transform().m11()

    # Trigger zoom in
    QTest.keyClick(main_window, Qt.Key.Key_Plus, Qt.KeyboardModifier.ControlModifier)

    assert canvas.transform().m11() > initial_scale

def test_fit_view_integration(app, main_window, loaded_design):
    """Test fit view adjusts canvas to show all content."""
    canvas = main_window._canvas

    # Zoom in first
    canvas.zoom_in()
    canvas.zoom_in()

    # Trigger fit view
    QTest.keyClick(main_window, Qt.Key.Key_0, Qt.KeyboardModifier.ControlModifier)

    # Verify all items visible
    visible_rect = canvas.mapToScene(canvas.viewport().rect()).boundingRect()
    items_rect = canvas.scene().itemsBoundingRect()
    assert visible_rect.contains(items_rect)
```

### 5.3 Manual Testing

1. Launch application with loaded design
2. Click Zoom In button → verify canvas zooms in
3. Click Zoom Out button → verify canvas zooms out
4. Click Fit View button → verify all content fits in view
5. Press `Ctrl+=` → verify zoom in works via keyboard
6. Press `Ctrl+-` → verify zoom out works via keyboard
7. Press `Ctrl+0` → verify fit view works via keyboard
8. Hover over buttons → verify tooltips show action and shortcut

---

## 6. Implementation Notes

### 6.1 Action Order

Buttons should appear in this order (left to right):
1. Zoom Out (decrease first, conventional order)
2. Zoom In (increase second)
3. Fit View (special operation last)

### 6.2 Icon Fallback

If system theme doesn't provide icons, fallback to:
- Unicode symbols: "−" (minus), "+" (plus), "⊡" (fit)
- Or custom SVG icons (provided in T04)

### 6.3 Canvas Integration

- Check `self._canvas` exists before calling methods
- Use `hasattr()` and null checks to avoid `AttributeError`
- Log warning if canvas missing (debugging aid)

### 6.4 Future Enhancements

- Zoom percentage display in status bar
- Custom zoom levels (25%, 50%, 100%, 200%, etc.)
- Zoom to selection
- Pan mode toggle button
- Reset view to initial state

---

## Revision History

| Date | Version | Author | Changes |
|------|---------|--------|---------|
| 2025-12-26 | 0.1 | Claude | Initial task spec creation from E06-F03 split |
