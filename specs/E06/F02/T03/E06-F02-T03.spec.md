---
id: E06-F02-T03
title: Edit Menu Actions
type: Task
priority: P0 (MVP)
status: Draft
parent: E06-F02
created: 2025-12-26
estimated_hours: 3
actual_hours:
effort: Medium
tags:
  - ui
  - menus
  - editing
---

# Spec: E06-F02-T03 - Edit Menu Actions

## 1. Overview

### 1.1 Problem Statement

Users need Edit menu actions for undo/redo of expansion operations and search functionality. Undo/Redo actions must be context-sensitive (disabled when no actions available) and Find must open the search panel.

### 1.2 Goals

- Implement Undo action with state management (`Ctrl+Z`)
- Implement Redo action with state management (`Ctrl+Shift+Z`)
- Implement Find action to open search panel (`Ctrl+F`)
- Disable Undo/Redo when no actions available
- Enable Undo/Redo when expansion/collapse history exists

---

## 2. Technical Requirements

### 2.1 Edit Menu Implementation

```python
# src/ink/presentation/main_window.py

from PySide6.QtGui import QAction, QKeySequence

class InkMainWindow(QMainWindow):
    def _create_edit_menu(self):
        """Create Edit menu items."""
        # Undo action
        self.undo_action = QAction("&Undo", self)
        self.undo_action.setShortcut(QKeySequence.StandardKey.Undo)  # Ctrl+Z
        self.undo_action.setStatusTip("Undo last expansion/collapse")
        self.undo_action.setEnabled(False)  # Initially disabled
        self.undo_action.triggered.connect(self._on_undo)
        self.edit_menu.addAction(self.undo_action)

        # Redo action
        self.redo_action = QAction("&Redo", self)
        self.redo_action.setShortcut(QKeySequence.StandardKey.Redo)  # Ctrl+Shift+Z
        self.redo_action.setStatusTip("Redo last undone action")
        self.redo_action.setEnabled(False)  # Initially disabled
        self.redo_action.triggered.connect(self._on_redo)
        self.edit_menu.addAction(self.redo_action)

        self.edit_menu.addSeparator()

        # Find action
        find_action = QAction("&Find...", self)
        find_action.setShortcut(QKeySequence.StandardKey.Find)  # Ctrl+F
        find_action.setStatusTip("Search for cells, nets, or ports")
        find_action.triggered.connect(self._on_find)
        self.edit_menu.addAction(find_action)

    def _on_undo(self):
        """Handle Edit > Undo action."""
        # TODO: Integrate with ExpansionService undo command
        # For now, just show status message
        self.statusBar().showMessage("Undo triggered", 2000)

        # Update menu states after undo
        self._update_undo_redo_state()

    def _on_redo(self):
        """Handle Edit > Redo action."""
        # TODO: Integrate with ExpansionService redo command
        # For now, just show status message
        self.statusBar().showMessage("Redo triggered", 2000)

        # Update menu states after redo
        self._update_undo_redo_state()

    def _on_find(self):
        """Handle Edit > Find action."""
        # Open search panel if not visible
        if not self.search_dock.isVisible():
            self.search_dock.setVisible(True)

        # Focus on search input field
        self.search_panel.focus_search_input()

    def _update_undo_redo_state(self):
        """Update enabled state of Undo/Redo actions based on history."""
        # TODO: Query ExpansionService for undo/redo availability
        # For now, use placeholder logic
        can_undo = False  # Replace with: expansion_service.can_undo()
        can_redo = False  # Replace with: expansion_service.can_redo()

        self.undo_action.setEnabled(can_undo)
        self.redo_action.setEnabled(can_redo)

        # Update action text to show what will be undone/redone
        if can_undo:
            # TODO: Get last action description from service
            self.undo_action.setText("&Undo Expand")  # Example
        else:
            self.undo_action.setText("&Undo")

        if can_redo:
            # TODO: Get next action description from service
            self.redo_action.setText("&Redo Expand")  # Example
        else:
            self.redo_action.setText("&Redo")
```

### 2.2 Menu State Updates

The `_update_undo_redo_state()` method should be called:
- After every expansion operation
- After every collapse operation
- After undo/redo operations
- After loading a new netlist (reset to disabled)

Integration points:
```python
# In expansion/collapse handlers
def _on_expand_cell(self, cell_id):
    # ... perform expansion ...
    self._update_undo_redo_state()

def _on_collapse_cell(self, cell_id):
    # ... perform collapse ...
    self._update_undo_redo_state()

def _load_netlist(self, file_path):
    # ... load netlist ...
    self._update_undo_redo_state()  # Reset to disabled
```

### 2.3 Search Panel Integration

The Find action must:
1. Make search dock visible if hidden
2. Focus the search input field for immediate typing

Requires search panel to provide `focus_search_input()` method:
```python
# src/ink/presentation/panels/search_panel.py

class SearchPanel(QWidget):
    def focus_search_input(self):
        """Set focus to search input field."""
        self.search_input.setFocus()
        self.search_input.selectAll()  # Select existing text for replacement
```

---

## 3. Dependencies

- **Upstream**:
  - E06-F02-T01 (Menu Bar Setup - `self.edit_menu` exists)
  - E06-F03 (Search Panel - search dock and panel exist)
- **Downstream**:
  - E04-F03 (Undo/Redo - `ExpansionService` with undo/redo methods)
  - E05-F01 (Search - search panel focus method)
- **External**: PySide6 (`QAction`, `QKeySequence`)

---

## 4. Acceptance Criteria

- [ ] Edit menu contains Undo, Redo, and Find actions
- [ ] Undo action uses `Ctrl+Z` shortcut
- [ ] Redo action uses `Ctrl+Shift+Z` shortcut
- [ ] Find action uses `Ctrl+F` shortcut
- [ ] Undo/Redo actions initially disabled (no history)
- [ ] Undo/Redo actions enable after expansion/collapse operations
- [ ] Undo/Redo text updates to show action type (e.g., "Undo Expand")
- [ ] Find action shows search panel if hidden
- [ ] Find action focuses search input field
- [ ] Status tips appear in status bar on hover
- [ ] Keyboard shortcuts work as specified

---

## 5. Testing Strategy

### Manual Testing
1. **Undo/Redo State**:
   - Launch app, verify Undo/Redo disabled
   - Perform expansion, verify Undo enabled, Redo disabled
   - Press `Ctrl+Z`, verify Redo enabled
   - Press `Ctrl+Shift+Z`, verify Redo disabled

2. **Find Action**:
   - Hide search panel
   - Press `Ctrl+F` or Edit > Find
   - Verify search panel becomes visible
   - Verify search input has focus
   - Type search query, verify typing works immediately

3. **Keyboard Shortcuts**:
   - Test `Ctrl+Z`, `Ctrl+Shift+Z`, `Ctrl+F`
   - Verify actions trigger correctly

### Unit Tests
```python
# tests/ui/test_edit_menu.py

def test_undo_action_exists(main_window):
    """Test Undo action is in Edit menu."""
    actions = main_window.edit_menu.actions()
    undo_action = main_window.undo_action
    assert undo_action is not None
    assert undo_action.shortcut() == QKeySequence.StandardKey.Undo

def test_redo_action_exists(main_window):
    """Test Redo action is in Edit menu."""
    redo_action = main_window.redo_action
    assert redo_action is not None
    assert redo_action.shortcut() == QKeySequence.StandardKey.Redo

def test_undo_redo_initially_disabled(main_window):
    """Test Undo/Redo actions start disabled."""
    assert not main_window.undo_action.isEnabled()
    assert not main_window.redo_action.isEnabled()

def test_find_action_exists(main_window):
    """Test Find action is in Edit menu."""
    actions = main_window.edit_menu.actions()
    find_actions = [a for a in actions if "Find" in a.text()]
    assert len(find_actions) == 1
    assert find_actions[0].shortcut() == QKeySequence.StandardKey.Find

def test_find_shows_search_panel(main_window, qtbot):
    """Test Find action shows search panel."""
    main_window.search_dock.setVisible(False)

    # Trigger find action
    main_window._on_find()

    assert main_window.search_dock.isVisible()

def test_update_undo_redo_state(main_window):
    """Test state update method enables/disables correctly."""
    # Initially disabled
    assert not main_window.undo_action.isEnabled()

    # Simulate having undo history (when integrated)
    # For now, just test method doesn't crash
    main_window._update_undo_redo_state()
```

---

## 6. Implementation Notes

- Undo/Redo integration with `ExpansionService` is deferred to E04-F03
- Initial implementation uses placeholder logic (`can_undo = False`)
- Search panel focus method is deferred to E05-F01
- Consider updating action text dynamically: "Undo Expand", "Redo Collapse", etc.
- Qt StandardKey automatically handles platform differences (e.g., Cmd+Z on macOS)
- Status tips show in status bar when hovering over menu items

---

## Revision History

| Date | Version | Author | Changes |
|------|---------|--------|---------|
| 2025-12-26 | 0.1 | Claude | Initial task creation from E06-F02 split |
