---
id: E06-F02-T04
title: View and Help Menus
type: Task
priority: P0 (MVP)
status: Draft
parent: E06-F02
created: 2025-12-26
estimated_hours: 3
actual_hours:
effort: Medium
tags:
  - ui
  - menus
  - view
  - help
---

# Spec: E06-F02-T04 - View and Help Menus

## 1. Overview

### 1.1 Problem Statement

Users need View menu actions to control zoom and panel visibility, plus Help menu actions to access keyboard shortcuts and application information. Panel toggles must sync with dock widget visibility states.

### 1.2 Goals

- Implement View menu with zoom controls (Zoom In, Zoom Out, Fit View)
- Add panel toggle actions with checkmarks synced to visibility
- Implement Help menu with Keyboard Shortcuts and About dialogs
- Ensure checkmarks reflect actual panel visibility
- Create About dialog with application info

---

## 2. Technical Requirements

### 2.1 View Menu Implementation

```python
# src/ink/presentation/main_window.py

from PySide6.QtGui import QAction, QKeySequence

class InkMainWindow(QMainWindow):
    def _create_view_menu(self):
        """Create View menu items."""
        # Zoom In
        zoom_in_action = QAction("Zoom &In", self)
        zoom_in_action.setShortcut(QKeySequence.StandardKey.ZoomIn)  # Ctrl+=
        zoom_in_action.setStatusTip("Zoom in on schematic")
        zoom_in_action.triggered.connect(self._on_zoom_in)
        self.view_menu.addAction(zoom_in_action)

        # Zoom Out
        zoom_out_action = QAction("Zoom &Out", self)
        zoom_out_action.setShortcut(QKeySequence.StandardKey.ZoomOut)  # Ctrl+-
        zoom_out_action.setStatusTip("Zoom out on schematic")
        zoom_out_action.triggered.connect(self._on_zoom_out)
        self.view_menu.addAction(zoom_out_action)

        # Fit View
        fit_view_action = QAction("&Fit View", self)
        fit_view_action.setShortcut(QKeySequence("Ctrl+0"))
        fit_view_action.setStatusTip("Fit schematic to view")
        fit_view_action.triggered.connect(self._on_fit_view)
        self.view_menu.addAction(fit_view_action)

        self.view_menu.addSeparator()

        # Panel toggles (checkable actions from dock widgets)
        # QDockWidget.toggleViewAction() creates a checkable action automatically
        self.hierarchy_toggle = self.hierarchy_dock.toggleViewAction()
        self.hierarchy_toggle.setText("&Hierarchy Panel")
        self.hierarchy_toggle.setStatusTip("Show/hide hierarchy panel")
        self.view_menu.addAction(self.hierarchy_toggle)

        self.property_toggle = self.property_dock.toggleViewAction()
        self.property_toggle.setText("&Property Panel")
        self.property_toggle.setStatusTip("Show/hide property panel")
        self.view_menu.addAction(self.property_toggle)

        self.message_toggle = self.message_dock.toggleViewAction()
        self.message_toggle.setText("&Message Panel")
        self.message_toggle.setStatusTip("Show/hide message panel")
        self.view_menu.addAction(self.message_toggle)

    def _on_zoom_in(self):
        """Handle View > Zoom In action."""
        # TODO: Integrate with SchematicCanvas zoom
        if self.schematic_canvas:
            self.schematic_canvas.zoom_in()

    def _on_zoom_out(self):
        """Handle View > Zoom Out action."""
        # TODO: Integrate with SchematicCanvas zoom
        if self.schematic_canvas:
            self.schematic_canvas.zoom_out()

    def _on_fit_view(self):
        """Handle View > Fit View action."""
        # TODO: Integrate with SchematicCanvas fit to view
        if self.schematic_canvas:
            self.schematic_canvas.fit_to_view()
```

### 2.2 Help Menu Implementation

```python
# src/ink/presentation/main_window.py

from PySide6.QtWidgets import QMessageBox, QDialog, QVBoxLayout, QTextBrowser

class InkMainWindow(QMainWindow):
    def _create_help_menu(self):
        """Create Help menu items."""
        # Keyboard Shortcuts
        shortcuts_action = QAction("&Keyboard Shortcuts", self)
        shortcuts_action.setShortcut(QKeySequence("F1"))
        shortcuts_action.setStatusTip("Show keyboard shortcuts")
        shortcuts_action.triggered.connect(self._on_show_shortcuts)
        self.help_menu.addAction(shortcuts_action)

        self.help_menu.addSeparator()

        # About dialog
        about_action = QAction("&About Ink", self)
        about_action.setStatusTip("About this application")
        about_action.triggered.connect(self._on_about)
        self.help_menu.addAction(about_action)

    def _on_show_shortcuts(self):
        """Show keyboard shortcuts dialog."""
        dialog = KeyboardShortcutsDialog(self)
        dialog.exec()

    def _on_about(self):
        """Show About dialog."""
        QMessageBox.about(
            self,
            "About Ink",
            "<h2>Ink - Incremental Schematic Viewer</h2>"
            "<p>Version 0.1.0 (MVP)</p>"
            "<p>A GUI tool for schematic exploration targeting gate-level netlists.</p>"
            "<p><b>Features:</b></p>"
            "<ul>"
            "<li>Incremental exploration from user-selected points</li>"
            "<li>Hop-based fanin/fanout expansion</li>"
            "<li>Orthogonal net routing with Sugiyama layout</li>"
            "<li>Search and navigation</li>"
            "</ul>"
            "<p>Built with PySide6 and Python</p>"
            "<p>&copy; 2025 Ink Project</p>"
        )
```

### 2.3 Keyboard Shortcuts Dialog

```python
# src/ink/presentation/dialogs/shortcuts_dialog.py

from PySide6.QtWidgets import QDialog, QVBoxLayout, QTextBrowser, QPushButton
from PySide6.QtCore import Qt

class KeyboardShortcutsDialog(QDialog):
    """Dialog showing all keyboard shortcuts."""

    def __init__(self, parent=None):
        super().__init__(parent)
        self.setWindowTitle("Keyboard Shortcuts")
        self.setMinimumSize(500, 400)

        layout = QVBoxLayout(self)

        # Text browser with shortcuts
        browser = QTextBrowser()
        browser.setHtml(self._get_shortcuts_html())
        browser.setOpenExternalLinks(False)
        layout.addWidget(browser)

        # Close button
        close_btn = QPushButton("Close")
        close_btn.clicked.connect(self.accept)
        layout.addWidget(close_btn)

    def _get_shortcuts_html(self) -> str:
        """Generate HTML content for shortcuts."""
        return """
        <h2>Keyboard Shortcuts</h2>

        <h3>File Menu</h3>
        <table>
            <tr><td><b>Ctrl+O</b></td><td>Open netlist file</td></tr>
            <tr><td><b>Ctrl+Q</b></td><td>Exit application</td></tr>
        </table>

        <h3>Edit Menu</h3>
        <table>
            <tr><td><b>Ctrl+Z</b></td><td>Undo last action</td></tr>
            <tr><td><b>Ctrl+Shift+Z</b></td><td>Redo last undone action</td></tr>
            <tr><td><b>Ctrl+F</b></td><td>Find (open search panel)</td></tr>
        </table>

        <h3>View Menu</h3>
        <table>
            <tr><td><b>Ctrl+=</b></td><td>Zoom in</td></tr>
            <tr><td><b>Ctrl+-</b></td><td>Zoom out</td></tr>
            <tr><td><b>Ctrl+0</b></td><td>Fit view</td></tr>
        </table>

        <h3>Canvas Interaction</h3>
        <table>
            <tr><td><b>Double-click cell</b></td><td>Expand fanout/fanin</td></tr>
            <tr><td><b>Right-click</b></td><td>Context menu</td></tr>
            <tr><td><b>Mouse wheel</b></td><td>Zoom in/out</td></tr>
            <tr><td><b>Middle-click drag</b></td><td>Pan view</td></tr>
        </table>

        <h3>Help</h3>
        <table>
            <tr><td><b>F1</b></td><td>Show this help dialog</td></tr>
        </table>
        """
```

---

## 3. Dependencies

- **Upstream**:
  - E06-F02-T01 (Menu Bar Setup - `self.view_menu`, `self.help_menu` exist)
  - E06-F01 (Main Window Shell - dock widgets exist)
  - E02-F02 (Schematic Canvas - zoom methods exist)
- **Downstream**:
  - E02-F04 (Zoom and Pan - `zoom_in()`, `zoom_out()`, `fit_to_view()` methods)
- **External**: PySide6 (`QAction`, `QKeySequence`, `QMessageBox`, `QDialog`)

---

## 4. Acceptance Criteria

- [ ] View menu contains Zoom In, Zoom Out, Fit View actions
- [ ] View menu contains Hierarchy Panel, Property Panel, Message Panel toggles
- [ ] Panel toggle actions show checkmarks when panels visible
- [ ] Checkmarks sync automatically when panels shown/hidden via other means
- [ ] Zoom actions trigger canvas zoom methods
- [ ] Fit View action fits schematic to viewport
- [ ] Keyboard shortcuts work: `Ctrl+=`, `Ctrl+-`, `Ctrl+0`
- [ ] Help menu contains Keyboard Shortcuts and About actions
- [ ] `F1` opens Keyboard Shortcuts dialog
- [ ] Keyboard Shortcuts dialog shows all shortcuts in organized categories
- [ ] About dialog shows app name, version, description, and credits
- [ ] About dialog uses `QMessageBox.about()` with proper formatting

---

## 5. Testing Strategy

### Manual Testing

1. **Zoom Actions**:
   - Press `Ctrl+=`, verify zoom in
   - Press `Ctrl+-`, verify zoom out
   - Press `Ctrl+0`, verify fit to view
   - Test via menu clicks as well

2. **Panel Toggles**:
   - Click Hierarchy Panel toggle, verify panel shows/hides
   - Verify checkmark appears when visible, disappears when hidden
   - Close panel via X button, verify checkmark disappears
   - Reopen via menu, verify checkmark reappears

3. **Keyboard Shortcuts Dialog**:
   - Press `F1` or Help > Keyboard Shortcuts
   - Verify dialog shows all shortcuts
   - Verify shortcuts organized by category
   - Close dialog

4. **About Dialog**:
   - Click Help > About Ink
   - Verify app name, version, description appear
   - Verify formatting is clean and readable
   - Close dialog

### Unit Tests

```python
# tests/ui/test_view_menu.py

def test_zoom_actions_exist(main_window):
    """Test zoom actions in View menu."""
    actions = main_window.view_menu.actions()
    zoom_in = next(a for a in actions if "Zoom In" in a.text())
    zoom_out = next(a for a in actions if "Zoom Out" in a.text())
    fit_view = next(a for a in actions if "Fit View" in a.text())

    assert zoom_in.shortcut() == QKeySequence.StandardKey.ZoomIn
    assert zoom_out.shortcut() == QKeySequence.StandardKey.ZoomOut
    assert fit_view.shortcut() == QKeySequence("Ctrl+0")

def test_panel_toggles_exist(main_window):
    """Test panel toggle actions exist."""
    assert main_window.hierarchy_toggle is not None
    assert main_window.property_toggle is not None
    assert main_window.message_toggle is not None

def test_panel_toggles_checkable(main_window):
    """Test panel toggles are checkable."""
    assert main_window.hierarchy_toggle.isCheckable()
    assert main_window.property_toggle.isCheckable()
    assert main_window.message_toggle.isCheckable()

def test_panel_toggle_syncs_with_visibility(main_window):
    """Test toggle checkmark syncs with dock visibility."""
    # Hide hierarchy panel
    main_window.hierarchy_dock.setVisible(False)
    assert not main_window.hierarchy_toggle.isChecked()

    # Show hierarchy panel
    main_window.hierarchy_dock.setVisible(True)
    assert main_window.hierarchy_toggle.isChecked()

# tests/ui/test_help_menu.py

def test_shortcuts_action_exists(main_window):
    """Test Keyboard Shortcuts action in Help menu."""
    actions = main_window.help_menu.actions()
    shortcuts_action = next(a for a in actions if "Keyboard Shortcuts" in a.text())
    assert shortcuts_action.shortcut() == QKeySequence("F1")

def test_about_action_exists(main_window):
    """Test About action in Help menu."""
    actions = main_window.help_menu.actions()
    about_action = next(a for a in actions if "About" in a.text())
    assert about_action is not None
```

---

## 6. Implementation Notes

- Use `QDockWidget.toggleViewAction()` for automatic checkmark syncing
- This built-in Qt method creates a `QAction` that stays in sync with dock visibility
- Zoom methods delegate to `SchematicCanvas` (integration point for E02-F04)
- Keyboard Shortcuts dialog is a separate class in `dialogs/shortcuts_dialog.py`
- About dialog uses `QMessageBox.about()` for platform-native styling
- HTML in About dialog should be simple and readable
- Consider adding version number from `pyproject.toml` dynamically

---

## Revision History

| Date | Version | Author | Changes |
|------|---------|--------|---------|
| 2025-12-26 | 0.1 | Claude | Initial task creation from E06-F02 split |
