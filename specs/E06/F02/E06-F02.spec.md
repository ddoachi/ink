# Spec: E06-F02 - Menu System

## Metadata
- **ID**: E06-F02
- **Type**: Feature
- **Priority**: P0 (MVP)
- **Status**: Draft
- **Parent**: [E06](../E06.spec.md)
- **Created**: 2025-12-26

---

## 1. Overview

### 1.1 Problem Statement

Users need discoverable access to all application features through a standard menu system. Menus provide feature discoverability for new users and organize commands logically by category (File, Edit, View, Help), following EDA tool conventions.

### 1.2 Goals

- Implement hierarchical menu bar with File, Edit, View, and Help menus
- Provide keyboard shortcuts for common actions
- Enable recent files access for workflow efficiency
- Organize menu items logically by function category
- Support menu item enable/disable states based on context

---

## 2. User Stories

### US-E06-02: Menu Bar
**As a** circuit designer
**I want to** access functions via menus
**So that** I can discover available features

**Acceptance Criteria:**
- [ ] File menu: Open, Recent Files, Exit
- [ ] Edit menu: Undo, Redo, Find
- [ ] View menu: Zoom, Fit, Toggle panels
- [ ] Help menu: About, Keyboard shortcuts

### US-E06-06: Recent Files
**As a** circuit designer
**I want to** quickly open recent files
**So that** I can resume work efficiently

**Acceptance Criteria:**
- [ ] Last 10 files remembered
- [ ] Recent files in File menu
- [ ] Click to open directly
- [ ] Missing files handled gracefully

---

## 3. Technical Requirements

### 3.1 Menu Structure

```
File
├── Open...                 (Ctrl+O)
├── Open Recent            ►
│   ├── /path/to/file1.ckt
│   ├── /path/to/file2.ckt
│   ├── ...
│   ├── ────────────────
│   └── Clear Recent Files
├── ─────────────
└── Exit                   (Ctrl+Q)

Edit
├── Undo                   (Ctrl+Z)
├── Redo                   (Ctrl+Shift+Z)
├── ─────────────
└── Find...                (Ctrl+F)

View
├── Zoom In                (Ctrl+=)
├── Zoom Out               (Ctrl+-)
├── Fit View               (Ctrl+0)
├── ─────────────
├── ☑ Hierarchy Panel
├── ☑ Property Panel
└── ☑ Message Panel

Help
├── Keyboard Shortcuts     (F1)
├── ─────────────
└── About Ink
```

### 3.2 Menu Implementation

```python
# src/ink/presentation/main_window.py (extension)

class InkMainWindow(QMainWindow):
    def _setup_menus(self):
        """Create menu bar and all menus."""
        menubar = self.menuBar()

        # File Menu
        self.file_menu = menubar.addMenu("&File")
        self._create_file_menu()

        # Edit Menu
        self.edit_menu = menubar.addMenu("&Edit")
        self._create_edit_menu()

        # View Menu
        self.view_menu = menubar.addMenu("&View")
        self._create_view_menu()

        # Help Menu
        self.help_menu = menubar.addMenu("&Help")
        self._create_help_menu()

    def _create_file_menu(self):
        """Create File menu items."""
        # Open action
        open_action = QAction("&Open...", self)
        open_action.setShortcut(QKeySequence.StandardKey.Open)  # Ctrl+O
        open_action.triggered.connect(self._on_open_file)
        self.file_menu.addAction(open_action)

        # Recent files submenu
        self.recent_menu = self.file_menu.addMenu("Open &Recent")
        self._update_recent_files_menu()

        self.file_menu.addSeparator()

        # Exit action
        exit_action = QAction("E&xit", self)
        exit_action.setShortcut(QKeySequence.StandardKey.Quit)  # Ctrl+Q
        exit_action.triggered.connect(self.close)
        self.file_menu.addAction(exit_action)

    def _create_edit_menu(self):
        """Create Edit menu items."""
        # Undo action
        self.undo_action = QAction("&Undo", self)
        self.undo_action.setShortcut(QKeySequence.StandardKey.Undo)  # Ctrl+Z
        self.undo_action.setEnabled(False)  # Initially disabled
        self.edit_menu.addAction(self.undo_action)

        # Redo action
        self.redo_action = QAction("&Redo", self)
        self.redo_action.setShortcut(QKeySequence.StandardKey.Redo)  # Ctrl+Shift+Z
        self.redo_action.setEnabled(False)  # Initially disabled
        self.edit_menu.addAction(self.redo_action)

        self.edit_menu.addSeparator()

        # Find action
        find_action = QAction("&Find...", self)
        find_action.setShortcut(QKeySequence.StandardKey.Find)  # Ctrl+F
        find_action.triggered.connect(self._on_find)
        self.edit_menu.addAction(find_action)

    def _create_view_menu(self):
        """Create View menu items."""
        # Zoom In
        zoom_in_action = QAction("Zoom &In", self)
        zoom_in_action.setShortcut(QKeySequence.StandardKey.ZoomIn)  # Ctrl+=
        zoom_in_action.triggered.connect(self._on_zoom_in)
        self.view_menu.addAction(zoom_in_action)

        # Zoom Out
        zoom_out_action = QAction("Zoom &Out", self)
        zoom_out_action.setShortcut(QKeySequence.StandardKey.ZoomOut)  # Ctrl+-
        zoom_out_action.triggered.connect(self._on_zoom_out)
        self.view_menu.addAction(zoom_out_action)

        # Fit View
        fit_view_action = QAction("&Fit View", self)
        fit_view_action.setShortcut(QKeySequence("Ctrl+0"))
        fit_view_action.triggered.connect(self._on_fit_view)
        self.view_menu.addAction(fit_view_action)

        self.view_menu.addSeparator()

        # Panel toggles (checkable)
        self.hierarchy_toggle = self.hierarchy_dock.toggleViewAction()
        self.hierarchy_toggle.setText("&Hierarchy Panel")
        self.view_menu.addAction(self.hierarchy_toggle)

        self.property_toggle = self.property_dock.toggleViewAction()
        self.property_toggle.setText("&Property Panel")
        self.view_menu.addAction(self.property_toggle)

        self.message_toggle = self.message_dock.toggleViewAction()
        self.message_toggle.setText("&Message Panel")
        self.view_menu.addAction(self.message_toggle)

    def _create_help_menu(self):
        """Create Help menu items."""
        # Keyboard Shortcuts
        shortcuts_action = QAction("&Keyboard Shortcuts", self)
        shortcuts_action.setShortcut(QKeySequence("F1"))
        shortcuts_action.triggered.connect(self._on_show_shortcuts)
        self.help_menu.addAction(shortcuts_action)

        self.help_menu.addSeparator()

        # About dialog
        about_action = QAction("&About Ink", self)
        about_action.triggered.connect(self._on_about)
        self.help_menu.addAction(about_action)

    def _update_recent_files_menu(self):
        """Populate recent files submenu from settings."""
        self.recent_menu.clear()

        # Get recent files from settings
        recent_files = self._get_recent_files()

        if not recent_files:
            no_recent = QAction("No recent files", self)
            no_recent.setEnabled(False)
            self.recent_menu.addAction(no_recent)
        else:
            for file_path in recent_files:
                action = QAction(file_path, self)
                action.triggered.connect(
                    lambda checked, path=file_path: self._open_recent_file(path)
                )
                self.recent_menu.addAction(action)

            self.recent_menu.addSeparator()

            clear_action = QAction("Clear Recent Files", self)
            clear_action.triggered.connect(self._clear_recent_files)
            self.recent_menu.addAction(clear_action)
```

### 3.3 Keyboard Shortcut Requirements

| Action | Shortcut | Standard |
|--------|----------|----------|
| Open File | `Ctrl+O` | Qt StandardKey.Open |
| Exit | `Ctrl+Q` | Qt StandardKey.Quit |
| Undo | `Ctrl+Z` | Qt StandardKey.Undo |
| Redo | `Ctrl+Shift+Z` | Qt StandardKey.Redo |
| Find | `Ctrl+F` | Qt StandardKey.Find |
| Zoom In | `Ctrl+=` | Qt StandardKey.ZoomIn |
| Zoom Out | `Ctrl+-` | Qt StandardKey.ZoomOut |
| Fit View | `Ctrl+0` | Custom |
| Shortcuts Help | `F1` | Common convention |

### 3.4 Menu State Management

- **Undo/Redo**: Initially disabled, enabled when actions available
- **Panel toggles**: Checked state syncs with dock widget visibility
- **Recent files**: Show last 10 files, handle missing files gracefully
- Menu items must reflect current application state

---

## 4. Dependencies

- **Upstream**:
  - E06-F01 (Main Window Shell - menu bar attachment point)
  - E06-F06 (Settings Persistence - recent files storage)
- **Downstream**:
  - E04 (Interaction - undo/redo command integration)
  - E05 (Search - find dialog integration)
  - E02 (Rendering - zoom/fit commands)
- **External**: PySide6 (`QMenuBar`, `QMenu`, `QAction`, `QKeySequence`)

---

## 5. Acceptance Criteria

- [ ] Menu bar visible with File, Edit, View, Help menus
- [ ] All menu items trigger correct actions
- [ ] Keyboard shortcuts work as specified
- [ ] Recent files submenu shows up to 10 recent files
- [ ] Recent files open correctly when clicked
- [ ] "Clear Recent Files" removes all recent file entries
- [ ] Missing recent files show error message, don't crash
- [ ] Panel toggle menu items sync with dock widget visibility (checkmarks)
- [ ] Undo/Redo menu items disabled when no actions available
- [ ] Menu items use standard mnemonics (underlined letters for Alt+key access)
- [ ] About dialog displays application name, version, and credits

---

## 6. Child Specs

*To be created via `/spec_work E06-F02 --split tasks`*

| ID | Task | Status |
|----|------|--------|

---

## Revision History

| Date | Version | Author | Changes |
|------|---------|--------|---------|
| 2025-12-26 | 0.1 | Claude | Initial feature creation from E06 split |
