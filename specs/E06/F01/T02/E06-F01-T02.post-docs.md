# E06-F01-T02: Central Widget Setup - Post-Implementation Documentation

## 1. Implementation Summary

**Spec**: [E06-F01-T02.spec.md](E06-F01-T02.spec.md)
**Status**: Completed
**ClickUp Task**: [CU-86evzm333](https://app.clickup.com/t/86evzm333)
**GitHub Issue**: [Issue #6](https://github.com/ddoachi/ink/issues/6)

### What Was Built

The central widget setup for `InkMainWindow` was implemented using TDD workflow:

1. **SchematicCanvas Widget** (`src/ink/presentation/canvas/schematic_canvas.py`)
   - Placeholder QWidget for schematic visualization area
   - Displays centered informational text with styled appearance
   - Zero-margin layout for seamless central area fill
   - Proper Qt parent-child relationship support

2. **InkMainWindow Integration** (`src/ink/presentation/main_window.py`)
   - Added `_setup_central_widget()` method
   - `schematic_canvas` instance attribute for programmatic access
   - Canvas set as Qt central widget via `setCentralWidget()`

3. **Canvas Package Structure** (`src/ink/presentation/canvas/`)
   - Package `__init__.py` with proper exports
   - `schematic_canvas.py` module with `SchematicCanvas` class

---

## 2. Files Changed

| File | Change Type | Purpose |
|------|-------------|---------|
| `src/ink/presentation/canvas/__init__.py` | Created | Canvas package with exports |
| `src/ink/presentation/canvas/schematic_canvas.py` | Created | SchematicCanvas placeholder widget |
| `src/ink/presentation/main_window.py` | Modified | Added central widget setup |
| `tests/unit/presentation/canvas/__init__.py` | Created | Test package |
| `tests/unit/presentation/canvas/test_schematic_canvas.py` | Created | 10 unit tests |
| `tests/integration/presentation/__init__.py` | Created | Test package |
| `tests/integration/presentation/test_main_window_canvas.py` | Created | 8 integration tests |

---

## 3. Key Design Decisions

### Why QWidget Instead of QGraphicsView?

**Decision**: Use `QWidget` for the placeholder, not `QGraphicsView`.

**Rationale**:
- Placeholder only needs to display text - no rendering logic
- Simpler implementation with fewer dependencies
- `QGraphicsView` will be used in E02 (Rendering) when actual schematic rendering is implemented
- Keeps this task focused and atomic

### Why Store Canvas as Instance Attribute?

**Decision**: Store canvas as `self.schematic_canvas` in addition to setting as central widget.

**Rationale**:
- Enables direct access for signal/slot connections: `window.schematic_canvas.someSignal.connect(...)`
- Standard Qt pattern for important child widgets
- Both access methods work: `window.schematic_canvas` and `window.centralWidget()`

### Why Zero Margins?

**Decision**: Layout uses `setContentsMargins(0, 0, 0, 0)`.

**Rationale**:
- Canvas must fill entire central area without visible borders
- Matches user expectation of seamless workspace
- Any padding/borders should be styling, not layout

---

## 4. Testing Strategy

### TDD Workflow Used

1. **RED Phase**: Wrote 18 failing tests before implementation
   - Tests couldn't even import (`ModuleNotFoundError`)
   - Defined expected behavior upfront

2. **GREEN Phase**: Implemented minimal code to pass tests
   - Created package structure
   - Implemented `SchematicCanvas` class
   - Updated `InkMainWindow`

3. **REFACTOR Phase**: Cleaned up code quality
   - Fixed type hints (mypy union-attr error)
   - Verified all tests still pass

### Test Coverage

| Category | Tests | Coverage |
|----------|-------|----------|
| Canvas Creation | 2 | Instantiation, QWidget inheritance |
| Canvas Parent | 2 | With parent, without parent |
| Canvas Layout | 2 | VBoxLayout, zero margins |
| Canvas Placeholder | 4 | Label, text, alignment, styling |
| MainWindow Integration | 4 | Central widget, attribute, matching |
| Parent Relationship | 2 | Parent set, findChildren |
| Visibility | 2 | Visible when shown, reasonable geometry |

---

## 5. Lessons Learned

### What Went Well

1. **TDD Discipline**: Writing tests first clarified requirements and caught edge cases (type hints)
2. **Atomic Implementation**: Small focused task (canvas placeholder only) was easy to complete
3. **Qt Patterns**: Following Qt conventions (parent ownership) made testing straightforward

### Challenges Encountered

1. **Type Hints with Optional**: `layout.contentsMargins()` required `assert layout is not None` to satisfy mypy
2. **Test Environment Setup**: Had to install dev dependencies with `uv sync --all-extras`

### Recommendations for Future

1. **E02 Implementation**: When replacing placeholder with `QGraphicsView`:
   - Keep `parent` parameter signature
   - Maintain `schematic_canvas` attribute name
   - Tests may need updating for new widget type

2. **Test Organization**: Canvas tests in `tests/unit/presentation/canvas/` mirrors source structure well

---

## 6. Related Documentation

- [E06-F01-T02.spec.md](E06-F01-T02.spec.md) - Original specification
- [E06-F01-T02.pre-docs.md](E06-F01-T02.pre-docs.md) - Pre-implementation planning
- [E06-F01-T02-implementation-narrative.md](E06-F01-T02-implementation-narrative.md) - Detailed walkthrough

---

## 7. Acceptance Criteria Verification

| Criterion | Status | Verification |
|-----------|--------|--------------|
| SchematicCanvas can be instantiated | ✅ | `test_canvas_can_be_created` |
| Canvas displays placeholder text | ✅ | `test_placeholder_text_contains_canvas_info` |
| Canvas is central widget | ✅ | `test_central_widget_is_schematic_canvas` |
| Canvas fills central area | ✅ | `test_canvas_layout_has_no_margins` |
| Canvas parent is InkMainWindow | ✅ | `test_canvas_parent_is_main_window` |
| Placeholder centered | ✅ | `test_placeholder_is_center_aligned` |
| Background is light gray | ✅ | `test_placeholder_has_styling` |
| Canvas in presentation layer | ✅ | File location verification |
| Canvas in canvas package | ✅ | Package structure verification |
| Canvas accepts parent param | ✅ | `test_canvas_accepts_parent_widget` |

---

## 8. Next Steps

Following tasks in E06-F01 (Main Window Shell):

1. **E06-F01-T03**: Dock Widgets Setup - Add hierarchy and property panels
2. **E06-F01-T04**: Main Entry Point - Integrate window into `main.py`

For actual schematic rendering:
- **E02 (Rendering Epic)**: Replace placeholder with `QGraphicsView`-based implementation
