# E06-F01-T01: QMainWindow Setup - Post-Implementation Documentation

## Spec Reference
[E06-F01-T01.spec.md](./E06-F01-T01.spec.md)

---

## 1. What We Built

Created the foundational `InkMainWindow` class that serves as the root container for the Ink application. This establishes the presentation layer with:

- Window title: "Ink - Incremental Schematic Viewer"
- Default size: 1600x900 (optimized for 1080p displays)
- Minimum size: 1024x768 (prevents unusable layouts)
- Standard window decorations (minimize, maximize, close)

---

## 2. Key Implementation Files

| File | Purpose |
|------|---------|
| `src/ink/presentation/main_window.py:1-111` | InkMainWindow class implementation |
| `tests/unit/presentation/test_main_window.py:1-130` | 13 test cases for all acceptance criteria |
| `tests/conftest.py:1-38` | Qt offscreen mode for headless testing |
| `pyproject.toml:1-227` | Strict typing config (TypeScript-level) |

---

## 3. Architecture Decisions

### Why QMainWindow instead of QWidget?

```python
# src/ink/presentation/main_window.py:29
class InkMainWindow(QMainWindow):
```

**Decision**: Extend `QMainWindow` instead of `QWidget`

**Rationale**:
- Built-in support for menu bar, toolbar, status bar, dock widgets
- Designed specifically for application main windows
- Handles window geometry persistence with QSettings
- Standard Qt pattern for professional applications

### Why Explicit Window Flags?

```python
# src/ink/presentation/main_window.py:92-100
self.setWindowFlags(
    Qt.WindowType.Window
    | Qt.WindowType.WindowTitleHint
    | Qt.WindowType.WindowSystemMenuHint
    | Qt.WindowType.WindowMinimizeButtonHint
    | Qt.WindowType.WindowMaximizeButtonHint
    | Qt.WindowType.WindowCloseButtonHint
)
```

**Decision**: Set window flags explicitly rather than relying on defaults

**Rationale**:
- Some Linux window managers need explicit flags
- Makes expected behavior explicit in code
- Ensures consistent decorations across platforms (X11, Wayland)

### Why TypeScript-Level Strict Typing?

**Decision**: Configure both mypy and pyright in strict mode

**Rationale**:
- Catches type errors early like TypeScript's `--strict`
- Ensures robust codebase from the start
- Pyright provides VS Code Pylance integration
- Combined checking catches more issues than either alone

---

## 4. Testing Strategy

### Test Organization

```
tests/unit/presentation/test_main_window.py
├── TestInkMainWindowCreation (2 tests)
│   ├── test_main_window_can_be_created
│   └── test_main_window_is_qmainwindow_subclass
├── TestInkMainWindowTitle (1 test)
│   └── test_window_title_is_set_correctly
├── TestInkMainWindowSize (5 tests)
│   ├── test_window_default_width_is_1600
│   ├── test_window_default_height_is_900
│   ├── test_window_minimum_width_is_1024
│   ├── test_window_minimum_height_is_768
│   └── test_window_cannot_be_resized_below_minimum
└── TestInkMainWindowFlags (5 tests)
    ├── test_window_has_title_hint
    ├── test_window_has_system_menu_hint
    ├── test_window_has_minimize_button_hint
    ├── test_window_has_maximize_button_hint
    └── test_window_has_close_button_hint
```

### Headless Qt Testing

```python
# tests/conftest.py:18-20
os.environ.setdefault("QT_QPA_PLATFORM", "offscreen")
```

**Why**: Qt widgets require a display server. Setting `offscreen` platform allows testing in CI environments without X11/Wayland.

---

## 5. Patterns Established

### 1. Class Constants for Configuration

```python
# src/ink/presentation/main_window.py:58-62
_WINDOW_TITLE: str = "Ink - Incremental Schematic Viewer"
_DEFAULT_WIDTH: int = 1600
_DEFAULT_HEIGHT: int = 900
_MIN_WIDTH: int = 1024
_MIN_HEIGHT: int = 768
```

**Pattern**: Use class-level constants for configuration values
**Benefit**: Makes requirements explicit, testable, and easy to modify

### 2. Private Setup Method

```python
# src/ink/presentation/main_window.py:64-70
def __init__(self) -> None:
    super().__init__()
    self._setup_window()
```

**Pattern**: Delegate initialization to private `_setup_*` methods
**Benefit**: Keeps `__init__` clean, allows subclass customization

### 3. Comprehensive Type Hints

```python
# All functions have complete type annotations
def _setup_window(self) -> None:
```

**Pattern**: Full type annotations on all methods
**Benefit**: Type safety, IDE autocompletion, documentation

---

## 6. Common Pitfalls Avoided

| Pitfall | How Avoided |
|---------|-------------|
| Qt tests fail without display | Set `QT_QPA_PLATFORM=offscreen` in conftest.py |
| Window flags vary by WM | Explicit flags set for consistency |
| Strict typing too verbose | Configured mypy/pyright once in pyproject.toml |
| Tests too coupled to implementation | Tests verify behavior, not implementation details |

---

## 7. Extension Points

### Adding Central Widget (E06-F01-T02)

```python
# Future: in main_window.py
from ink.presentation.canvas import SchematicCanvas

def _setup_central_widget(self) -> None:
    canvas = SchematicCanvas()
    self.setCentralWidget(canvas)
```

### Adding Dock Widgets (E06-F01-T03)

```python
# Future: in main_window.py
from ink.presentation.panels import HierarchyPanel, PropertyPanel

def _setup_docks(self) -> None:
    self.addDockWidget(Qt.DockWidgetArea.LeftDockWidgetArea, HierarchyPanel())
    self.addDockWidget(Qt.DockWidgetArea.RightDockWidgetArea, PropertyPanel())
```

---

## 8. Commands Reference

```bash
# Run tests
uv run pytest tests/ -v

# Type checking
uv run mypy src/ tests/
uv run pyright src/ tests/

# Linting
uv run ruff check src/ tests/

# Run application (future, after main.py)
uv run python -m ink
```
