# E06-F01-T03 - Dock Widget Setup: Post-Implementation Documentation

**Task**: E06-F01-T03 - Dock Widget Setup
**Date Completed**: 2025-12-26
**Status**: Completed
**Author**: Claude
**Estimated Hours**: 4
**Actual Hours**: ~2.5

---

## 1. Implementation Summary

### 1.1 What Was Implemented

Three dock widgets with placeholder panel content integrated into `InkMainWindow`:

| Component | Location | Purpose |
|-----------|----------|---------|
| `HierarchyPanel` | `src/ink/presentation/panels/hierarchy_panel.py` | Placeholder for object tree (E04-F01) |
| `PropertyPanel` | `src/ink/presentation/panels/property_panel.py` | Placeholder for property inspector (E04-F04) |
| `MessagePanel` | `src/ink/presentation/panels/message_panel.py` | Placeholder for search/log panel (E04-F03) |
| `panels/__init__.py` | `src/ink/presentation/panels/__init__.py` | Package exports |
| Dock setup | `src/ink/presentation/main_window.py` | `_setup_dock_widgets()` and related methods |

### 1.2 TDD Approach Used

**RED Phase**: Wrote 51 tests before implementation
- 18 unit tests for panel widgets
- 33 integration tests for dock configuration

**GREEN Phase**: Implemented to pass all tests
- Panel placeholder widgets with centered labels
- Dock widget creation and configuration in main window

**REFACTOR Phase**: Code review and cleanup
- Fixed type annotations for pytest fixtures
- Added comprehensive docstrings
- Updated pyproject.toml lint ignores for test patterns

---

## 2. Key Decisions Made

### 2.1 Separation of Panel and Dock Widgets

**Decision**: Create separate panel widgets (`HierarchyPanel`, etc.) that are set as content for `QDockWidget` containers.

**Rationale**:
- Standard Qt pattern - dock widget is container, panel is content
- Allows panels to be reused in other contexts if needed
- Enables independent testing of panel content
- Future panel implementations replace placeholder without touching dock setup

### 2.2 Allowed Area Restrictions

**Decision**: Restrict dock areas based on panel type:
- Hierarchy/Property: Left and Right only
- Message: Bottom only

**Rationale**:
- Vertical panels (tree views, property lists) fit better on sides
- Horizontal panels (log views, search results) fit better on bottom
- Prevents awkward layouts like message panel on the side
- Follows EDA tool conventions (Cadence, Synopsys patterns)

### 2.3 Object Names for State Persistence

**Decision**: Set explicit object names on dock widgets (`HierarchyDock`, `PropertyDock`, `MessageDock`).

**Rationale**:
- Required for `QMainWindow.saveState()` / `restoreState()` to work
- Qt uses object names to identify docks across sessions
- Enables E06-F05 (Panel State Persistence) without changes to dock setup

### 2.4 Minimum Sizes Instead of Exact Ratios

**Decision**: Use minimum sizes rather than exact pixel sizing.

**Rationale**:
- Qt's dock layout algorithm is complex and approximate
- Users will resize to their preference anyway
- Minimum sizes prevent unusable (too small) panels
- E06-F05 will save/restore exact sizes with QSettings

---

## 3. Files Changed

### 3.1 New Files Created

| File | Lines | Purpose |
|------|-------|---------|
| `src/ink/presentation/panels/__init__.py` | 29 | Package exports |
| `src/ink/presentation/panels/hierarchy_panel.py` | 93 | Hierarchy placeholder |
| `src/ink/presentation/panels/property_panel.py` | 93 | Property placeholder |
| `src/ink/presentation/panels/message_panel.py` | 93 | Message placeholder |
| `tests/unit/presentation/panels/__init__.py` | 1 | Test package |
| `tests/unit/presentation/panels/test_panels.py` | 208 | Panel unit tests |
| `tests/integration/presentation/test_main_window_docks.py` | 307 | Dock integration tests |

### 3.2 Files Modified

| File | Changes |
|------|---------|
| `src/ink/presentation/main_window.py` | Added dock widget setup (+170 lines) |
| `pyproject.toml` | Added test lint ignores |

---

## 4. Testing Summary

### 4.1 Test Results

```
============================= 118 passed in 1.60s ==============================
```

### 4.2 Test Coverage

| Test Category | Count | Description |
|---------------|-------|-------------|
| Panel Creation | 9 | Widget instantiation |
| Panel Layout | 6 | Layout and placeholder content |
| Panel Exports | 3 | Package exports |
| Dock Creation | 9 | Dock widget creation |
| Dock Position | 3 | Initial dock areas |
| Dock Allowed Areas | 3 | Area restrictions |
| Dock Object Names | 3 | State persistence readiness |
| Dock Visibility | 5 | Show/hide operations |
| Dock Features | 3 | Closable, movable, floatable |
| Dock Configuration | 1 | Nesting enabled |
| Dock Sizes | 6 | Minimum size constraints |

---

## 5. Lessons Learned

### 5.1 Qt Visibility Behavior

**Issue**: `isVisible()` returns `False` before window is shown.

**Solution**: Use `isHidden()` for tests that check widget hidden state without showing the window.

### 5.2 Type Annotations for Pytest Fixtures

**Issue**: Pytest fixtures using `yield` need `Generator` type hint.

**Solution**: Use `Generator[YieldType, None, None]` with `TYPE_CHECKING` import.

### 5.3 QApplication.instance() Type

**Issue**: `QApplication.instance()` returns `QCoreApplication | None`, not `QApplication`.

**Solution**: Add `isinstance(existing, QApplication)` check before yielding.

---

## 6. Integration Points

### 6.1 Upstream Dependencies (Used)

- `InkMainWindow` from E06-F01-T01
- `SchematicCanvas` (central widget) from E06-F01-T02

### 6.2 Downstream Dependencies (Provided)

| Consumer | What They Need |
|----------|----------------|
| E06-F01-T04 | Window with docks ready to show |
| E06-F02 | `toggleViewAction()` from dock widgets for View menu |
| E06-F05 | Object names set for `saveState()`/`restoreState()` |
| E04-F01 | Replace `HierarchyPanel` placeholder |
| E04-F03 | Replace `MessagePanel` placeholder |
| E04-F04 | Replace `PropertyPanel` placeholder |

---

## 7. Future Enhancements

### 7.1 Planned (E06-F05)

- Save/restore dock visibility, positions, and sizes
- "Reset Layout" command to restore defaults
- Exact sizing via `resizeDocks()` in `showEvent()`

### 7.2 Planned (E06-F02)

- View menu with panel toggle actions
- Keyboard shortcuts for panel visibility

### 7.3 Potential Improvements

- Custom title bar widgets (panel-specific actions)
- Dock tabs styling for tabbed dock arrangement
- Dock corner configuration

---

## 8. Quick Reference

### 8.1 Accessing Docks and Panels

```python
window = InkMainWindow()

# Dock widgets (containers)
window.hierarchy_dock  # QDockWidget
window.property_dock   # QDockWidget
window.message_dock    # QDockWidget

# Panel widgets (content)
window.hierarchy_panel  # HierarchyPanel
window.property_panel   # PropertyPanel
window.message_panel    # MessagePanel

# Toggle visibility
window.hierarchy_dock.close()    # Hide
window.hierarchy_dock.show()     # Show

# Check visibility state
window.hierarchy_dock.isHidden()  # True if explicitly hidden

# Get toggle action for menu
action = window.hierarchy_dock.toggleViewAction()
```

### 8.2 Dock Widget Configuration

```python
# Object names (for state persistence)
window.hierarchy_dock.objectName()  # "HierarchyDock"
window.property_dock.objectName()   # "PropertyDock"
window.message_dock.objectName()    # "MessageDock"

# Current dock area
window.dockWidgetArea(window.hierarchy_dock)  # Qt.LeftDockWidgetArea

# Allowed areas
window.hierarchy_dock.allowedAreas()  # Left | Right
window.message_dock.allowedAreas()    # Bottom only

# Dock features (all enabled by default)
window.hierarchy_dock.features()  # Closable | Movable | Floatable
```

---

**Document Status**: Complete
**Next Tasks**: E06-F01-T04 (Application Entry Point), E06-F02 (Menu System)
