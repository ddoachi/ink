---
id: E06-F01-T03
title: Dock Widget Setup
type: Task
priority: P0 (MVP)
status: Draft
parent: E06-F01
created: 2025-12-26
estimated_hours: 4
actual_hours:
effort: Medium
tags:
  - ui
  - pyside6
  - docking
  - panels
  - presentation
clickup_task_id: ''
---

# Spec: E06-F01-T03 - Dock Widget Setup

## 1. Overview

### 1.1 Problem Statement
EDA tools require supporting panels for navigation (hierarchy), inspection (properties), and information (messages). These panels must be dockable, resizable, closable, and floatable to support various workflows and screen configurations. Qt's `QDockWidget` provides this functionality but requires careful configuration for optimal UX.

### 1.2 Goals
- Create three dock widgets: Hierarchy (left), Properties (right), Messages (bottom)
- Configure dock areas, allowed positions, and default sizes
- Implement placeholder panels with identifying content
- Enable standard dock operations (close, float, move, resize)
- Set up proper panel size ratios matching UX requirements

---

## 2. Technical Requirements

### 2.1 Placeholder Panel Widgets

**Location**: `src/ink/presentation/panels/`

**Hierarchy Panel** (`hierarchy_panel.py`):
```python
from PySide6.QtWidgets import QWidget, QVBoxLayout, QLabel
from PySide6.QtCore import Qt


class HierarchyPanel(QWidget):
    """
    Design hierarchy and object tree panel.

    Placeholder for MVP main window setup.
    Full implementation in E04-F01 (Object Tree).
    """

    def __init__(self, parent=None):
        """Initialize hierarchy panel."""
        super().__init__(parent)
        self._setup_ui()

    def _setup_ui(self):
        """Setup placeholder UI."""
        layout = QVBoxLayout(self)

        placeholder = QLabel("Hierarchy Panel\n(Implementation: E04-F01)", self)
        placeholder.setAlignment(Qt.AlignmentFlag.AlignCenter)
        placeholder.setStyleSheet("QLabel { color: #666; padding: 10px; }")

        layout.addWidget(placeholder)
```

**Property Panel** (`property_panel.py`):
```python
from PySide6.QtWidgets import QWidget, QVBoxLayout, QLabel
from PySide6.QtCore import Qt


class PropertyPanel(QWidget):
    """
    Object property inspector panel.

    Placeholder for MVP main window setup.
    Full implementation in E04-F04 (Property Inspector).
    """

    def __init__(self, parent=None):
        """Initialize property panel."""
        super().__init__(parent)
        self._setup_ui()

    def _setup_ui(self):
        """Setup placeholder UI."""
        layout = QVBoxLayout(self)

        placeholder = QLabel("Property Panel\n(Implementation: E04-F04)", self)
        placeholder.setAlignment(Qt.AlignmentFlag.AlignCenter)
        placeholder.setStyleSheet("QLabel { color: #666; padding: 10px; }")

        layout.addWidget(placeholder)
```

**Message Panel** (`message_panel.py`):
```python
from PySide6.QtWidgets import QWidget, QVBoxLayout, QLabel
from PySide6.QtCore import Qt


class MessagePanel(QWidget):
    """
    Message log and search results panel.

    Placeholder for MVP main window setup.
    Full implementation in E04-F03 (Search Panel).
    """

    def __init__(self, parent=None):
        """Initialize message panel."""
        super().__init__(parent)
        self._setup_ui()

    def _setup_ui(self):
        """Setup placeholder UI."""
        layout = QVBoxLayout(self)

        placeholder = QLabel("Message Panel\n(Implementation: E04-F03)", self)
        placeholder.setAlignment(Qt.AlignmentFlag.AlignCenter)
        placeholder.setStyleSheet("QLabel { color: #666; padding: 10px; }")

        layout.addWidget(placeholder)
```

### 2.2 Main Window Dock Setup

**Location**: `src/ink/presentation/main_window.py` (add to existing)

```python
from PySide6.QtWidgets import QMainWindow, QDockWidget
from PySide6.QtCore import Qt, QSize
from ink.presentation.canvas.schematic_canvas import SchematicCanvas
from ink.presentation.panels.hierarchy_panel import HierarchyPanel
from ink.presentation.panels.property_panel import PropertyPanel
from ink.presentation.panels.message_panel import MessagePanel


class InkMainWindow(QMainWindow):
    """Main application window shell for Ink schematic viewer."""

    def __init__(self):
        """Initialize the main window."""
        super().__init__()
        self._setup_window()
        self._setup_central_widget()
        self._setup_dock_widgets()  # NEW

    def _setup_window(self):
        """Configure main window properties."""
        self.setWindowTitle("Ink - Incremental Schematic Viewer")
        self.resize(1600, 900)
        self.setMinimumSize(QSize(1024, 768))

    def _setup_central_widget(self):
        """Create and set central schematic canvas."""
        self.schematic_canvas = SchematicCanvas(self)
        self.setCentralWidget(self.schematic_canvas)

    def _setup_dock_widgets(self):  # NEW METHOD
        """Create and configure dockable panels."""
        # Left: Hierarchy panel
        self.hierarchy_panel = HierarchyPanel(self)
        self.hierarchy_dock = QDockWidget("Hierarchy", self)
        self.hierarchy_dock.setWidget(self.hierarchy_panel)
        self.hierarchy_dock.setAllowedAreas(
            Qt.DockWidgetArea.LeftDockWidgetArea |
            Qt.DockWidgetArea.RightDockWidgetArea
        )
        self.addDockWidget(Qt.DockWidgetArea.LeftDockWidgetArea, self.hierarchy_dock)

        # Right: Property panel
        self.property_panel = PropertyPanel(self)
        self.property_dock = QDockWidget("Properties", self)
        self.property_dock.setWidget(self.property_panel)
        self.property_dock.setAllowedAreas(
            Qt.DockWidgetArea.LeftDockWidgetArea |
            Qt.DockWidgetArea.RightDockWidgetArea
        )
        self.addDockWidget(Qt.DockWidgetArea.RightDockWidgetArea, self.property_dock)

        # Bottom: Message panel
        self.message_panel = MessagePanel(self)
        self.message_dock = QDockWidget("Messages", self)
        self.message_dock.setWidget(self.message_panel)
        self.message_dock.setAllowedAreas(Qt.DockWidgetArea.BottomDockWidgetArea)
        self.addDockWidget(Qt.DockWidgetArea.BottomDockWidgetArea, self.message_dock)

        # Set initial dock sizes using width ratios
        # Note: Exact sizing requires QSplitter or post-show resizing
        # This sets approximate ratios via dock widget size hints
        self._set_initial_dock_sizes()

    def _set_initial_dock_sizes(self):
        """Set initial size hints for dock widgets."""
        # Target ratios: Left 15%, Center 60%, Right 25%
        # For 1600px width: Left=240px, Center=960px, Right=400px

        # Hierarchy (left): 240px width
        self.hierarchy_dock.setMinimumWidth(150)
        self.hierarchy_panel.setMinimumSize(150, 200)

        # Property (right): 400px width
        self.property_dock.setMinimumWidth(200)
        self.property_panel.setMinimumSize(200, 200)

        # Message (bottom): 20% of height = ~180px
        self.message_dock.setMinimumHeight(100)
        self.message_panel.setMinimumSize(300, 100)
```

### 2.3 Panel Package Structure

```
src/ink/presentation/panels/
├── __init__.py
├── hierarchy_panel.py
├── property_panel.py
└── message_panel.py
```

**`__init__.py`** content:
```python
"""Panel widgets for supporting UI areas."""

from ink.presentation.panels.hierarchy_panel import HierarchyPanel
from ink.presentation.panels.property_panel import PropertyPanel
from ink.presentation.panels.message_panel import MessagePanel

__all__ = ["HierarchyPanel", "PropertyPanel", "MessagePanel"]
```

### 2.4 Dock Widget Configuration

| Panel | Location | Allowed Areas | Features |
|-------|----------|---------------|----------|
| **Hierarchy** | Left | Left, Right | Closable, Floatable, Movable |
| **Properties** | Right | Left, Right | Closable, Floatable, Movable |
| **Messages** | Bottom | Bottom | Closable, Floatable, Movable |

**Default behavior**:
- All panels visible on startup
- All panels closable via close button
- All panels can be undocked (floated) as separate windows
- All panels can be re-docked by dragging to allowed areas

---

## 3. Dependencies

### 3.1 Upstream
- Task E06-F01-T01: `InkMainWindow` class
- Task E06-F01-T02: Central widget setup (canvas)

### 3.2 Downstream
- Epic E04-F01: Will replace `HierarchyPanel` placeholder
- Epic E04-F04: Will replace `PropertyPanel` placeholder
- Epic E04-F03: Will replace `MessagePanel` placeholder
- Feature E06-F05: Panel state persistence (save/restore visibility, sizes)

### 3.3 External Dependencies
- PySide6: `QDockWidget`, `Qt.DockWidgetArea`

---

## 4. Acceptance Criteria

### 4.1 Functional Requirements
- [ ] Three dock widgets created: Hierarchy, Properties, Messages
- [ ] Hierarchy dock positioned on left by default
- [ ] Properties dock positioned on right by default
- [ ] Messages dock positioned on bottom by default
- [ ] All dock widgets display placeholder content
- [ ] Dock titles show correct labels

### 4.2 Dock Operations
- [ ] Each dock has visible close button (X)
- [ ] Clicking close button hides dock (can be restored via View menu in E06-F02)
- [ ] Each dock can be undocked by dragging title bar
- [ ] Undocked panels float as separate windows
- [ ] Floating panels can be re-docked by dragging to allowed areas
- [ ] Dock widget splitters are draggable to resize panels

### 4.3 Layout Requirements
- [ ] Hierarchy panel approximately 15% of window width
- [ ] Property panel approximately 25% of window width
- [ ] Message panel approximately 20% of window height
- [ ] Central canvas fills remaining space
- [ ] No gaps between docks and central widget

### 4.4 Testing
- [ ] Unit test: Each panel widget can be instantiated
- [ ] Integration test: Main window creates all three docks
- [ ] Integration test: Docks are positioned in correct areas
- [ ] Manual test: Dock close/float/re-dock operations work
- [ ] Manual test: Splitter resize works for all dock boundaries

---

## 5. Implementation Notes

### 5.1 Design Decisions

**Why separate panel widgets from dock widgets?**
- `QDockWidget` is the container providing docking behavior
- Panel widget (`HierarchyPanel`, etc.) contains actual content
- Separation allows panel to be used elsewhere if needed
- Standard Qt pattern for dock widgets

**Why restrict allowed dock areas?**
- Hierarchy/Properties make sense on sides (vertical lists)
- Messages makes sense on bottom (horizontal log view)
- Prevents awkward layouts (e.g., message log on side)
- Follows EDA tool conventions

**Why placeholders instead of full implementation?**
- Decouples main window structure from panel logic
- Allows UI layout to be tested independently
- Each panel has dedicated epic for full implementation
- Incremental development approach

**Why QDockWidget over manual splitters?**
- Qt's `QDockWidget` provides complex docking behavior automatically
- Handles undocking, redocking, tabbed docks, etc.
- Saves/restores state with `QSettings` easily
- Industry-standard for professional applications

### 5.2 Size Management Challenges

**Initial sizing**:
- Qt's dock layout is complex and sizes are approximate
- Exact pixel-perfect ratios require `QSplitter` or post-show geometry
- For MVP, minimum sizes ensure usability
- E06-F05 will add precise geometry persistence

**Approach**:
1. Set minimum sizes to prevent unusable panels
2. Let Qt's layout manager handle initial distribution
3. Users can manually resize to preference
4. Future feature: Save/restore exact splitter positions

### 5.3 Testing Strategy

**Unit Tests** (`tests/unit/presentation/panels/test_panels.py`):
```python
import pytest
from PySide6.QtWidgets import QApplication
from ink.presentation.panels.hierarchy_panel import HierarchyPanel
from ink.presentation.panels.property_panel import PropertyPanel
from ink.presentation.panels.message_panel import MessagePanel


@pytest.fixture(scope="module")
def qapp():
    app = QApplication.instance() or QApplication([])
    yield app


def test_hierarchy_panel_creation(qapp):
    panel = HierarchyPanel()
    assert panel is not None


def test_property_panel_creation(qapp):
    panel = PropertyPanel()
    assert panel is not None


def test_message_panel_creation(qapp):
    panel = MessagePanel()
    assert panel is not None
```

**Integration Tests** (`tests/integration/presentation/test_main_window_docks.py`):
```python
import pytest
from PySide6.QtWidgets import QApplication
from PySide6.QtCore import Qt
from ink.presentation.main_window import InkMainWindow


@pytest.fixture(scope="module")
def qapp():
    app = QApplication.instance() or QApplication([])
    yield app


def test_hierarchy_dock_exists(qapp):
    window = InkMainWindow()
    assert hasattr(window, 'hierarchy_dock')
    assert window.hierarchy_dock.windowTitle() == "Hierarchy"


def test_property_dock_exists(qapp):
    window = InkMainWindow()
    assert hasattr(window, 'property_dock')
    assert window.property_dock.windowTitle() == "Properties"


def test_message_dock_exists(qapp):
    window = InkMainWindow()
    assert hasattr(window, 'message_dock')
    assert window.message_dock.windowTitle() == "Messages"


def test_dock_areas(qapp):
    window = InkMainWindow()

    # Check hierarchy is on left
    assert window.dockWidgetArea(window.hierarchy_dock) == Qt.DockWidgetArea.LeftDockWidgetArea

    # Check property is on right
    assert window.dockWidgetArea(window.property_dock) == Qt.DockWidgetArea.RightDockWidgetArea

    # Check message is on bottom
    assert window.dockWidgetArea(window.message_dock) == Qt.DockWidgetArea.BottomDockWidgetArea
```

### 5.4 Future Enhancements

**E06-F05 (Panel Management)**:
- Save/restore dock visibility state
- Save/restore dock sizes and positions
- Add "View" menu to toggle panel visibility
- Add "Reset Layout" command

**Panel implementations**:
- E04-F01: Full hierarchy tree with expand/collapse
- E04-F04: Full property inspector with editable fields
- E04-F03: Full search panel with results list

---

## Revision History
| Date | Version | Author | Changes |
|------|---------|--------|---------|
| 2025-12-26 | 0.1 | Claude | Initial task creation from E06-F01 split |
