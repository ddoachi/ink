---
id: E06-F05-T03
title: Panel Toggle Actions
type: Task
priority: P0 (MVP)
status: Completed
parent: E06-F05
created: 2025-12-26
estimated_hours: 3
actual_hours:
effort: Low
tags:
  - ui
  - actions
  - menus
  - panels
clickup_task_id: '86evzm366'
---

# Spec: E06-F05-T03 - Panel Toggle Actions

## 1. Overview

### 1.1 Problem Statement
Implement View menu actions to show, hide, and toggle panel visibility. Users need keyboard shortcuts and menu items to control panel visibility without manually dragging panels. Qt's built-in `QDockWidget.toggleViewAction()` provides checkable actions that automatically sync with panel visibility state.

### 1.2 Goals
- Add panel toggle actions to View menu
- Use Qt's native `toggleViewAction()` for automatic state sync
- Provide keyboard shortcuts for panel toggles
- Show checkmarks next to visible panels in menu
- Enable quick workspace customization via keyboard
- Integrate with panel state manager for consistent behavior

---

## 2. Technical Requirements

### 2.1 View Menu Panel Actions

**Location**: `src/ink/presentation/main_window.py` (menu creation)

```python
def _create_view_menu(self):
    """Create View menu with panel toggles"""
    view_menu = self.menuBar().addMenu("&View")

    # Panels submenu
    panels_menu = view_menu.addMenu("&Panels")

    # Use Qt's built-in toggle actions from dock widgets
    # These automatically sync checkmarks with visibility
    self.hierarchy_toggle_action = self.hierarchy_dock.toggleViewAction()
    self.hierarchy_toggle_action.setShortcut("Ctrl+Shift+H")
    panels_menu.addAction(self.hierarchy_toggle_action)

    self.property_toggle_action = self.property_dock.toggleViewAction()
    self.property_toggle_action.setShortcut("Ctrl+Shift+P")
    panels_menu.addAction(self.property_toggle_action)

    self.message_toggle_action = self.message_dock.toggleViewAction()
    self.message_toggle_action.setShortcut("Ctrl+Shift+M")
    panels_menu.addAction(self.message_toggle_action)

    panels_menu.addSeparator()

    # Reset layout action
    reset_layout_action = QAction("&Reset Panel Layout", self)
    reset_layout_action.setShortcut("Ctrl+Shift+R")
    reset_layout_action.triggered.connect(self.reset_panel_layout)
    panels_menu.addAction(reset_layout_action)

    return view_menu
```

### 2.2 Panel Action Descriptions

| Action | Label | Shortcut | Behavior |
|--------|-------|----------|----------|
| Toggle Hierarchy | `&Hierarchy` | `Ctrl+Shift+H` | Show/hide hierarchy panel |
| Toggle Properties | `&Properties` | `Ctrl+Shift+P` | Show/hide properties panel |
| Toggle Messages | `&Messages` | `Ctrl+Shift+M` | Show/hide messages panel |
| Reset Layout | `&Reset Panel Layout` | `Ctrl+Shift+R` | Restore default panel arrangement |

### 2.3 Action State Synchronization

**Qt's toggleViewAction() features**:
- Automatically checkable (shows checkmark when panel visible)
- Text matches dock widget window title
- Triggers show/hide when clicked
- State syncs bidirectionally (menu â†” panel visibility)
- No manual signal handling needed

**Custom behavior additions**:

```python
def _setup_panel_action_behavior(self):
    """Configure additional behavior for panel actions"""

    # When panel shown via action, raise it to top
    self.hierarchy_toggle_action.triggered.connect(
        lambda: self._on_panel_toggled("Hierarchy")
    )
    self.property_toggle_action.triggered.connect(
        lambda: self._on_panel_toggled("Properties")
    )
    self.message_toggle_action.triggered.connect(
        lambda: self._on_panel_toggled("Messages")
    )

def _on_panel_toggled(self, panel_name: str):
    """Handle panel toggle action trigger"""
    # If panel was just shown, raise it to ensure visibility
    if self.panel_state_manager.is_panel_visible(panel_name):
        dock_map = {
            "Hierarchy": self.hierarchy_dock,
            "Properties": self.property_dock,
            "Messages": self.message_dock,
        }
        if panel_name in dock_map:
            dock_map[panel_name].raise_()
```

### 2.4 Keyboard Shortcut Conflict Resolution

**Shortcut Guidelines**:
- Use `Ctrl+Shift+<Letter>` for panel toggles to avoid conflicts
- First letter of panel name (H for Hierarchy, P for Properties, M for Messages)
- R for Reset (common UI pattern)
- Avoid conflicting with standard shortcuts (Ctrl+S, Ctrl+O, etc.)

**Shortcut Validation**:
```python
def _validate_shortcuts(self):
    """Check for shortcut conflicts (development aid)"""
    shortcuts = {}
    for action in self.findChildren(QAction):
        shortcut = action.shortcut().toString()
        if shortcut:
            if shortcut in shortcuts:
                print(f"WARNING: Shortcut conflict '{shortcut}': "
                      f"{shortcuts[shortcut]} vs {action.text()}")
            shortcuts[shortcut] = action.text()
```

### 2.5 Tooltip and Status Tip

```python
def _configure_panel_actions(self):
    """Configure tooltips and status tips for panel actions"""

    self.hierarchy_toggle_action.setToolTip(
        "Show or hide the hierarchy navigation panel"
    )
    self.hierarchy_toggle_action.setStatusTip(
        "Toggle hierarchy panel visibility (Ctrl+Shift+H)"
    )

    self.property_toggle_action.setToolTip(
        "Show or hide the property inspector panel"
    )
    self.property_toggle_action.setStatusTip(
        "Toggle property panel visibility (Ctrl+Shift+P)"
    )

    self.message_toggle_action.setToolTip(
        "Show or hide the message log panel"
    )
    self.message_toggle_action.setStatusTip(
        "Toggle message panel visibility (Ctrl+Shift+M)"
    )
```

---

## 3. Dependencies

### 3.1 Upstream
- E06-F05-T01 (Panel State Management) - Panel visibility state tracking
- E06-F02 (Menu System) - View menu exists
- QDockWidget instances created in main window setup

### 3.2 Downstream
- E06-F05-T04 (Default Layout Reset) - Reset layout action integration

### 3.3 External Dependencies
- PySide6 QAction and QMenu APIs
- Qt keyboard shortcut system

---

## 4. Acceptance Criteria

### 4.1 Functional Requirements
- [x] View menu contains "Panels" submenu
- [x] Hierarchy panel toggle action in Panels menu
- [x] Properties panel toggle action in Panels menu
- [x] Messages panel toggle action in Panels menu
- [x] Reset Panel Layout action in Panels menu
- [x] Separator before Reset Layout action for visual grouping

### 4.2 Action Behavior
- [x] Clicking action toggles panel visibility
- [x] Keyboard shortcuts work from any widget with focus
- [x] Checkmark appears next to visible panels
- [x] Checkmark disappears when panel hidden
- [x] Showing hidden panel brings it to front (raises)
- [x] Action state syncs when panel closed via X button
- [x] Action state syncs when panel visibility changed programmatically

### 4.3 Keyboard Shortcuts
- [x] `Ctrl+Shift+H` toggles Hierarchy panel
- [x] `Ctrl+Shift+P` toggles Properties panel
- [x] `Ctrl+Shift+M` toggles Messages panel
- [x] `Ctrl+Shift+R` resets panel layout
- [x] Shortcuts displayed in menu next to action text
- [x] No shortcut conflicts with other actions

### 4.4 Visual Polish
- [x] Tooltips appear on hover with descriptive text
- [x] Status bar shows shortcut hint when action hovered
- [x] Menu labels use mnemonic underscores (&Hierarchy)
- [x] Actions disabled if panels not initialized (defensive)

### 4.5 Testing
- [x] Unit tests for action creation and configuration
- [x] Test shortcut bindings are correctly assigned
- [x] Test action checkmark sync with panel visibility
- [x] Test raise behavior when showing hidden panel
- [x] UI test: click action, verify panel toggles
- [x] UI test: press shortcut, verify panel toggles
- [x] 80%+ code coverage on action-related code

---

## 5. Implementation Notes

### 5.1 Design Decisions

**Why use toggleViewAction() instead of custom QAction?**
- Qt provides automatic bidirectional state sync
- Less code, fewer bugs from manual state management
- Standard Qt pattern used by many applications
- Action text automatically matches dock widget title

**Why Ctrl+Shift instead of Ctrl alone?**
- Ctrl alone often reserved for standard actions (Save, Open, Quit)
- Ctrl+Shift is common for window/panel management
- Reduces risk of conflicts with future features

**Why raise panel when shown?**
- Ensures user sees result of their action
- Prevents confusion when panel is behind other panels/tabs
- Matches expected behavior in IDEs (VSCode, Qt Creator)

### 5.2 Alternative Approaches Considered

**Custom Toggle Actions**:
- More control over behavior
- Would require manual signal connections
- Prone to state sync bugs
- Not worth the complexity for standard functionality

**Toolbar Buttons**:
- Could add panel toggle buttons to toolbar
- Deferred to post-MVP (P1 feature)
- Menu actions sufficient for MVP

### 5.3 Testing Strategy

**Unit Tests** (`tests/unit/presentation/test_panel_actions.py`):
- Mock QDockWidget and test action creation
- Verify shortcuts assigned correctly
- Test action configuration (tooltips, status tips)

**UI Tests** (`tests/ui/test_panel_toggle_ui.py`):
- Use QTest to simulate menu clicks
- Use QTest to simulate keyboard shortcuts
- Verify panel visibility changes
- Test checkmark state updates

---

## Revision History
| Date | Version | Author | Changes |
|------|---------|--------|---------|
| 2025-12-26 | 0.1 | Claude | Initial task creation from E06-F05 split |
