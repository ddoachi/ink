# Pre-Implementation Documentation: E06-F05-T03 - Panel Toggle Actions

## Overview

### Problem Context
Users need efficient ways to control panel visibility beyond manually dragging or clicking close buttons. Modern IDEs and professional applications provide menu-based panel toggles with keyboard shortcuts for rapid workspace customization. Qt's `QDockWidget` includes built-in `toggleViewAction()` that provides automatic bidirectional state synchronization between UI actions and panel visibility, eliminating complex manual signal wiring.

This task leverages Qt's native functionality to provide a polished panel control experience with minimal code.

### Goal Summary
Implement View menu panel controls that:
1. Use Qt's native `toggleViewAction()` for automatic state sync
2. Provide keyboard shortcuts for each panel (Ctrl+Shift+H/P/M)
3. Show checkmarks next to visible panels in menu
4. Raise panels to front when shown via action
5. Include "Reset Panel Layout" action with shortcut
6. Follow Qt best practices for action configuration

## Implementation Approach

### High-Level Strategy

**Leverage Qt's Built-in Functionality**:
- Use `QDockWidget.toggleViewAction()` instead of custom `QAction` instances
- Qt automatically handles checkmark state, text label, and show/hide behavior
- Bidirectional sync: action ↔ panel visibility (no manual signal wiring needed)
- Add keyboard shortcuts and tooltips to enhance built-in actions

**Menu Structure**:
```
View
└── Panels
    ├── Hierarchy         (Ctrl+Shift+H) [✓]
    ├── Properties        (Ctrl+Shift+P) [✓]
    ├── Messages          (Ctrl+Shift+M) [ ]
    ├── ─────────────
    └── Reset Panel Layout (Ctrl+Shift+R)
```

**Enhancement Pattern**:
1. Get action from dock widget: `action = dock.toggleViewAction()`
2. Add shortcut: `action.setShortcut("Ctrl+Shift+H")`
3. Add tooltip/status tip: `action.setToolTip("Show or hide...")`
4. Connect custom behavior: `action.triggered.connect(lambda: raise_panel())`
5. Add to menu: `menu.addAction(action)`

### Component Breakdown

#### 1. View Menu Creation

**Location**: `src/ink/presentation/main_window.py`

**Menu Structure**:
```python
def _create_view_menu(self):
    """Create View menu with panel toggles"""
    view_menu = self.menuBar().addMenu("&View")

    # Panels submenu
    panels_menu = view_menu.addMenu("&Panels")

    # Get toggle actions from dock widgets
    self.hierarchy_toggle_action = self.hierarchy_dock.toggleViewAction()
    self._configure_panel_action(
        self.hierarchy_toggle_action,
        "Ctrl+Shift+H",
        "hierarchy navigation"
    )
    panels_menu.addAction(self.hierarchy_toggle_action)

    self.property_toggle_action = self.property_dock.toggleViewAction()
    self._configure_panel_action(
        self.property_toggle_action,
        "Ctrl+Shift+P",
        "property inspector"
    )
    panels_menu.addAction(self.property_toggle_action)

    self.message_toggle_action = self.message_dock.toggleViewAction()
    self._configure_panel_action(
        self.message_toggle_action,
        "Ctrl+Shift+M",
        "message log"
    )
    panels_menu.addAction(self.message_toggle_action)

    panels_menu.addSeparator()

    # Reset layout action
    reset_layout_action = QAction("&Reset Panel Layout", self)
    reset_layout_action.setShortcut("Ctrl+Shift+R")
    reset_layout_action.setToolTip("Restore panels to default layout")
    reset_layout_action.setStatusTip(
        "Reset all panels to default positions and sizes (Ctrl+Shift+R)"
    )
    reset_layout_action.triggered.connect(self.reset_panel_layout)
    panels_menu.addAction(reset_layout_action)

    return view_menu
```

**Helper Method**:
```python
def _configure_panel_action(
    self,
    action: QAction,
    shortcut: str,
    panel_description: str
):
    """Configure keyboard shortcut and tooltips for panel action"""
    action.setShortcut(shortcut)
    action.setToolTip(f"Show or hide the {panel_description} panel")
    action.setStatusTip(
        f"Toggle {panel_description} panel visibility ({shortcut})"
    )
```

#### 2. Raise Panel on Show Behavior

**Problem**: When user toggles hidden panel visible, it may be behind other panels/tabs

**Solution**: Connect to action trigger and raise panel if it became visible

```python
def _setup_panel_action_behavior(self):
    """Configure additional behavior for panel actions"""

    # Connect to triggered signal (after built-in show/hide)
    self.hierarchy_toggle_action.triggered.connect(
        lambda: self._on_panel_toggled("Hierarchy")
    )
    self.property_toggle_action.triggered.connect(
        lambda: self._on_panel_toggled("Properties")
    )
    self.message_toggle_action.triggered.connect(
        lambda: self._on_panel_toggled("Messages")
    )

def _on_panel_toggled(self, panel_name: str):
    """Handle panel toggle action trigger"""
    # If panel was just shown, raise it to ensure visibility
    if self.panel_state_manager.is_panel_visible(panel_name):
        dock_map = {
            "Hierarchy": self.hierarchy_dock,
            "Properties": self.property_dock,
            "Messages": self.message_dock,
        }
        if panel_name in dock_map:
            dock_map[panel_name].raise_()
```

**Signal Timing**:
- `triggered` signal emitted after visibility change
- Check `is_panel_visible()` to determine if panel was shown (vs. hidden)
- Only raise if visible (no-op if panel was hidden)

#### 3. Keyboard Shortcut Design

**Shortcut Convention**: `Ctrl+Shift+<Letter>`

**Rationale**:
- `Ctrl` alone reserved for standard actions (Save, Open, Quit, Undo)
- `Ctrl+Shift` commonly used for window/view management in IDEs
- First letter mnemonic (H = Hierarchy, P = Properties, M = Messages, R = Reset)
- Cross-platform compatible (Qt translates to Cmd on macOS)

**Conflict Prevention**:
```python
def _validate_shortcuts(self):
    """Check for shortcut conflicts (development aid)"""
    shortcuts = {}
    for action in self.findChildren(QAction):
        shortcut = action.shortcut().toString()
        if shortcut:
            if shortcut in shortcuts:
                print(f"WARNING: Shortcut conflict '{shortcut}': "
                      f"{shortcuts[shortcut]} vs {action.text()}")
            shortcuts[shortcut] = action.text()
```

**Call in Debug Mode**:
```python
def __init__(self):
    # ... setup ...
    if os.getenv("INK_DEBUG"):
        self._validate_shortcuts()
```

#### 4. Action State Synchronization

**Qt's toggleViewAction() Features** (no custom code needed):
- Action is automatically checkable
- Checkmark appears when panel visible
- Action text matches dock widget `windowTitle()`
- Triggering action calls `QDockWidget.setVisible(!isVisible())`
- Dock widget visibility change updates action check state
- Bidirectional sync handled by Qt internally

**Custom Enhancements**:
- Keyboard shortcuts (Qt doesn't add these automatically)
- Tooltips and status tips (Qt provides basic text only)
- Raise behavior (Qt shows panel but doesn't bring to front)

#### 5. Menu Mnemonics

**Mnemonic Underscores**:
```python
panels_menu = view_menu.addMenu("&Panels")  # Alt+V, P
action.setText("&Hierarchy")                # H key when menu open
action.setText("&Properties")               # P key when menu open
action.setText("&Messages")                 # M key when menu open
action.setText("&Reset Panel Layout")       # R key when menu open
```

**Note**: `toggleViewAction()` uses dock widget's `windowTitle()`, which should include `&` mnemonic:
```python
dock = QDockWidget("&Hierarchy", self)  # Sets both title and action text
```

### Key Design Decisions

#### Decision 1: toggleViewAction() vs. Custom QAction

**Chosen**: Use Qt's `toggleViewAction()`

**Rationale**:
- **Automatic State Sync**: Qt handles bidirectional synchronization (menu ↔ panel)
- **Less Code**: No manual signal connections for basic show/hide
- **Fewer Bugs**: Manual state sync prone to edge cases (user closes via X, drag-undock)
- **Standard Pattern**: Used by Qt Creator, KDE apps, other Qt applications
- **Built-in Features**: Checkable, text from window title, basic functionality

**Trade-off**: Less control over action behavior vs. robustness and simplicity

**When Custom Action Would Be Needed**:
- Action behavior differs from simple show/hide
- Action text should differ from dock widget title
- Multiple actions control same panel

#### Decision 2: Ctrl+Shift vs. Ctrl for Shortcuts

**Chosen**: `Ctrl+Shift+<Letter>`

**Rationale**:
- **Standard Actions**: `Ctrl+<Letter>` reserved for File/Edit operations (Ctrl+S, Ctrl+O, Ctrl+Z)
- **Window Management Convention**: IDEs use Ctrl+Shift for view/panel toggles
  - VSCode: Ctrl+Shift+E (Explorer), Ctrl+Shift+D (Debug)
  - Qt Creator: Ctrl+Shift+L (Locator)
- **Future Proofing**: Leaves Ctrl shortcuts available for core features
- **Muscle Memory**: Users expect this pattern from other tools

**Alternative Considered**: Function keys (F1-F12) - less discoverable, varies by platform

#### Decision 3: Raise Panel on Show

**Chosen**: Raise panel when shown via action

**Rationale**:
- **User Expectation**: When user triggers "show panel", they expect to see it
- **Tabbed Panels**: Panel may be hidden behind tab group
- **Floating Panels**: May be behind other windows
- **IDE Pattern**: VSCode, IntelliJ, Qt Creator all raise panels on toggle
- **Feedback**: Confirms action had effect (user sees change)

**Implementation**: Call `raise_()` after checking visibility

#### Decision 4: Separator Before Reset

**Chosen**: Visual separator before "Reset Panel Layout"

**Rationale**:
- **Grouping**: Separates toggle actions (non-destructive) from reset (destructive)
- **Visual Clarity**: Makes reset action stand out as special
- **Standard Pattern**: Common in application menus (File menu has separator before Exit)

**Implementation**: `panels_menu.addSeparator()`

## Dependencies and Integration Points

### Upstream Dependencies

**E06-F05-T01 (Panel State Management)**:
- Provides `PanelStateManager.is_panel_visible(name)` for raise logic
- Provides `show_panel()`, `hide_panel()`, `toggle_panel()` methods (optional API)

**E06-F02 (Menu System)**:
- Main window has menu bar (`self.menuBar()`)
- View menu creation pattern established

**E06-F01 (Main Window Shell)**:
- Dock widgets created and added to main window
- Dock widgets have proper `windowTitle()` set

### Downstream Dependencies

**E06-F05-T04 (Default Layout Reset)**:
- Uses `reset_panel_layout()` action created in this task
- Keyboard shortcut (Ctrl+Shift+R) triggers reset

**Future Features**:
- Toolbar panel buttons could reuse same toggle actions
- Context menu on panels could include "Hide Panel" using toggle action

### Integration Sequence

1. Main window creates dock widgets with titles (E06-F01)
2. Dock widgets added to main window
3. Panel state manager initialized and panels registered (T01)
4. `_create_view_menu()` called during menu bar setup
5. Toggle actions retrieved from dock widgets
6. Actions configured with shortcuts and tooltips
7. Actions added to Panels submenu
8. `_setup_panel_action_behavior()` called to add raise logic
9. Menu displayed, actions functional

## Testing Strategy

### Unit Tests

**Location**: `tests/unit/presentation/test_panel_actions.py`

**Mock-Based Tests**:
```python
@pytest.fixture
def mock_dock_widget():
    """Mock QDockWidget with toggle action"""
    dock = MagicMock(spec=QDockWidget)

    # Mock toggleViewAction
    action = MagicMock(spec=QAction)
    action.shortcut.return_value = MagicMock(toString=lambda: "")
    dock.toggleViewAction.return_value = action

    dock.isVisible.return_value = True
    dock.windowTitle.return_value = "Test Panel"

    return dock

def test_create_view_menu_adds_panel_actions(mock_dock_widget):
    """Test that panel actions are added to menu"""
    window = MagicMock(spec=InkMainWindow)
    window.hierarchy_dock = mock_dock_widget

    # Call menu creation
    window._create_view_menu()

    # Verify toggleViewAction called
    mock_dock_widget.toggleViewAction.assert_called_once()

    # Verify action configured
    action = mock_dock_widget.toggleViewAction.return_value
    action.setShortcut.assert_called_with("Ctrl+Shift+H")
    action.setToolTip.assert_called()
    action.setStatusTip.assert_called()

def test_panel_action_shortcuts_assigned():
    """Test that shortcuts are correctly assigned"""
    # Create mock actions
    hierarchy_action = MagicMock()
    property_action = MagicMock()
    message_action = MagicMock()

    # Configure
    _configure_panel_action(hierarchy_action, "Ctrl+Shift+H", "hierarchy")

    # Verify
    hierarchy_action.setShortcut.assert_called_with("Ctrl+Shift+H")

def test_raise_panel_when_shown():
    """Test that panel is raised when shown via action"""
    # Mock components
    dock = MagicMock()
    dock.isVisible.return_value = True

    state_manager = MagicMock()
    state_manager.is_panel_visible.return_value = True

    window = MagicMock()
    window.panel_state_manager = state_manager
    window.hierarchy_dock = dock

    # Trigger toggle
    window._on_panel_toggled("Hierarchy")

    # Verify raise called
    dock.raise_.assert_called_once()

def test_no_raise_when_hidden():
    """Test that panel not raised when hidden via action"""
    # Mock components
    dock = MagicMock()
    state_manager = MagicMock()
    state_manager.is_panel_visible.return_value = False

    window = MagicMock()
    window.panel_state_manager = state_manager
    window.hierarchy_dock = dock

    # Trigger toggle
    window._on_panel_toggled("Hierarchy")

    # Verify raise NOT called
    dock.raise_.assert_not_called()
```

**Coverage Target**: 80%+ (action creation and configuration logic)

### UI Tests

**Location**: `tests/ui/test_panel_toggle_ui.py`

**Qt Test Framework Tests**:
```python
@pytest.fixture
def main_window(qtbot):
    """Create real main window for UI testing"""
    app = QApplication.instance() or QApplication([])
    window = InkMainWindow()
    qtbot.addWidget(window)
    window.show()
    qtbot.waitExposed(window)
    return window

def test_menu_click_toggles_panel(main_window, qtbot):
    """Test clicking menu action toggles panel visibility"""
    # Get initial state
    initial_visible = main_window.hierarchy_dock.isVisible()

    # Click menu action
    action = main_window.hierarchy_toggle_action
    action.trigger()

    # Wait for UI update
    qtbot.wait(100)

    # Verify toggled
    assert main_window.hierarchy_dock.isVisible() == (not initial_visible)

def test_keyboard_shortcut_toggles_panel(main_window, qtbot):
    """Test keyboard shortcut toggles panel visibility"""
    # Get initial state
    initial_visible = main_window.hierarchy_dock.isVisible()

    # Simulate keyboard shortcut
    qtbot.keyPress(main_window, Qt.Key_H, Qt.ControlModifier | Qt.ShiftModifier)

    # Wait for UI update
    qtbot.wait(100)

    # Verify toggled
    assert main_window.hierarchy_dock.isVisible() == (not initial_visible)

def test_action_checkmark_syncs_with_visibility(main_window, qtbot):
    """Test action checkmark updates when panel visibility changes"""
    # Hide panel directly (via close button simulation)
    main_window.hierarchy_dock.hide()
    qtbot.wait(100)

    # Check action is unchecked
    assert not main_window.hierarchy_toggle_action.isChecked()

    # Show panel
    main_window.hierarchy_dock.show()
    qtbot.wait(100)

    # Check action is checked
    assert main_window.hierarchy_toggle_action.isChecked()

def test_panel_raised_when_shown(main_window, qtbot):
    """Test panel is raised to front when shown via action"""
    # Hide panel
    main_window.hierarchy_dock.hide()
    qtbot.wait(100)

    # Trigger action
    main_window.hierarchy_toggle_action.trigger()
    qtbot.wait(100)

    # Verify visible and raised
    assert main_window.hierarchy_dock.isVisible()
    # Note: Verifying raise is difficult, but visibility confirms basic behavior

def test_no_shortcut_conflicts(main_window):
    """Test that no keyboard shortcuts conflict"""
    shortcuts = {}
    for action in main_window.findChildren(QAction):
        shortcut_str = action.shortcut().toString()
        if shortcut_str:
            assert shortcut_str not in shortcuts, \
                f"Shortcut conflict: {shortcut_str} used by {action.text()} and {shortcuts.get(shortcut_str)}"
            shortcuts[shortcut_str] = action.text()
```

**Coverage Target**: 85%+ (real UI interaction coverage)

### Manual Testing Checklist

**Menu Interaction**:
- [ ] Open View > Panels menu, verify all panel actions present
- [ ] Verify separator before "Reset Panel Layout"
- [ ] Verify checkmarks next to visible panels
- [ ] Click Hierarchy action, verify panel toggles visibility
- [ ] Click Properties action, verify panel toggles
- [ ] Click Messages action, verify panel toggles
- [ ] Verify checkmark state updates after each click

**Keyboard Shortcuts**:
- [ ] Press Ctrl+Shift+H, verify Hierarchy panel toggles
- [ ] Press Ctrl+Shift+P, verify Properties panel toggles
- [ ] Press Ctrl+Shift+M, verify Messages panel toggles
- [ ] Press Ctrl+Shift+R, verify reset dialog appears
- [ ] Verify shortcuts work from any focused widget (canvas, panel, menu)

**Raise Behavior**:
- [ ] Hide Hierarchy panel
- [ ] Toggle visible via action
- [ ] Verify panel appears and is on top (not behind other panels)
- [ ] Tab Hierarchy and Properties together
- [ ] Hide Hierarchy tab
- [ ] Toggle visible via action
- [ ] Verify Hierarchy tab is selected (raised)

**State Synchronization**:
- [ ] Hide panel via close button (X)
- [ ] Verify menu action checkmark disappears
- [ ] Show panel via action
- [ ] Verify checkmark reappears
- [ ] Drag panel to floating state
- [ ] Verify action still toggles visibility correctly

**Tooltips and Status Bar**:
- [ ] Hover over Hierarchy action, verify tooltip appears
- [ ] Hover over action, verify status bar shows description with shortcut
- [ ] Repeat for Properties and Messages actions
- [ ] Verify tooltip text is descriptive and helpful

## Risks and Considerations

### Risk 1: toggleViewAction() Text Mismatch

**Issue**: Action text comes from dock widget `windowTitle()`, which may not match desired menu text

**Example**: Dock title "Hierarchy Panel" but menu should say "Hierarchy"

**Mitigation**:
- Set dock widget title to desired menu text
- Dock widget title bar shows same text (consistent)
- If different text needed, use custom QAction instead

**Likelihood**: Low (title and menu text usually match)
**Impact**: Low (cosmetic, easy to fix)

### Risk 2: Shortcut Conflicts

**Issue**: Future features may need Ctrl+Shift+<Letter> shortcuts, causing conflicts

**Mitigation**:
- `_validate_shortcuts()` helper detects conflicts at runtime
- Run in debug mode during development
- Document used shortcuts in code comments
- Choose less common letters if conflicts arise (e.g., Ctrl+Shift+1/2/3)

**Likelihood**: Medium (as feature set grows)
**Impact**: Low (detected early, easy to reassign)

### Risk 3: Raise Behavior on Tabbed Panels

**Issue**: `raise_()` may not correctly bring panel to front in complex tab scenarios

**Example**: Panel tabbed with 3 others, calling `raise_()` may not select correct tab

**Mitigation**:
- Qt's `raise_()` should handle tab selection
- Integration testing with real tabbed panels
- Fallback: Use `setFocus()` if `raise_()` insufficient

**Likelihood**: Low (Qt API designed for this)
**Impact**: Low (panel becomes visible even if not raised)

### Risk 4: Platform-Specific Shortcut Behavior

**Issue**: Ctrl+Shift+<Letter> may conflict with OS shortcuts on some platforms

**Example**: Some Linux window managers use Ctrl+Shift+<Letter> for workspace switching

**Mitigation**:
- Qt translates Ctrl to Cmd on macOS (no conflict)
- Document known conflicts in user guide
- Allow shortcut customization in future (P1 feature)

**Likelihood**: Low (Ctrl+Shift relatively safe)
**Impact**: Low (users can use menu if shortcut conflicts)

### Risk 5: Mnemonic Conflicts

**Issue**: Multiple menu items with same mnemonic letter (e.g., &Properties and &Panels)

**Current Design**:
- Panels submenu: &Panels (P)
- Hierarchy action: &Hierarchy (H)
- Properties action: &Properties (P)
- Messages action: &Messages (M)
- Reset action: &Reset (R)

**Conflict**: "Panels" and "Properties" both use P

**Mitigation**:
- Different menu levels (View > &Panels is submenu, &Properties is within submenu)
- Qt handles same mnemonic at different levels correctly
- Alternative: Change submenu to "&Panel Visibility" (no conflict)

**Likelihood**: Low (Qt handles hierarchical mnemonics)
**Impact**: Very Low (cosmetic, keyboard navigation still works)

## Open Questions

### Question 1: Should Toolbar Include Panel Toggles?

**Question**: Should panel toggle actions also appear in toolbar as buttons?

**Current Scope**: Menu only (MVP)

**Consideration**:
- Same `QAction` instances can be added to toolbar
- Toolbar buttons provide faster access (single click vs. menu navigation)
- But consume toolbar space

**Recommendation**: Defer to P1, focus on menu for MVP

### Question 2: Should Reset Require Confirmation?

**Question**: Should "Reset Panel Layout" action show confirmation dialog?

**Current Spec**: Implemented in E06-F05-T04 (separate task)

**This Task Scope**: Only create the action, connect to `reset_panel_layout()` method

**Recommendation**: Leave confirmation logic to T04

### Question 3: Should We Support Custom Shortcuts?

**Question**: Should users be able to customize keyboard shortcuts in settings?

**Current Scope**: Hardcoded shortcuts

**Consideration**:
- Qt supports `QKeySequenceEdit` for user-defined shortcuts
- Would require settings persistence and shortcut manager
- Significant scope increase

**Recommendation**: Defer to P1, use hardcoded shortcuts for MVP

### Question 4: Context Menu on Panel Title Bars?

**Question**: Should dock widget title bars have context menu with toggle actions?

**Current Scope**: Menu bar only

**Consideration**:
- Right-click on dock title bar could show context menu
- Context menu could include "Hide This Panel", "Reset Layout"
- Qt provides `QDockWidget.contextMenuEvent()` override point

**Recommendation**: Defer to P1 (nice-to-have, not essential)

## Implementation Checklist

### Phase 1: Menu Structure
- [ ] Create `_create_view_menu()` method in main window
- [ ] Add "View" top-level menu to menu bar
- [ ] Create "Panels" submenu under View
- [ ] Add mnemonic underscores to menu labels
- [ ] Test menu appears and opens correctly

### Phase 2: Panel Toggle Actions
- [ ] Get toggle action from `hierarchy_dock.toggleViewAction()`
- [ ] Get toggle action from `property_dock.toggleViewAction()`
- [ ] Get toggle action from `message_dock.toggleViewAction()`
- [ ] Store actions in instance variables (`self.hierarchy_toggle_action`, etc.)
- [ ] Add actions to Panels submenu
- [ ] Test actions appear in menu with dock widget titles

### Phase 3: Action Configuration
- [ ] Create `_configure_panel_action()` helper method
- [ ] Set keyboard shortcuts for each action
- [ ] Set tooltips for each action
- [ ] Set status tips for each action
- [ ] Call helper for all three panel actions
- [ ] Test shortcuts displayed in menu
- [ ] Test tooltips appear on hover

### Phase 4: Raise Behavior
- [ ] Create `_setup_panel_action_behavior()` method
- [ ] Create `_on_panel_toggled(panel_name)` handler
- [ ] Connect hierarchy action `triggered` signal to handler
- [ ] Connect property action `triggered` signal to handler
- [ ] Connect message action `triggered` signal to handler
- [ ] Implement raise logic using `panel_state_manager.is_panel_visible()`
- [ ] Test panels raised when shown via action

### Phase 5: Reset Action
- [ ] Create "Reset Panel Layout" QAction
- [ ] Set keyboard shortcut (Ctrl+Shift+R)
- [ ] Set tooltip and status tip
- [ ] Connect to `reset_panel_layout()` method (implemented in T04)
- [ ] Add separator before reset action
- [ ] Add reset action to Panels submenu
- [ ] Test reset action appears and triggers correctly

### Phase 6: Shortcut Validation
- [ ] Create `_validate_shortcuts()` helper method
- [ ] Iterate all QActions, collect shortcuts
- [ ] Detect and log conflicts
- [ ] Call in `__init__` when `INK_DEBUG` environment variable set
- [ ] Test validation detects intentional conflict
- [ ] Document used shortcuts in code comments

### Phase 7: Testing
- [ ] Write unit tests for action creation (mocked)
- [ ] Write unit tests for action configuration
- [ ] Write UI tests for menu interaction
- [ ] Write UI tests for keyboard shortcuts
- [ ] Write UI tests for checkmark synchronization
- [ ] Write UI tests for raise behavior
- [ ] Complete manual testing checklist
- [ ] Achieve 80%+ unit test coverage
- [ ] Achieve 85%+ UI test coverage

### Phase 8: Integration and Polish
- [ ] Integrate menu creation into main window initialization
- [ ] Call `_create_view_menu()` in menu bar setup
- [ ] Call `_setup_panel_action_behavior()` after dock widget setup
- [ ] Test full application with panel toggles
- [ ] Verify all acceptance criteria met
- [ ] Test shortcut conflicts with existing actions
- [ ] Verify cross-platform compatibility (if possible)

## Success Metrics

**Functional Completeness**:
- View > Panels menu exists with all three panel actions
- Keyboard shortcuts work for all panels (Ctrl+Shift+H/P/M)
- Checkmarks sync with panel visibility automatically
- Panels raised to front when shown via action
- Reset Panel Layout action present with shortcut

**Code Quality**:
- 80%+ unit test coverage on action-related code
- 85%+ UI test coverage on menu interaction
- All type hints present and passing mypy
- Zero ruff linting errors
- All public methods have docstrings

**User Experience**:
- Action trigger is instant (no perceptible lag)
- Checkmarks update immediately when panel visibility changes
- Keyboard shortcuts work regardless of focused widget
- Tooltips and status bar provide helpful information
- Menu follows standard Qt conventions (mnemonics, separators)

**Polish**:
- No shortcut conflicts (validated via `_validate_shortcuts()`)
- Consistent action naming and labeling
- Proper use of Qt's built-in functionality (minimal custom code)
- Graceful handling of missing panels (defensive programming)
