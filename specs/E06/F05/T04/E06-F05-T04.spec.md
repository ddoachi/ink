---
id: E06-F05-T04
title: Default Layout Reset
type: Task
priority: P0 (MVP)
status: Draft
parent: E06-F05
created: 2025-12-26
estimated_hours: 2
actual_hours:
effort: Low
tags:
  - ui
  - panels
  - reset
  - defaults
clickup_task_id: ''
---

# Spec: E06-F05-T04 - Default Layout Reset

## 1. Overview

### 1.1 Problem Statement
Users may customize panel layouts to the point of confusion or unusability (e.g., accidentally hiding all panels, creating complex tab arrangements). A "Reset Panel Layout" feature restores the default panel arrangement, providing a recovery mechanism and returning to a known-good state.

### 1.2 Goals
- Implement reset to default panel layout functionality
- Clear all saved panel state from QSettings
- Restore panels to initial positions (hierarchy left, properties right, messages bottom)
- Ensure all panels are visible after reset
- Apply default panel sizes (15%, 25%, 20% respectively)
- Provide user confirmation before destructive reset
- Make reset accessible via View menu and keyboard shortcut

---

## 2. Technical Requirements

### 2.1 Default Layout Specification

**Default Panel Configuration**:

| Panel | Area | Size | Visibility | Allowed Areas |
|-------|------|------|------------|---------------|
| Hierarchy | Left | 15% width | Visible | Left, Right |
| Properties | Right | 25% width | Visible | Left, Right |
| Messages | Bottom | 20% height | Visible | Bottom only |

**Layout State**:
- No panels floating (all docked)
- No panels tabbed together
- No panels hidden
- Panels in separate dock areas (not stacked)

### 2.2 Reset Implementation

**Location**: `src/ink/presentation/main_window.py` (additions)

```python
from PySide6.QtWidgets import QMessageBox

class InkMainWindow(QMainWindow):

    def reset_panel_layout(self):
        """
        Reset panel layout to default configuration.

        Clears saved settings and restores default panel arrangement.
        """
        # Ask for confirmation
        result = QMessageBox.question(
            self,
            "Reset Panel Layout",
            "This will reset all panels to their default positions and sizes.\n"
            "Any custom layout will be lost.\n\n"
            "Continue?",
            QMessageBox.StandardButton.Yes | QMessageBox.StandardButton.No,
            QMessageBox.StandardButton.No  # Default to No for safety
        )

        if result != QMessageBox.StandardButton.Yes:
            return

        # Clear saved panel state
        self.panel_settings_store.clear_panel_state()

        # Reset to default layout
        self._apply_default_panel_layout()

    def _apply_default_panel_layout(self):
        """Apply the default panel layout configuration"""

        # 1. Remove all dock widgets temporarily to clear state
        self.removeDockWidget(self.hierarchy_dock)
        self.removeDockWidget(self.property_dock)
        self.removeDockWidget(self.message_dock)

        # 2. Re-add in default positions
        self.addDockWidget(Qt.DockWidgetArea.LeftDockWidgetArea, self.hierarchy_dock)
        self.addDockWidget(Qt.DockWidgetArea.RightDockWidgetArea, self.property_dock)
        self.addDockWidget(Qt.DockWidgetArea.BottomDockWidgetArea, self.message_dock)

        # 3. Ensure all panels are visible and not floating
        for dock in [self.hierarchy_dock, self.property_dock, self.message_dock]:
            dock.setFloating(False)
            dock.show()

        # 4. Apply default sizes
        self._set_initial_dock_sizes()

        # 5. Update panel state manager
        self.panel_state_manager.capture_state()

    def _set_initial_dock_sizes(self):
        """Set default panel sizes"""
        # Wait for layout to settle
        QApplication.processEvents()

        width = self.width()
        height = self.height()

        # Hierarchy panel: 15% of width
        self.resizeDocks(
            [self.hierarchy_dock],
            [int(width * 0.15)],
            Qt.Orientation.Horizontal
        )

        # Property panel: 25% of width
        self.resizeDocks(
            [self.property_dock],
            [int(width * 0.25)],
            Qt.Orientation.Horizontal
        )

        # Message panel: 20% of height
        self.resizeDocks(
            [self.message_dock],
            [int(height * 0.20)],
            Qt.Orientation.Vertical
        )
```

### 2.3 Confirmation Dialog Design

**Dialog Properties**:
- Title: "Reset Panel Layout"
- Icon: Question icon
- Buttons: Yes, No (No is default)
- Parent: Main window (modal)

**Message Text**:
```
This will reset all panels to their default positions and sizes.
Any custom layout will be lost.

Continue?
```

**Rationale**:
- Destructive action requires confirmation
- Clear explanation of consequences
- Default to safe option (No)
- Modal dialog prevents accidental clicks elsewhere

### 2.4 Edge Cases and Error Handling

```python
def reset_panel_layout(self):
    """Reset panel layout with error handling"""

    # Confirmation dialog
    result = QMessageBox.question(...)
    if result != QMessageBox.StandardButton.Yes:
        return

    try:
        # Clear settings
        self.panel_settings_store.clear_panel_state()

        # Apply default layout
        self._apply_default_panel_layout()

        # Show success feedback
        self.statusBar().showMessage("Panel layout reset to default", 3000)

    except Exception as e:
        # Handle errors gracefully
        QMessageBox.warning(
            self,
            "Reset Failed",
            f"Failed to reset panel layout: {str(e)}\n\n"
            "Please restart the application.",
            QMessageBox.StandardButton.Ok
        )
        logging.exception("Failed to reset panel layout")
```

### 2.5 Integration with View Menu

**Menu Action** (from E06-F05-T03):
```python
def _create_view_menu(self):
    """Create View menu with panel controls"""
    view_menu = self.menuBar().addMenu("&View")
    panels_menu = view_menu.addMenu("&Panels")

    # ... panel toggle actions ...

    panels_menu.addSeparator()

    # Reset layout action
    reset_layout_action = QAction("&Reset Panel Layout", self)
    reset_layout_action.setShortcut("Ctrl+Shift+R")
    reset_layout_action.setToolTip("Restore panels to default layout")
    reset_layout_action.setStatusTip(
        "Reset all panels to default positions and sizes (Ctrl+Shift+R)"
    )
    reset_layout_action.triggered.connect(self.reset_panel_layout)
    panels_menu.addAction(reset_layout_action)
```

---

## 3. Dependencies

### 3.1 Upstream
- E06-F05-T01 (Panel State Management) - Uses `capture_state()`
- E06-F05-T02 (Panel Layout Persistence) - Uses `clear_panel_state()`
- E06-F05-T03 (Panel Toggle Actions) - Reset action in View menu

### 3.2 Downstream
- None (leaf task)

### 3.3 External Dependencies
- PySide6 QMessageBox for confirmation dialog
- PySide6 QApplication.processEvents() for layout settling

---

## 4. Acceptance Criteria

### 4.1 Functional Requirements
- [ ] "Reset Panel Layout" action in View > Panels menu
- [ ] Keyboard shortcut `Ctrl+Shift+R` triggers reset
- [ ] Confirmation dialog appears before reset
- [ ] Clicking "No" in dialog cancels reset (no changes)
- [ ] Clicking "Yes" clears saved panel state
- [ ] After reset, all panels in default positions
- [ ] After reset, all panels visible (not hidden)
- [ ] After reset, all panels docked (not floating)
- [ ] After reset, panels at default sizes
- [ ] After reset, no panels tabbed together

### 4.2 Dialog Behavior
- [ ] Dialog is modal (blocks interaction with main window)
- [ ] Dialog has question icon
- [ ] Default button is "No" (safe default)
- [ ] Pressing Enter selects "No" (safe default)
- [ ] Dialog text clearly explains consequences
- [ ] Escape key closes dialog without resetting

### 4.3 Error Handling
- [ ] Reset errors show warning dialog with error message
- [ ] Failed reset doesn't leave panels in broken state
- [ ] Error logged to application log
- [ ] User instructed to restart app on failure

### 4.4 Visual Feedback
- [ ] Status bar message confirms successful reset
- [ ] Message displayed for 3 seconds
- [ ] Panel animations smooth (if Qt provides them)
- [ ] No visual glitches during reset

### 4.5 Testing
- [ ] Unit test for `_apply_default_panel_layout()` logic
- [ ] Mock test for confirmation dialog response
- [ ] Integration test: customize layout, reset, verify default
- [ ] Test cancellation (click No, verify no changes)
- [ ] Test keyboard shortcut triggers reset
- [ ] Test reset multiple times in succession
- [ ] 85%+ code coverage on reset functionality

---

## 5. Implementation Notes

### 5.1 Design Decisions

**Why require confirmation?**
- Destructive action (loses user's custom layout)
- No undo mechanism (in MVP)
- Prevents accidental resets from misclicks
- Standard pattern for destructive actions

**Why remove and re-add dock widgets?**
- Ensures clean slate (clears Qt's internal state)
- Simpler than programmatically moving all panels
- Guaranteed to work regardless of current layout complexity
- Matches Qt's recommended approach for layout reset

**Why use processEvents() before resizing?**
- Qt layout system is asynchronous
- Ensures geometry calculations are accurate
- Prevents race conditions with size calculations
- Common Qt pattern for layout-dependent operations

**Why default to "No" button?**
- Follows principle of least surprise
- User must consciously choose destructive action
- Prevents Enter-key accidents
- Standard UX pattern (Windows, macOS, Linux)

### 5.2 Alternative Approaches Considered

**Programmatic Panel Movement**:
- Move panels individually to target areas
- More complex, error-prone
- May not clear all state (tabs, splitters)
- Remove/re-add is cleaner

**No Confirmation Dialog**:
- Faster for user
- But destructive without undo
- Confirmation is worth the extra click

**Undo/Redo for Layout Changes**:
- Would be ideal
- Too complex for MVP
- Deferred to P1 features

### 5.3 Testing Strategy

**Unit Tests** (`tests/unit/presentation/test_panel_reset.py`):
- Mock dock widgets and test reset logic
- Test confirmation dialog handling
- Verify settings cleared

**Integration Tests** (`tests/integration/presentation/test_panel_reset_integration.py`):
- Create real main window with panels
- Customize layout (move, resize, hide panels)
- Trigger reset
- Verify all panels returned to defaults
- Verify saved settings cleared

**Manual Testing Checklist**:
1. Hide all panels, reset, verify all visible
2. Float all panels, reset, verify all docked
3. Tab panels together, reset, verify separate
4. Resize panels, reset, verify default sizes
5. Move panels to wrong areas, reset, verify correct areas
6. Cancel reset dialog, verify no changes
7. Test keyboard shortcut

---

## Revision History
| Date | Version | Author | Changes |
|------|---------|--------|---------|
| 2025-12-26 | 0.1 | Claude | Initial task creation from E06-F05 split |
