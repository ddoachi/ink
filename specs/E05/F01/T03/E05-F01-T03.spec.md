---
id: E05-F01-T03
title: Results List Widget
type: Task
priority: P0 (MVP)
status: Draft
parent: E05-F01
created: 2025-12-26
estimated_hours: 5
actual_hours:
effort: Medium
tags:
  - ui
  - results
  - presentation-layer
clickup_task_id: '86evzm2zb'
---

# Spec: E05-F01-T03 - Results List Widget

## 1. Overview

### 1.1 Problem Statement
Users need to view and interact with search results in a visually clear list format. Each result should display the object name, type, and optional context information. Clicking a result should emit a signal for navigation to that object.

### 1.2 Goals
- Add `QListWidget` to display search results
- Format each result item with object name, type icon, and context
- Support single-click selection with `result_selected` signal emission
- Display empty state when no results
- Support keyboard navigation (Up/Down arrows)
- Limit results to prevent UI slowdown (e.g., max 100 results)

---

## 2. Technical Requirements

### 2.1 Results List Integration

**Location**: `/home/joohan/dev/project-ink/ink/src/ink/presentation/panels/search_panel.py`

```python
from PySide6.QtWidgets import QListWidget, QListWidgetItem
from PySide6.QtCore import Qt
from PySide6.QtGui import QIcon


class SearchResultItem:
    """Data class for search result items."""

    def __init__(self, object_id: str, object_name: str, object_type: str, context: str = ""):
        self.object_id = object_id
        self.object_name = object_name
        self.object_type = object_type
        self.context = context

    def display_text(self) -> str:
        """Format display text for list widget."""
        text = f"{self.object_name} ({self.object_type})"
        if self.context:
            text += f" - {self.context}"
        return text


class SearchPanel(QWidget):
    """Search panel widget for object search and navigation."""

    MAX_RESULTS = 100  # Limit results for performance

    def _init_ui(self):
        """Initialize UI components."""
        layout = QVBoxLayout(self)

        # ... existing search input row ...
        # ... existing filter buttons row ...

        # Results list
        self.results_list = QListWidget()
        self.results_list.setAlternatingRowColors(True)
        self.results_list.setSelectionMode(QListWidget.SelectionMode.SingleSelection)
        layout.addWidget(self.results_list)

        # ... existing status label ...

    def _connect_signals(self):
        """Connect internal signals."""
        # ... existing connections ...
        self.results_list.itemClicked.connect(self._on_result_clicked)
        self.results_list.itemActivated.connect(self._on_result_activated)

    def _on_result_clicked(self, item: QListWidgetItem):
        """Handle result item single-click."""
        object_id = item.data(Qt.UserRole)
        if object_id:
            self.result_selected.emit(object_id)

    def _on_result_activated(self, item: QListWidgetItem):
        """Handle result item double-click or Enter key."""
        object_id = item.data(Qt.UserRole)
        if object_id:
            self.result_selected.emit(object_id)

    def populate_results(self, results: list[SearchResultItem]):
        """Populate results list with search results."""
        self.results_list.clear()

        # Limit results to prevent UI slowdown
        display_results = results[:self.MAX_RESULTS]
        truncated = len(results) > self.MAX_RESULTS

        for result in display_results:
            item = QListWidgetItem(result.display_text())
            item.setData(Qt.UserRole, result.object_id)

            # Set icon based on object type
            icon = self._get_type_icon(result.object_type)
            if icon:
                item.setIcon(icon)

            self.results_list.addItem(item)

        # Update status
        total_count = len(results)
        if truncated:
            self.status_label.setText(
                f"{total_count} results found (showing first {self.MAX_RESULTS})"
            )
        else:
            self.set_status(total_count)

    def clear_results(self):
        """Clear all results from list."""
        self.results_list.clear()
        self.set_status(0)

    def _get_type_icon(self, object_type: str) -> QIcon | None:
        """Get icon for object type."""
        # Icon mapping (to be implemented with actual icons)
        icon_map = {
            "Cell": "icons/cell.png",
            "Pin": "icons/pin.png",
            "Net": "icons/net.png",
            "Port": "icons/port.png",
        }

        icon_path = icon_map.get(object_type)
        if icon_path:
            # For MVP, return None or use standard icons
            # TODO: Load actual icons from resources
            return None
        return None

    def select_first_result(self):
        """Select and navigate to first result."""
        if self.results_list.count() > 0:
            first_item = self.results_list.item(0)
            self.results_list.setCurrentItem(first_item)
            self._on_result_activated(first_item)
```

### 2.2 Result Item Data Structure

```python
# Example usage in search integration:
results = [
    SearchResultItem(
        object_id="cell_123",
        object_name="clk_buffer_1",
        object_type="Cell",
        context="Module: top.cpu.clk_gen"
    ),
    SearchResultItem(
        object_id="net_456",
        object_name="net_clk",
        object_type="Net",
        context="Fanout: 25 pins"
    ),
]

search_panel.populate_results(results)
```

---

## 3. Dependencies

- **Upstream**:
  - E05-F01-T01 (SearchPanel Widget) - must be completed first
  - E05-F02 (Search Engine) - provides search results data
- **Downstream**:
  - E05-F04 (Navigation) - receives `result_selected` signal
  - E05-F01-T02 (Type Filter) - results filtered before display

---

## 4. Acceptance Criteria

- [ ] `QListWidget` added to search panel below filter buttons
- [ ] Results list displays object name, type, and optional context
- [ ] Each result item stores `object_id` in `Qt.UserRole` data
- [ ] Single-click on result emits `result_selected` signal with object_id
- [ ] Double-click or Enter key emits `result_selected` signal
- [ ] `populate_results()` method populates list with `SearchResultItem` objects
- [ ] Results list limited to 100 items with truncation message
- [ ] `clear_results()` method clears list and resets status
- [ ] `select_first_result()` navigates to first result
- [ ] Alternating row colors enabled for readability
- [ ] Keyboard Up/Down navigation works (native `QListWidget` behavior)
- [ ] Empty state shows "No results" status

---

## 5. Testing Requirements

### 5.1 Unit Tests

**Location**: `/home/joohan/dev/project-ink/ink/tests/ui/panels/test_search_panel.py`

```python
from ink.presentation.panels.search_panel import SearchResultItem


def test_result_item_display_text():
    """Test SearchResultItem display text formatting."""
    item = SearchResultItem("cell_1", "clk_buf", "Cell", "top.cpu")
    assert item.display_text() == "clk_buf (Cell) - top.cpu"

    item_no_context = SearchResultItem("net_1", "clk", "Net")
    assert item_no_context.display_text() == "clk (Net)"


def test_populate_results(search_panel):
    """Test populate_results populates list widget."""
    results = [
        SearchResultItem("cell_1", "buf1", "Cell"),
        SearchResultItem("net_1", "clk", "Net"),
    ]

    search_panel.populate_results(results)

    assert search_panel.results_list.count() == 2
    assert search_panel.status_label.text() == "2 results found"


def test_populate_results_truncation(search_panel):
    """Test results truncated at MAX_RESULTS."""
    results = [
        SearchResultItem(f"obj_{i}", f"name_{i}", "Cell")
        for i in range(150)
    ]

    search_panel.populate_results(results)

    assert search_panel.results_list.count() == 100
    assert "150 results found" in search_panel.status_label.text()
    assert "showing first 100" in search_panel.status_label.text()


def test_clear_results(search_panel):
    """Test clear_results clears list and status."""
    results = [SearchResultItem("cell_1", "buf1", "Cell")]
    search_panel.populate_results(results)

    search_panel.clear_results()

    assert search_panel.results_list.count() == 0
    assert search_panel.status_label.text() == "No results"


def test_result_selected_signal(search_panel, qtbot):
    """Test result_selected signal emits on click."""
    results = [SearchResultItem("cell_123", "buf1", "Cell")]
    search_panel.populate_results(results)

    with qtbot.waitSignal(search_panel.result_selected, timeout=1000) as blocker:
        item = search_panel.results_list.item(0)
        search_panel.results_list.itemClicked.emit(item)

    assert blocker.args[0] == "cell_123"


def test_select_first_result(search_panel, qtbot):
    """Test select_first_result navigates to first item."""
    results = [
        SearchResultItem("cell_1", "buf1", "Cell"),
        SearchResultItem("cell_2", "buf2", "Cell"),
    ]
    search_panel.populate_results(results)

    with qtbot.waitSignal(search_panel.result_selected, timeout=1000) as blocker:
        search_panel.select_first_result()

    assert blocker.args[0] == "cell_1"


def test_empty_results(search_panel):
    """Test empty results list shows correct status."""
    search_panel.populate_results([])

    assert search_panel.results_list.count() == 0
    assert search_panel.status_label.text() == "No results"
```

---

## 6. Implementation Notes

### 6.1 Design Decisions

1. **Result Limit**: Max 100 results prevents UI slowdown on large result sets
2. **Data Storage**: Use `Qt.UserRole` to store `object_id` for signal emission
3. **Icon Placeholder**: Icon support added but not implemented for MVP (return `None`)
4. **Context Information**: Optional context field for additional result details
5. **Activation**: Both single-click and double-click/Enter emit signal (UX flexibility)

### 6.2 UI Layout

```
┌─ Search Panel ─────────────────────────────────┐
│  Search: [___________] [History ▼]             │
│  Filters: (•All) ( Cells ) ( Pins ) ( Nets )  │
│  ┌─────────────────────────────────────────┐   │
│  │ Results (25 found)                      │   │ ← NEW WIDGET
│  │ • clk_buffer_1 (Cell)                   │   │
│  │ • clk_buffer_2 (Cell)                   │   │
│  │ • net_clk (Net) - Fanout: 25           │   │
│  │ • ...                                   │   │
│  └─────────────────────────────────────────┘   │
└────────────────────────────────────────────────┘
```

### 6.3 Future Enhancements

- Add actual type icons from resource system
- Add result preview on hover
- Add context menu for result actions (Copy ID, Expand, etc.)
- Add multi-selection support for batch operations
- Add sorting options (by name, type, relevance)

---

## 7. Related Files

**Modified**:
- `/home/joohan/dev/project-ink/ink/src/ink/presentation/panels/search_panel.py`
- `/home/joohan/dev/project-ink/ink/tests/ui/panels/test_search_panel.py`

---

## Revision History
| Date | Version | Author | Changes |
|------|---------|--------|---------|
| 2025-12-26 | 0.1 | Claude | Initial task creation from E05-F01 split |
