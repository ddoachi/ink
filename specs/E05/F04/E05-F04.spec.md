---
id: E05-F04
title: Navigation
type: Feature
priority: P0 (MVP)
status: Draft
parent: E05
created: 2025-12-26
estimated_hours:
actual_hours:
effort:
tags: []
---

# Spec: E05-F04 - Navigation

## 1. Overview

### 1.1 Problem Statement
After finding an object through search, users need automatic navigation to visualize it in the schematic canvas. This requires expanding hidden objects, selecting them, and adjusting the viewport to center and zoom appropriately.

### 1.2 Goals
- Automatically expand objects that are not currently visible
- Select the target object on the canvas
- Pan the viewport to center on the object
- Zoom to an appropriate level to show the object in context
- Complete navigation in < 200ms for responsive user experience

---

## 2. User Stories

### US-E05-04: Navigate to Result
**As a** circuit designer
**I want to** click a result to navigate there
**So that** I can see the object in context

**Acceptance Criteria:**
- [ ] Click on result selects object
- [ ] View pans and zooms to show object
- [ ] Object is expanded if not already visible
- [ ] Selection highlight visible after navigation

---

## 3. Technical Requirements

### 3.1 Navigator Service

```python
class Navigator:
    """Service for navigating to objects in schematic canvas"""

    def __init__(
        self,
        expansion_service: ExpansionService,
        selection_service: SelectionService,
        canvas: SchematicCanvas
    ):
        self._expansion = expansion_service
        self._selection = selection_service
        self._canvas = canvas

    def navigate_to(self, object_id: str) -> None:
        """
        Navigate to object by ID

        Steps:
        1. Expand object if not visible
        2. Select object
        3. Pan view to center on object
        4. Zoom to appropriate level

        Args:
            object_id: Unique identifier (cell_id, pin_id, net_id, port_id)
        """
```

### 3.2 Navigation Algorithm

```python
def navigate_to(self, object_id: str) -> None:
    # Step 1: Parse object ID to determine type
    obj_type, obj = self._resolve_object(object_id)

    # Step 2: Expand if not visible
    if not self._is_visible(obj):
        self._expand_to_object(obj)

    # Step 3: Select object
    self._selection.select(obj)

    # Step 4: Get object bounding box
    bbox = self._canvas.get_object_bounds(obj)

    # Step 5: Pan to center
    self._canvas.pan_to_center(bbox.center())

    # Step 6: Zoom to fit with context
    self._canvas.zoom_to_fit(bbox, margin=0.2)  # 20% margin around object
```

### 3.3 Expansion for Navigation

```python
def _expand_to_object(self, obj: Union[Cell, Pin, Net, Port]) -> None:
    """
    Expand schematic to reveal object

    Strategy:
    - For cells: Expand parent context to show cell
    - For pins: Expand parent cell and connected nets
    - For nets: Expand connected pins/cells
    - For ports: Expand connected nets
    """

    if isinstance(obj, Cell):
        # Expand 1-hop fanin/fanout to show context
        self._expansion.expand_cell(obj, hops=1)

    elif isinstance(obj, Pin):
        # Expand parent cell
        self._expansion.expand_cell(obj.parent_cell, hops=0)

    elif isinstance(obj, Net):
        # Expand all connected pins
        for pin in obj.connected_pins:
            self._expansion.expand_cell(pin.parent_cell, hops=0)

    elif isinstance(obj, Port):
        # Expand connected net
        if obj.connected_net:
            self._expand_to_object(obj.connected_net)
```

### 3.4 Viewport Control

```python
class SchematicCanvas:
    """Canvas viewport control for navigation"""

    def pan_to_center(self, point: Position) -> None:
        """Pan viewport to center on point"""

    def zoom_to_fit(self, bbox: BoundingBox, margin: float = 0.1) -> None:
        """
        Zoom to fit bounding box with margin

        Args:
            bbox: Object bounding box
            margin: Margin around object (0.0-1.0, default 10%)
        """

    def get_object_bounds(self, obj: Any) -> BoundingBox:
        """Get bounding box for rendered object"""
```

### 3.5 Performance Requirements

| Operation | Target | Notes |
|-----------|--------|-------|
| Navigate to visible object | < 50ms | Select + pan + zoom only |
| Navigate to hidden object | < 200ms | Includes expansion |
| Expansion for navigation | < 150ms | 1-hop expansion |
| Viewport animation | 150ms | Smooth pan/zoom transition |

---

## 4. Dependencies

- **Upstream**:
  - E03 (Expansion - expand objects to make them visible)
  - E04 (Interaction - selection and viewport control)
  - E05-F02 (Search Engine - provides object_id)
- **Downstream**:
  - E05-F01 (Search Panel UI - triggers navigation on result click)

---

## 5. Acceptance Criteria

- [ ] `navigate_to` accepts object_id for cells, pins, nets, ports
- [ ] Hidden objects are expanded before selection
- [ ] Object is selected after navigation
- [ ] Viewport centers on object bounding box center
- [ ] Zoom level shows object with 20% margin
- [ ] Navigation completes in < 200ms for hidden objects
- [ ] Navigation completes in < 50ms for visible objects
- [ ] Smooth viewport animation (pan + zoom transition)
- [ ] Selection highlight visible after navigation
- [ ] Navigation works for all object types (cell, pin, net, port)

---

## 6. Child Specs

| ID | Task | Status | Est. Hours |
|----|------|--------|------------|
| [E05-F04-T01](T01/E05-F04-T01.spec.md) | Navigation Service - Orchestrate navigation workflow | Draft | 6h |
| [E05-F04-T02](T02/E05-F04-T02.spec.md) | Pan to Object - Center viewport on target object | Draft | 4h |
| [E05-F04-T03](T03/E05-F04-T03.spec.md) | Zoom to Fit Object - Zoom to show object at optimal size | Draft | 5h |
| [E05-F04-T04](T04/E05-F04-T04.spec.md) | Auto-Expansion - Expand path to hidden objects | Draft | 6h |

**Total Estimated Hours**: 21h

---

## Revision History
| Date | Version | Author | Changes |
|------|---------|--------|---------|
| 2025-12-26 | 0.1 | Claude | Initial feature creation from E05 split |
