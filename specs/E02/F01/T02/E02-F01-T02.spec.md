---
id: E02-F01-T02
title: Pin Graphics Item
type: Task
priority: P0 (MVP)
status: Completed
parent: E02-F01
created: 2025-12-26
estimated_hours: 6
actual_hours:
effort: Medium
tags:
  - graphics
  - qt
  - presentation-layer
clickup_task_id: '86evzm2hj'
---

# Spec: E02-F01-T02 - Pin Graphics Item

## 1. Overview

### 1.1 Problem Statement

Pins are the connection points on cell symbols where nets attach. They need visual representation with direction indicators (arrows), name labels, and connection points for net routing. The pin graphics must adapt to zoom levels showing different detail levels.

### 1.2 Goals

- Implement `PinItem` as a custom `QGraphicsItem` subclass
- Render pins as small circles/dots on cell edges
- Display pin names as text labels adjacent to pins
- Show direction arrows (input/output/inout)
- Provide connection points for net routing
- Support zoom-based level of detail

---

## 2. Technical Requirements

### 2.1 Class Definition

**Location**: `src/ink/presentation/canvas/pin_item.py`

```python
from PySide6.QtWidgets import QGraphicsItem
from PySide6.QtCore import QPointF, QRectF, Qt
from PySide6.QtGui import QPainter, QPen, QBrush, QColor, QPolygonF
from ink.domain.model.pin import Pin
from ink.domain.value_objects.pin_direction import PinDirection

class PinItem(QGraphicsItem):
    """QGraphicsItem representing a pin on a cell symbol."""

    # Class constants
    PIN_RADIUS = 3.0
    PIN_COLOR = QColor("#333333")
    ARROW_SIZE = 8.0
    LABEL_OFFSET = 5.0

    def __init__(self, pin: Pin, parent_cell_item: QGraphicsItem):
        """
        Initialize pin graphics item.

        Args:
            pin: Domain pin entity
            parent_cell_item: Parent CellItem (for relative positioning)
        """

    def boundingRect(self) -> QRectF:
        """Return bounding rectangle including label and arrow."""

    def paint(self, painter: QPainter, option, widget=None):
        """Render pin with appropriate detail level."""

    def get_connection_point(self) -> QPointF:
        """Return the scene coordinate for net attachment."""

    def set_detail_level(self, level: DetailLevel):
        """Set the level of detail based on zoom."""

    def get_pin(self) -> Pin:
        """Return the associated domain pin entity."""
```

### 2.2 Pin Rendering Specifications

**Pin Body**:
- Small circle: radius 3px
- Color: Dark gray (#333333)
- Positioned on cell edge based on direction

**Direction Indicators**:
- **INPUT**: Arrow pointing INTO cell (→)
- **OUTPUT**: Arrow pointing OUT of cell (←)
- **INOUT**: Bidirectional arrow (↔)
- Arrow size: 8x8 pixels
- Only shown at zoom >75%

**Pin Name Label**:
- Font: Sans-serif, 8pt
- Positioned adjacent to pin (outside cell boundary)
- Color: Black (#000000)
- Only shown at zoom >75%

**Connection Point**:
- Center of pin circle
- Used as anchor point for net routing
- Must be in scene coordinates for router

### 2.3 Detail Levels

```python
class DetailLevel(Enum):
    MINIMAL = 0   # <25% zoom: Nothing shown
    BASIC = 1     # 25-75% zoom: Pin dot only
    FULL = 2      # >75% zoom: Pin dot + name + arrow
```

**Level-Specific Rendering**:
- **MINIMAL**: Pin item hidden or not rendered
- **BASIC**: Circle only, no label, no arrow
- **FULL**: Circle + name label + direction arrow

### 2.4 Position Calculation

Pins are positioned relative to parent cell:
- **INPUT pins**: Left edge of cell
- **OUTPUT pins**: Right edge of cell
- **INOUT pins**: Configurable (default: right edge)

Position determined by `SymbolLayoutCalculator` (T03).

---

## 3. Dependencies

- **Upstream**:
  - E01-F01: `Pin` and `PinDirection` domain entities
  - T01: `CellItem` as parent graphics item
  - T03: `SymbolLayoutCalculator` for pin positions

- **Downstream**:
  - E02-F03: Net routing needs connection points
  - T04: Zoom LOD system controls detail level

---

## 4. Acceptance Criteria

- [x] `PinItem` class implemented in `presentation/canvas/pin_item.py`
- [x] Renders as small circle on cell edge
- [x] Pin name label displayed at FULL detail level
- [x] Direction arrows shown correctly (input/output/inout)
- [x] Connection point calculation returns correct scene coordinates
- [x] Detail level transitions smoothly based on zoom
- [x] Pin indicators (dots) visible at BASIC level
- [x] All pin details hidden at MINIMAL level
- [x] Unit tests verify rendering for each detail level
- [x] Integration test shows pins on cell in scene

---

## 5. Implementation Notes

### 5.1 Example Usage

```python
from ink.domain.model.pin import Pin
from ink.domain.value_objects.pin_direction import PinDirection
from ink.presentation.canvas.pin_item import PinItem

# Create domain pin
pin = Pin(
    id=PinId("U1/A"),
    name="A",
    direction=PinDirection.INPUT,
    cell_id=CellId("U1")
)

# Create graphics item (child of cell item)
pin_item = PinItem(pin, parent_cell_item)
pin_item.setPos(0.0, 20.0)  # Relative to cell
pin_item.set_detail_level(DetailLevel.FULL)

# Get connection point for routing
connection_point = pin_item.get_connection_point()
```

### 5.2 Arrow Drawing

```python
def _draw_input_arrow(self, painter: QPainter, position: QPointF):
    """Draw arrow pointing into cell (left to right)."""
    arrow = QPolygonF([
        position + QPointF(-8, 0),
        position + QPointF(0, -3),
        position + QPointF(0, 3)
    ])
    painter.drawPolygon(arrow)
```

### 5.3 Testing Approach

**Unit Tests**:
- Verify bounding rect for each detail level
- Test connection point calculation
- Verify arrow direction rendering
- Test label positioning

**Integration Tests**:
- Render pins on cell in scene
- Verify detail level transitions
- Test connection point accuracy for routing

---

## Revision History

| Date | Version | Author | Changes |
|------|---------|--------|---------|
| 2025-12-26 | 0.1 | Claude | Initial task creation from E02-F01 split |
