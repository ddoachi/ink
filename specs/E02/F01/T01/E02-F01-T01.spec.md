---
id: E02-F01-T01
title: Cell Graphics Item
type: Task
priority: P0 (MVP)
status: Draft
parent: E02-F01
created: 2025-12-26
estimated_hours: 8
actual_hours:
effort: Medium
tags:
  - graphics
  - qt
  - presentation-layer
clickup_task_id: ''
---

# Spec: E02-F01-T01 - Cell Graphics Item

## 1. Overview

### 1.1 Problem Statement

The schematic viewer needs a custom QGraphicsItem to represent cell symbols (gate-level instances) in the Qt Graphics Scene. This item must handle rendering, bounding box calculations, and provide integration points for selection, highlighting, and event handling.

### 1.2 Goals

- Implement `CellItem` as a custom `QGraphicsItem` subclass
- Render cell body as a rectangular symbol with rounded corners
- Display cell instance name centered within the symbol
- Support visual distinction for sequential cells (latches/FFs)
- Provide efficient bounding rect and paint implementations
- Enable selection and hover interaction states

---

## 2. Technical Requirements

### 2.1 Class Definition

**Location**: `src/ink/presentation/canvas/cell_item.py`

```python
from PySide6.QtWidgets import QGraphicsItem
from PySide6.QtCore import QRectF, Qt
from PySide6.QtGui import QPainter, QPen, QBrush, QColor
from ink.domain.model.cell import Cell

class CellItem(QGraphicsItem):
    """QGraphicsItem representing a cell symbol in the schematic canvas."""

    # Class constants
    DEFAULT_WIDTH = 120.0
    DEFAULT_HEIGHT = 80.0
    CORNER_RADIUS = 5.0
    BORDER_WIDTH = 2.0
    SEQUENTIAL_BORDER_WIDTH = 3.0

    def __init__(self, cell: Cell, parent=None):
        """
        Initialize cell graphics item.

        Args:
            cell: Domain cell entity
            parent: Optional parent QGraphicsItem
        """

    def boundingRect(self) -> QRectF:
        """Return the bounding rectangle for collision and rendering."""

    def paint(self, painter: QPainter, option, widget=None):
        """Render the cell symbol."""

    def set_position(self, x: float, y: float):
        """Set the cell position in scene coordinates."""

    def get_cell(self) -> Cell:
        """Return the associated domain cell entity."""

    # Selection and interaction
    def itemChange(self, change, value):
        """Handle item state changes (selection, position)."""
```

### 2.2 Rendering Specifications

**Cell Body**:
- Rectangular shape with rounded corners (5px radius)
- Default dimensions: 120x80 pixels
- Border: 2px solid for combinational, 3px solid for sequential
- Fill: Light gray (#F0F0F0) default, white for sequential

**Cell Name Label**:
- Centered horizontally and vertically
- Font: Sans-serif, 10pt
- Color: Black (#000000)
- Text should be elided if too long for symbol width

**Visual States**:
- **Normal**: Standard border and fill
- **Selected**: Blue border (#2196F3), slight highlight
- **Hovered**: Border color darkens slightly

**Sequential Cell Distinction**:
- Thicker border (3px vs 2px)
- Different fill pattern or color
- Optional: Small indicator icon (clock symbol)

### 2.3 Performance Requirements

- Use `ItemIsSelectable` flag for selection support
- Implement `shape()` method for accurate selection detection
- Cache rendering when possible using `DeviceCoordinateCache`
- Support batched updates for efficient scene refresh

### 2.4 Integration Points

- Accept `Cell` domain entity in constructor
- Store reference to domain model for property queries
- Emit custom signals for interaction events (if needed)
- Work with parent `SchematicCanvas` for coordinate mapping

---

## 3. Dependencies

- **Upstream**:
  - E01-F01: `Cell` domain entity must exist
  - PySide6 QGraphicsItem framework

- **Downstream**:
  - T02: Pin graphics items will be children of cell items
  - E04: Selection and interaction handlers will use this item

---

## 4. Acceptance Criteria

- [ ] `CellItem` class implemented in `presentation/canvas/cell_item.py`
- [ ] Renders rectangular cell symbol with rounded corners
- [ ] Cell instance name displayed centered within symbol
- [ ] Sequential cells visually distinct (thicker border)
- [ ] Supports selection state with visual feedback
- [ ] Hover state changes border color
- [ ] `boundingRect()` returns correct dimensions
- [ ] `paint()` method efficiently renders cell symbol
- [ ] Unit tests verify rendering states and bounding calculations
- [ ] Integration test shows cell rendering in QGraphicsScene

---

## 5. Implementation Notes

### 5.1 Example Usage

```python
from ink.domain.model.cell import Cell
from ink.presentation.canvas.cell_item import CellItem

# Create domain cell
cell = Cell(
    id=CellId("U1"),
    name="U1",
    cell_type="AND2_X1",
    is_sequential=False
)

# Create graphics item
cell_item = CellItem(cell)
cell_item.set_position(100.0, 200.0)

# Add to scene
scene.addItem(cell_item)
```

### 5.2 Testing Approach

**Unit Tests**:
- Verify bounding rect calculation
- Test state changes (selection, hover)
- Verify sequential vs combinational rendering flags

**Integration Tests**:
- Render cell in QGraphicsScene
- Verify selection interaction
- Test performance with 100+ cells

---

## Revision History

| Date | Version | Author | Changes |
|------|---------|--------|---------|
| 2025-12-26 | 0.1 | Claude | Initial task creation from E02-F01 split |
