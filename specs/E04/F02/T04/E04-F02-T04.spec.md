---
id: E04-F02-T04
title: Multi-Selection Summary
type: Task
priority: P0 (MVP)
status: Draft
parent: E04-F02
created: 2025-12-26
estimated_hours: 3
actual_hours:
effort: Low
tags:
  - ui
  - presentation
  - multi-selection
clickup_task_id: '86evzm2w6'
---

# Spec: E04-F02-T04 - Multi-Selection Summary

## 1. Overview

### 1.1 Problem Statement
When users select multiple objects simultaneously, the PropertyPanel must display an informative summary instead of trying to show individual properties. The summary should indicate the number of objects selected, their types, and provide a list of object names for quick reference.

### 1.2 Goals
- Display count of selected objects prominently
- Show object type if all selections are the same type (e.g., "5 Cells")
- Indicate mixed selection when different types are selected
- List individual object names (limited to prevent UI overflow)
- Provide clear visual distinction from single-selection view
- Support up to 100 selected objects efficiently

---

## 2. Technical Requirements

### 2.1 Multi-Selection UI Layout

**Enhanced PropertyPanel for Multi-Selection**:

```python
# Extension to PropertyPanel class in src/ink/presentation/panels/property_panel.py

class PropertyPanel(QDockWidget):
    # ... existing methods ...

    def show_multi_selection_summary(
        self,
        count: int,
        object_type: Optional[str],
        object_names: List[str]
    ) -> None:
        """
        Display detailed multi-selection summary.

        Args:
            count: Total number of selected objects
            object_type: Type name if all same type, None for mixed
            object_names: List of object names to display
        """
        self._clear_content()

        # Header
        if object_type:
            header_text = f"{count} {object_type}s Selected"
        else:
            header_text = f"{count} Objects Selected (Mixed Types)"

        header_label = QLabel(header_text)
        header_label.setStyleSheet("font-weight: bold; font-size: 11pt;")
        self.content_layout.addWidget(header_label)

        # Summary section
        summary_group = QGroupBox("Selection Summary")
        summary_layout = QVBoxLayout()
        summary_layout.setSpacing(4)

        # Count info
        count_label = QLabel(f"Total: {count} object(s)")
        summary_layout.addWidget(count_label)

        # Type info
        if object_type:
            type_label = QLabel(f"Type: {object_type}")
        else:
            type_label = QLabel("Type: Mixed")
        summary_layout.addWidget(type_label)

        summary_group.setLayout(summary_layout)
        self.content_layout.addWidget(summary_group)

        # Object list section
        if object_names:
            list_group = QGroupBox("Selected Objects")
            list_layout = QVBoxLayout()
            list_layout.setSpacing(2)

            for name in object_names:
                name_label = QLabel(f"â€¢ {name}")
                name_label.setTextInteractionFlags(
                    Qt.TextInteractionFlag.TextSelectableByMouse
                )
                list_layout.addWidget(name_label)

            list_group.setLayout(list_layout)
            self.content_layout.addWidget(list_group)

        # Disable copy button for multi-selection (no individual properties)
        self.copy_button.setEnabled(False)

        # Update panel header
        self.header_label.setText("Property Inspector")

        self.logger.debug(f"Displayed multi-selection summary: {count} objects")
```

### 2.2 Multi-Selection State Variations

**UI Layout Examples**:

**Same Type Selection**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Property Inspector            [ðŸ“‹]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 5 Cells Selected                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Selection Summary                   â”‚
â”‚   Total: 5 object(s)                â”‚
â”‚   Type: Cell                        â”‚
â”‚                                     â”‚
â”‚ Selected Objects                    â”‚
â”‚   â€¢ U_ALU_ADD_1                     â”‚
â”‚   â€¢ U_ALU_ADD_2                     â”‚
â”‚   â€¢ U_ALU_SUB_1                     â”‚
â”‚   â€¢ U_MUX_0                         â”‚
â”‚   â€¢ U_MUX_1                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Mixed Type Selection**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Property Inspector            [ðŸ“‹]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 8 Objects Selected (Mixed Types)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Selection Summary                   â”‚
â”‚   Total: 8 object(s)                â”‚
â”‚   Type: Mixed                       â”‚
â”‚                                     â”‚
â”‚ Selected Objects                    â”‚
â”‚   â€¢ CLK                             â”‚
â”‚   â€¢ DATA_IN                         â”‚
â”‚   â€¢ U_ALU_ADD_1                     â”‚
â”‚   â€¢ U_MUX_0                         â”‚
â”‚   â€¢ Y                               â”‚
â”‚   â€¢ net_001                         â”‚
â”‚   â€¢ net_002                         â”‚
â”‚   â€¢ net_clk                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Large Selection (100+ objects)**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Property Inspector            [ðŸ“‹]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 150 Cells Selected                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Selection Summary                   â”‚
â”‚   Total: 150 object(s)              â”‚
â”‚   Type: Cell                        â”‚
â”‚                                     â”‚
â”‚ Selected Objects (first 20)         â”‚
â”‚   â€¢ U_ALU_ADD_1                     â”‚
â”‚   â€¢ U_ALU_ADD_2                     â”‚
â”‚   ... (18 more) ...                 â”‚
â”‚   â€¢ U_ALU_ADD_20                    â”‚
â”‚   ... and 130 more                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 Enhanced PropertyFormatterService

**Location**: `src/ink/application/services/property_formatter_service.py`

```python
# Extension to PropertyFormatterService class

@dataclass
class MultiSelectionSummary:
    """Summary data for multi-selection display"""
    count: int
    object_type: Optional[str]  # None for mixed types
    object_names: List[str]
    is_truncated: bool  # True if names list was truncated
    total_truncated: int  # Number of names not shown


class PropertyFormatterService:
    # ... existing methods ...

    def format_multi_selection_summary(
        self,
        selected_ids: List[Any],
        max_names: int = 20
    ) -> MultiSelectionSummary:
        """
        Format multi-selection summary.

        Args:
            selected_ids: List of selected object IDs
            max_names: Maximum number of names to include in list

        Returns:
            MultiSelectionSummary with formatted data
        """
        count = len(selected_ids)

        # Determine if all same type
        object_types = set(type(obj_id) for obj_id in selected_ids)

        if len(object_types) == 1:
            # All same type
            type_class = object_types.pop()
            object_type = self._get_type_name(type_class)
        else:
            # Mixed types
            object_type = None

        # Extract object names (sort for consistency)
        object_names = []
        for obj_id in selected_ids:
            # Extract name from ID (assumes ID has .value attribute)
            if hasattr(obj_id, 'value'):
                name = obj_id.value
            else:
                name = str(obj_id)
            object_names.append(name)

        object_names.sort()  # Alphabetical ordering

        # Truncate if needed
        is_truncated = count > max_names
        if is_truncated:
            visible_names = object_names[:max_names]
            visible_names.append(f"... and {count - max_names} more")
            total_truncated = count - max_names
        else:
            visible_names = object_names
            total_truncated = 0

        return MultiSelectionSummary(
            count=count,
            object_type=object_type,
            object_names=visible_names,
            is_truncated=is_truncated,
            total_truncated=total_truncated
        )

    @staticmethod
    def _get_type_name(type_class: type) -> str:
        """
        Get display name for object type class.

        Args:
            type_class: Type class (CellId, PinId, NetId, PortId)

        Returns:
            Display name ("Cell", "Pin", "Net", "Port")
        """
        from ink.domain.value_objects.identifiers import CellId, PinId, NetId, PortId

        type_map = {
            CellId: "Cell",
            PinId: "Pin",
            NetId: "Net",
            PortId: "Port",
        }
        return type_map.get(type_class, "Object")
```

### 2.4 Controller Integration

**Update PropertyPanelController** to use enhanced multi-selection:

```python
# In src/ink/presentation/controllers/property_panel_controller.py

def _handle_multi_selection(self, object_ids: List[Any]) -> None:
    """
    Handle multi-object selection with detailed summary.

    Args:
        object_ids: List of selected object IDs
    """
    try:
        # Format multi-selection summary
        summary = self.property_formatter.format_multi_selection_summary(
            selected_ids=object_ids,
            max_names=20  # Show up to 20 names
        )

        # Update panel with summary
        self.property_panel.show_multi_selection_summary(
            count=summary.count,
            object_type=summary.object_type,
            object_names=summary.object_names
        )

        self.logger.debug(
            f"Multi-selection summary: {summary.count} objects, "
            f"type={summary.object_type}, truncated={summary.is_truncated}"
        )

    except Exception as e:
        self.logger.error(f"Error handling multi-selection: {e}", exc_info=True)
        self.property_panel.show_empty_state()
```

### 2.5 Performance Requirements

- Multi-selection summary generation: < 10ms for 100 objects
- UI rendering of summary: < 30ms
- Alphabetical sorting of names: < 5ms for 100 objects
- Total update time: < 50ms (within feature spec target)

---

## 3. Dependencies

### 3.1 Upstream
- Task E04-F02-T01: PropertyPanel widget structure
- Task E04-F02-T02: PropertyFormatterService base implementation
- Task E04-F02-T03: PropertyPanelController integration

### 3.2 Downstream
- None (enhancement to existing tasks)

### 3.3 External Dependencies
- PySide6 (Qt widgets)
- Python standard library: `typing`, `dataclasses`

---

## 4. Acceptance Criteria

### 4.1 Functional Requirements
- [ ] Multi-selection summary displays total count of selected objects
- [ ] Summary shows object type when all selections are same type
- [ ] Summary indicates "Mixed Types" when different types are selected
- [ ] Object names are listed alphabetically
- [ ] Name list is truncated at 20 items with "... and N more" indicator
- [ ] Object names are selectable for manual copying
- [ ] Copy button is disabled for multi-selection
- [ ] Summary clearly distinguishes from single-selection view

### 4.2 UI/UX Requirements
- [ ] Summary header is bold and prominent (11pt font)
- [ ] Selection Summary section shows count and type
- [ ] Selected Objects section lists individual names
- [ ] Bullet points used for name list items
- [ ] Truncation message is clear when name list is limited
- [ ] Panel scrolls if name list exceeds viewport

### 4.3 Performance Requirements
- [ ] Summary generation completes in < 10ms for 100 objects
- [ ] UI rendering completes in < 30ms
- [ ] Name sorting completes in < 5ms for 100 objects
- [ ] Total update time < 50ms (feature spec target)
- [ ] Memory usage scales linearly with selection size

### 4.4 Testing
- [ ] Unit tests for `format_multi_selection_summary()` with same-type selection
- [ ] Unit tests for `format_multi_selection_summary()` with mixed-type selection
- [ ] Unit tests for name truncation logic (< 20, = 20, > 20 names)
- [ ] Unit tests for alphabetical name sorting
- [ ] Widget test for summary UI layout and rendering
- [ ] Widget test for truncated name list display
- [ ] Performance test with 100 object selection
- [ ] 85%+ code coverage on new multi-selection code

---

## 5. Implementation Notes

### 5.1 Design Decisions

**Why limit name list to 20 items?**
- Prevents UI overflow with large selections
- Provides meaningful context without clutter
- 20 items typically fit on screen without scrolling
- Truncation indicator shows total selection size
- Balance between information and usability

**Why alphabetical sorting of names?**
- Predictable, consistent ordering
- Easy to scan for specific names
- No domain-specific ordering requirement
- Standard convention in multi-selection displays
- Low performance overhead (O(n log n))

**Why disable copy button for multi-selection?**
- No individual properties to copy
- Summary is simple enough to manually select/copy
- Prevents confusion about what would be copied
- Consistent with empty state behavior
- Could be enabled in future to copy name list

**Why show type information?**
- Helps user understand selection composition
- Useful for bulk operations (future feature)
- Distinguishes intentional same-type selection from accidental mixed selection
- Standard pattern in multi-selection UIs

**Why use MultiSelectionSummary dataclass?**
- Type-safe data transfer object
- Clear contract between formatter and UI
- Easy to extend with additional summary data
- Separates data structure from presentation logic

### 5.2 Testing Strategy

**Unit Tests** (`tests/unit/application/services/test_property_formatter_service_multi.py`):
- Test `format_multi_selection_summary()` with various scenarios
- Test name truncation boundary conditions (19, 20, 21 items)
- Test type detection with same and mixed types
- Test alphabetical sorting with various name patterns
- Test performance with 100 object selection

**Example Test**:
```python
def test_format_multi_selection_summary_same_type():
    formatter = PropertyFormatterService()

    # Create 5 CellIds
    selected_ids = [
        CellId("U_MUX_1"),
        CellId("U_ALU_ADD_2"),
        CellId("U_ALU_ADD_1"),
        CellId("U_MUX_0"),
        CellId("U_REG_3"),
    ]

    summary = formatter.format_multi_selection_summary(selected_ids, max_names=20)

    assert summary.count == 5
    assert summary.object_type == "Cell"
    assert summary.is_truncated is False
    assert summary.total_truncated == 0
    # Names should be sorted alphabetically
    assert summary.object_names == [
        "U_ALU_ADD_1",
        "U_ALU_ADD_2",
        "U_MUX_0",
        "U_MUX_1",
        "U_REG_3",
    ]


def test_format_multi_selection_summary_truncated():
    formatter = PropertyFormatterService()

    # Create 25 CellIds
    selected_ids = [CellId(f"U_CELL_{i:03d}") for i in range(25)]

    summary = formatter.format_multi_selection_summary(selected_ids, max_names=20)

    assert summary.count == 25
    assert summary.object_type == "Cell"
    assert summary.is_truncated is True
    assert summary.total_truncated == 5
    assert len(summary.object_names) == 21  # 20 names + truncation message
    assert "... and 5 more" in summary.object_names[-1]
```

**Widget Tests** (`tests/ui/panels/test_property_panel_multi_selection.py`):
- Test `show_multi_selection_summary()` UI rendering
- Test summary layout with same-type selection
- Test summary layout with mixed-type selection
- Test truncated name list display
- Verify copy button is disabled
- Test scrolling with long name list

**Performance Tests**:
- Measure summary generation time with 50, 100, 200 objects
- Measure UI rendering time
- Measure sorting time
- Verify < 50ms total update time

### 5.3 Future Enhancements (Out of Scope)
- Group-by-type display for mixed selections (e.g., "3 Cells, 2 Nets, 1 Pin")
- Configurable max_names limit via user preferences
- Statistics summary (e.g., "5 sequential cells, 3 combinational")
- Copy button to copy name list to clipboard
- Clickable names to navigate to individual objects
- Filter/search within multi-selection
- Common property display if all objects share certain properties

---

## Revision History
| Date | Version | Author | Changes |
|------|---------|--------|---------|
| 2025-12-26 | 0.1 | Claude | Initial task creation from E04-F02 split |
