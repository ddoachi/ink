---
id: E04-F04-T04
title: Shortcut Documentation and Help Dialog
type: Task
priority: P0 (MVP)
status: Draft
parent: E04-F04
created: 2025-12-26
estimated_hours: 4
actual_hours:
effort: Medium
tags:
  - keyboard
  - documentation
  - ui
---

# Spec: E04-F04-T04 - Shortcut Documentation and Help Dialog

## 1. Overview

### 1.1 Problem Statement

Users need to discover and learn available keyboard shortcuts to work efficiently. Without visible documentation in the UI, shortcuts remain hidden and users default to mouse-only workflows. Keyboard shortcuts should be displayed in menus, tooltips, and a dedicated help dialog.

### 1.2 Goals

- Display shortcuts in menu items
- Add shortcut hints to button tooltips
- Create a keyboard shortcuts help dialog (`F1` or `Ctrl+H`)
- Organize shortcuts by category in help dialog
- Ensure all shortcuts are documented and discoverable

---

## 2. Technical Requirements

### 2.1 Menu Integration

**Update**: `src/ink/presentation/main_window.py`

```python
def _create_menus(self) -> None:
    """Create menu bar with shortcuts displayed"""
    menubar = self.menuBar()

    # File menu
    file_menu = menubar.addMenu("&File")

    open_action = QAction("&Open...", self)
    open_action.setShortcut(SHORTCUTS["open"])
    open_action.triggered.connect(self._on_open_file)
    file_menu.addAction(open_action)

    save_action = QAction("&Save Session", self)
    save_action.setShortcut(SHORTCUTS["save_session"])
    save_action.triggered.connect(self._on_save_session)
    file_menu.addAction(save_action)

    file_menu.addSeparator()

    quit_action = QAction("&Quit", self)
    quit_action.setShortcut(SHORTCUTS["quit"])
    quit_action.triggered.connect(self._on_quit)
    file_menu.addAction(quit_action)

    # Edit menu
    edit_menu = menubar.addMenu("&Edit")

    undo_action = QAction("&Undo", self)
    undo_action.setShortcut(SHORTCUTS["undo"])
    undo_action.triggered.connect(self._on_undo)
    edit_menu.addAction(undo_action)

    redo_action = QAction("&Redo", self)
    redo_action.setShortcut(SHORTCUTS["redo"])
    redo_action.triggered.connect(self._on_redo)
    edit_menu.addAction(redo_action)

    edit_menu.addSeparator()

    select_all_action = QAction("Select &All", self)
    select_all_action.setShortcut(SHORTCUTS["select_all"])
    select_all_action.triggered.connect(self._on_select_all)
    edit_menu.addAction(select_all_action)

    copy_action = QAction("&Copy Properties", self)
    copy_action.setShortcut(SHORTCUTS["copy_properties"])
    copy_action.triggered.connect(self._on_copy_properties)
    edit_menu.addAction(copy_action)

    # View menu
    view_menu = menubar.addMenu("&View")

    zoom_in_action = QAction("Zoom &In", self)
    zoom_in_action.setShortcut(SHORTCUTS["zoom_in"][0])  # Show first shortcut
    zoom_in_action.triggered.connect(self._on_zoom_in)
    view_menu.addAction(zoom_in_action)

    zoom_out_action = QAction("Zoom &Out", self)
    zoom_out_action.setShortcut(SHORTCUTS["zoom_out"][0])
    zoom_out_action.triggered.connect(self._on_zoom_out)
    view_menu.addAction(zoom_out_action)

    zoom_100_action = QAction("Reset Zoom", self)
    zoom_100_action.setShortcut(SHORTCUTS["zoom_100"])
    zoom_100_action.triggered.connect(self._on_zoom_100)
    view_menu.addAction(zoom_100_action)

    view_menu.addSeparator()

    fit_selection_action = QAction("Fit &Selection", self)
    fit_selection_action.setShortcut(SHORTCUTS["fit_selection"])
    fit_selection_action.triggered.connect(self._on_fit_selection)
    view_menu.addAction(fit_selection_action)

    fit_all_action = QAction("Fit &All", self)
    fit_all_action.setShortcut(SHORTCUTS["fit_all"])
    fit_all_action.triggered.connect(self._on_fit_all)
    view_menu.addAction(fit_all_action)

    # Search menu
    search_menu = menubar.addMenu("&Search")

    find_action = QAction("&Find...", self)
    find_action.setShortcut(SHORTCUTS["search"])
    find_action.triggered.connect(self._on_search_shortcut)
    search_menu.addAction(find_action)

    # Help menu
    help_menu = menubar.addMenu("&Help")

    shortcuts_action = QAction("&Keyboard Shortcuts", self)
    shortcuts_action.setShortcut(QKeySequence("F1"))
    shortcuts_action.triggered.connect(self._on_show_shortcuts_dialog)
    help_menu.addAction(shortcuts_action)
```

### 2.2 Tooltip Integration

**Example**: Adding tooltips to toolbar buttons

```python
def _create_toolbar(self) -> None:
    """Create toolbar with shortcut hints in tooltips"""
    toolbar = self.addToolBar("Main Toolbar")

    # Expand button
    expand_button = toolbar.addAction("Expand")
    expand_button.setToolTip(
        f"Expand selected cell/pin/net ({self.shortcut_manager.get_shortcut_text('expand_selected')})"
    )
    expand_button.triggered.connect(self._on_expand_selected)

    # Collapse button
    collapse_button = toolbar.addAction("Collapse")
    collapse_button.setToolTip(
        f"Collapse selected cells ({self.shortcut_manager.get_shortcut_text('collapse_selected')})"
    )
    collapse_button.triggered.connect(self._on_collapse_selected)

    # Zoom buttons
    zoom_in_button = toolbar.addAction("Zoom In")
    zoom_in_button.setToolTip(
        f"Zoom in ({self.shortcut_manager.get_shortcut_text('zoom_in')})"
    )
    zoom_in_button.triggered.connect(self._on_zoom_in)

    zoom_out_button = toolbar.addAction("Zoom Out")
    zoom_out_button.setToolTip(
        f"Zoom out ({self.shortcut_manager.get_shortcut_text('zoom_out')})"
    )
    zoom_out_button.triggered.connect(self._on_zoom_out)
```

### 2.3 Keyboard Shortcuts Help Dialog

**Location**: `src/ink/presentation/dialogs/shortcuts_dialog.py`

```python
from PySide6.QtWidgets import (
    QDialog, QVBoxLayout, QTableWidget, QTableWidgetItem,
    QHeaderView, QPushButton, QHBoxLayout, QLabel
)
from PySide6.QtCore import Qt
from ink.presentation.shortcuts.shortcut_config import (
    SHORTCUT_CATEGORIES, SHORTCUT_DESCRIPTIONS
)
from ink.presentation.shortcuts.shortcut_manager import ShortcutManager


class ShortcutsDialog(QDialog):
    """Dialog displaying all keyboard shortcuts organized by category"""

    def __init__(self, shortcut_manager: ShortcutManager, parent=None):
        super().__init__(parent)
        self.shortcut_manager = shortcut_manager
        self.setWindowTitle("Keyboard Shortcuts")
        self.setMinimumSize(600, 500)
        self._setup_ui()

    def _setup_ui(self) -> None:
        """Setup the dialog UI"""
        layout = QVBoxLayout(self)

        # Title
        title_label = QLabel("Keyboard Shortcuts")
        title_label.setStyleSheet("font-size: 14pt; font-weight: bold;")
        layout.addWidget(title_label)

        # Create table for each category
        for category, shortcut_names in SHORTCUT_CATEGORIES.items():
            category_label = QLabel(category)
            category_label.setStyleSheet("font-size: 11pt; font-weight: bold; margin-top: 10px;")
            layout.addWidget(category_label)

            table = self._create_category_table(shortcut_names)
            layout.addWidget(table)

        # Close button
        button_layout = QHBoxLayout()
        button_layout.addStretch()
        close_button = QPushButton("Close")
        close_button.clicked.connect(self.accept)
        button_layout.addWidget(close_button)
        layout.addLayout(button_layout)

    def _create_category_table(self, shortcut_names: list[str]) -> QTableWidget:
        """
        Create a table widget for a category of shortcuts.

        Args:
            shortcut_names: List of shortcut identifiers in this category

        Returns:
            Configured QTableWidget
        """
        table = QTableWidget(len(shortcut_names), 2)
        table.setHorizontalHeaderLabels(["Shortcut", "Description"])
        table.verticalHeader().setVisible(False)
        table.setEditTriggers(QTableWidget.EditTrigger.NoEditTriggers)
        table.setSelectionMode(QTableWidget.SelectionMode.NoSelection)

        # Adjust column widths
        header = table.horizontalHeader()
        header.setSectionResizeMode(0, QHeaderView.ResizeMode.ResizeToContents)
        header.setSectionResizeMode(1, QHeaderView.ResizeMode.Stretch)

        # Populate table
        for row, name in enumerate(shortcut_names):
            # Shortcut key sequence
            shortcut_text = self.shortcut_manager.get_shortcut_text(name)
            shortcut_item = QTableWidgetItem(shortcut_text)
            shortcut_item.setTextAlignment(Qt.AlignmentFlag.AlignLeft | Qt.AlignmentFlag.AlignVCenter)
            table.setItem(row, 0, shortcut_item)

            # Description
            description = SHORTCUT_DESCRIPTIONS.get(name, "")
            desc_item = QTableWidgetItem(description)
            desc_item.setTextAlignment(Qt.AlignmentFlag.AlignLeft | Qt.AlignmentFlag.AlignVCenter)
            table.setItem(row, 1, desc_item)

        # Set row heights
        table.resizeRowsToContents()
        table.setMaximumHeight(table.verticalHeader().length() + table.horizontalHeader().height() + 5)

        return table
```

**Update**: `src/ink/presentation/main_window.py`

```python
from ink.presentation.dialogs.shortcuts_dialog import ShortcutsDialog

def _on_show_shortcuts_dialog(self) -> None:
    """Show keyboard shortcuts help dialog"""
    dialog = ShortcutsDialog(self.shortcut_manager, self)
    dialog.exec()

def _register_shortcuts(self) -> None:
    # Help
    self.shortcut_manager.register_shortcut(
        "show_help",
        QKeySequence("F1"),
        self._on_show_shortcuts_dialog
    )
```

### 2.4 Shortcut Documentation in Code

**Update**: `src/ink/presentation/shortcuts/shortcut_config.py`

Add detailed comments explaining each shortcut:

```python
# Global shortcut configuration
SHORTCUTS: dict[str, ShortcutDef] = {
    # === SEARCH AND NAVIGATION ===
    "search": QKeySequence("Ctrl+F"),  # Open search dialog
    "navigate_forward": QKeySequence("Alt+Right"),  # Navigate forward in history
    "navigate_back": QKeySequence("Alt+Left"),  # Navigate back in history

    # === UNDO/REDO ===
    # Platform-aware: Ctrl+Z on Linux/Windows, Cmd+Z on macOS
    "undo": QKeySequence.StandardKey.Undo,
    # Platform-aware: Ctrl+Shift+Z on Linux/macOS, Ctrl+Y on Windows
    "redo": QKeySequence.StandardKey.Redo,

    # === SELECTION ===
    "select_all": QKeySequence.StandardKey.SelectAll,  # Ctrl+A
    "deselect": QKeySequence(Qt.Key.Key_Escape),  # Clear selection

    # === EXPANSION/COLLAPSE ===
    # Multiple shortcuts for same action - both Delete and Backspace work
    "collapse_selected": [
        QKeySequence.StandardKey.Delete,
        QKeySequence(Qt.Key.Key_Backspace)
    ],
    "expand_selected": QKeySequence(Qt.Key.Key_Return),  # Enter to expand

    # ... (rest of shortcuts)
}
```

---

## 3. Dependencies

- **Upstream**:
  - E04-F04-T01 (Shortcut Manager - provides `get_shortcut_text()`)
  - E04-F04-T02 (Navigation Shortcuts - shortcuts to document)
  - E04-F04-T03 (Action Shortcuts - shortcuts to document)
- **Downstream**:
  - None

---

## 4. Acceptance Criteria

- [ ] All menu items show shortcuts next to action text
- [ ] Toolbar button tooltips include shortcut hints
- [ ] `F1` opens keyboard shortcuts help dialog
- [ ] Help dialog displays all shortcuts organized by category
- [ ] Help dialog categories: Navigation, Editing, Selection, View, File, Copy
- [ ] Help dialog shows human-readable shortcut text
- [ ] Help dialog shows descriptions for each shortcut
- [ ] Multiple shortcuts for same action shown as comma-separated (e.g., "Delete, Backspace")
- [ ] Help menu includes "Keyboard Shortcuts" action
- [ ] Close button dismisses help dialog
- [ ] Help dialog is modal
- [ ] All shortcuts documented in `SHORTCUT_DESCRIPTIONS`
- [ ] Shortcut config file has explanatory comments

---

## 5. Implementation Notes

### 5.1 Design Decisions

- **Menu Shortcuts**: Automatically displayed by Qt when `setShortcut()` is called
- **Tooltip Format**: "Action description (Shortcut)"
- **Help Dialog**: Modal dialog with categorized table layout
- **F1 Convention**: Standard help key for showing shortcuts
- **Table Layout**: Separate table per category for visual organization

### 5.2 Testing Strategy

```python
# tests/unit/presentation/test_shortcuts_dialog.py
def test_shortcuts_dialog_displays_all_categories():
    # Test all categories are shown

def test_shortcuts_dialog_shows_shortcut_text():
    # Test shortcut text is displayed correctly

def test_shortcuts_dialog_shows_descriptions():
    # Test descriptions are displayed

def test_menu_items_have_shortcuts():
    # Test menu items display shortcuts

def test_tooltip_includes_shortcuts():
    # Test tooltips include shortcut hints
```

### 5.3 UI/UX Considerations

- **Discoverability**: Help menu prominently placed
- **Organization**: Shortcuts grouped by functional category
- **Clarity**: Human-readable text (not raw key codes)
- **Consistency**: Same format in menus, tooltips, and help dialog
- **Accessibility**: Dialog can be navigated with keyboard

### 5.4 Future Enhancements

- Searchable shortcuts help dialog
- Printable shortcuts reference (PDF export)
- In-app tutorial highlighting key shortcuts
- Customizable shortcuts with conflict detection (P1)

---

## 6. Testing Checklist

- [ ] Unit test: Help dialog creates tables for all categories
- [ ] Unit test: Shortcut text formatting
- [ ] Unit test: Description lookup
- [ ] Manual test: F1 opens help dialog
- [ ] Manual test: All menu items show shortcuts
- [ ] Manual test: Toolbar tooltips include shortcuts
- [ ] Manual test: Help dialog displays all shortcuts correctly
- [ ] Manual test: Multiple shortcuts shown as comma-separated
- [ ] Manual test: Close button dismisses dialog
- [ ] Manual test: Dialog is keyboard navigable

---

## Revision History

| Date | Version | Author | Changes |
|------|---------|--------|---------|
| 2025-12-26 | 0.1 | Claude | Initial task creation from E04-F04 auto-split |
