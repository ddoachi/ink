# Spec: E04-F04 - Keyboard Shortcuts

## Metadata
- **ID**: E04-F04
- **Type**: Feature
- **Priority**: P0 (MVP)
- **Status**: Draft
- **Parent**: [E04](../E04.spec.md)
- **Created**: 2025-12-26

---

## 1. Overview

### 1.1 Problem Statement

Power users and experienced engineers working with schematic exploration need efficient, keyboard-driven workflows to maximize productivity. Mouse-only interaction creates friction for common operations like search, undo/redo, collapse, zoom, and selection management. Keyboard shortcuts accelerate these repetitive tasks and reduce cognitive load.

### 1.2 Goals

- Provide essential keyboard shortcuts for common operations
- Use platform-standard key bindings where applicable (Qt standard keys)
- Enable keyboard-driven workflows without mouse dependency
- Document shortcuts in UI (menus, tooltips, help dialog)
- Support customization for advanced users (future enhancement)

---

## 2. User Stories

### US-E04-05: Keyboard Shortcuts
**As a** power user
**I want to** use keyboard shortcuts
**So that** I can work efficiently

**Acceptance Criteria:**
- [ ] `Ctrl+F`: Open search dialog
- [ ] `Ctrl+Z`: Undo
- [ ] `Ctrl+Shift+Z`: Redo
- [ ] `Delete`/`Backspace`: Collapse selected
- [ ] `Space`: Fit view to selection
- [ ] `+`/`-` or `Ctrl+=/Ctrl+-`: Zoom in/out
- [ ] `Escape`: Clear selection

---

## 3. Technical Requirements

### 3.1 Shortcut Configuration

```python
from PySide6.QtGui import QKeySequence
from PySide6.QtCore import Qt

SHORTCUTS = {
    # Search and navigation
    "search": QKeySequence("Ctrl+F"),
    "navigate_forward": QKeySequence("Alt+Right"),
    "navigate_back": QKeySequence("Alt+Left"),

    # Undo/Redo
    "undo": QKeySequence.StandardKey.Undo,  # Ctrl+Z (platform-aware)
    "redo": QKeySequence.StandardKey.Redo,  # Ctrl+Shift+Z or Ctrl+Y

    # Selection
    "select_all": QKeySequence.StandardKey.SelectAll,  # Ctrl+A
    "deselect": QKeySequence(Qt.Key.Key_Escape),

    # Expansion/Collapse
    "collapse_selected": [
        QKeySequence.StandardKey.Delete,
        QKeySequence(Qt.Key.Key_Backspace)
    ],
    "expand_selected": QKeySequence(Qt.Key.Key_Return),

    # View controls
    "fit_selection": QKeySequence(Qt.Key.Key_Space),
    "fit_all": QKeySequence("Ctrl+0"),
    "zoom_in": [
        QKeySequence.StandardKey.ZoomIn,    # Ctrl+=
        QKeySequence(Qt.Key.Key_Plus)
    ],
    "zoom_out": [
        QKeySequence.StandardKey.ZoomOut,   # Ctrl+-
        QKeySequence(Qt.Key.Key_Minus)
    ],
    "zoom_100": QKeySequence("Ctrl+1"),

    # Pan (arrow keys)
    "pan_up": QKeySequence(Qt.Key.Key_Up),
    "pan_down": QKeySequence(Qt.Key.Key_Down),
    "pan_left": QKeySequence(Qt.Key.Key_Left),
    "pan_right": QKeySequence(Qt.Key.Key_Right),

    # File operations
    "open": QKeySequence.StandardKey.Open,       # Ctrl+O
    "save_session": QKeySequence.StandardKey.Save,  # Ctrl+S
    "quit": QKeySequence.StandardKey.Quit,       # Ctrl+Q

    # Copy
    "copy_properties": QKeySequence.StandardKey.Copy,  # Ctrl+C
}
```

### 3.2 Shortcut Manager

```python
class ShortcutManager:
    """Centralized keyboard shortcut management"""

    def __init__(self, main_window: QMainWindow):
        self._window = main_window
        self._shortcuts: Dict[str, QShortcut] = {}

    def register_shortcut(
        self,
        name: str,
        key_sequence: Union[QKeySequence, List[QKeySequence]],
        callback: Callable[[], None],
        context: Qt.ShortcutContext = Qt.WindowShortcut
    ):
        """Register a keyboard shortcut"""
        sequences = [key_sequence] if not isinstance(key_sequence, list) else key_sequence

        for seq in sequences:
            shortcut = QShortcut(seq, self._window)
            shortcut.setContext(context)
            shortcut.activated.connect(callback)
            self._shortcuts[f"{name}_{seq.toString()}"] = shortcut

    def enable_shortcut(self, name: str, enabled: bool):
        """Enable or disable a shortcut"""
        if name in self._shortcuts:
            self._shortcuts[name].setEnabled(enabled)

    def get_shortcut_text(self, name: str) -> str:
        """Get human-readable shortcut text for UI display"""
        # For menus, tooltips, help dialog
```

### 3.3 Shortcut Documentation

**In-UI Documentation:**
- Menu items show shortcuts next to action text
- Tooltips include shortcut hints
- Help dialog lists all shortcuts with descriptions
- Welcome screen highlights key shortcuts

**Help Dialog Format:**
```
┌────────────────────────────────────────────────┐
│ Keyboard Shortcuts                        [×] │
├────────────────────────────────────────────────┤
│ Navigation                                     │
│   Ctrl+F          Open search                  │
│   Alt+←/→         Navigate back/forward        │
│                                                │
│ Editing                                        │
│   Ctrl+Z          Undo                         │
│   Ctrl+Shift+Z    Redo                         │
│   Delete          Collapse selected            │
│   Enter           Expand selected              │
│                                                │
│ View                                           │
│   Space           Fit selection                │
│   Ctrl+0          Fit all                      │
│   +/-             Zoom in/out                  │
│   ↑↓←→            Pan view                     │
│   Escape          Clear selection              │
└────────────────────────────────────────────────┘
```

### 3.4 Platform Compatibility

- Use `QKeySequence.StandardKey` for platform-aware shortcuts
- Test on Linux (primary platform)
- Handle key sequence conflicts with window manager
- Support international keyboards (avoid special characters)

### 3.5 Performance Targets

- Shortcut activation latency: < 10ms
- No missed keystrokes during canvas operations
- Shortcuts work in all relevant UI contexts

### 3.6 Integration Points

- **Main Window**: Register all shortcuts at startup
- **Canvas**: Shortcuts for pan, zoom, expand, collapse
- **Search Panel**: Ctrl+F opens and focuses search
- **Property Panel**: Ctrl+C copies properties
- **Undo Stack**: Ctrl+Z/Ctrl+Shift+Z triggers undo/redo

---

## 4. Dependencies

- **Upstream**:
  - E03 (Expansion - collapse selected via Delete/Backspace)
  - E04-F01 (Selection - Escape clears selection)
  - E04-F03 (Undo/Redo - Ctrl+Z/Ctrl+Shift+Z)
  - E05 (Search - Ctrl+F opens search)
- **Downstream**:
  - None (terminal feature)

---

## 5. Acceptance Criteria

- [ ] `Ctrl+F` opens search dialog and focuses search input
- [ ] `Ctrl+Z` triggers undo action
- [ ] `Ctrl+Shift+Z` triggers redo action
- [ ] `Delete` and `Backspace` both collapse selected objects
- [ ] `Enter` expands selected cell/pin/net
- [ ] `Space` fits view to selected objects
- [ ] `Ctrl+0` fits view to all visible objects
- [ ] `+` and `-` zoom in/out
- [ ] `Ctrl+=` and `Ctrl+-` also zoom in/out
- [ ] Arrow keys pan the view
- [ ] `Escape` clears current selection
- [ ] `Ctrl+O` opens file dialog
- [ ] `Ctrl+S` saves current session
- [ ] `Ctrl+C` copies property panel contents to clipboard
- [ ] All shortcuts listed in menu items
- [ ] Help dialog (F1 or Ctrl+H) lists all shortcuts
- [ ] Shortcuts work in relevant contexts (no interference)
- [ ] No conflicts with system/window manager shortcuts

---

## 6. Child Specs
*To be created via `/spec_work E04-F04 --split tasks`*

| ID | Task | Status |
|----|------|--------|

---

## Revision History

| Date | Version | Author | Changes |
|------|---------|--------|---------|
| 2025-12-26 | 0.1 | Claude | Initial feature creation from E04 split |
