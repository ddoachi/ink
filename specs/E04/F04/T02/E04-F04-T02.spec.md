# Spec: E04-F04-T02 - Navigation Shortcuts

## Metadata
- **ID**: E04-F04-T02
- **Type**: Task
- **Priority**: P0 (MVP)
- **Status**: Draft
- **Parent**: [E04-F04](../E04-F04.spec.md)
- **Created**: 2025-12-26
- **Estimated Hours**: 3
- **Actual Hours**:
- **Effort**: Small
- **Tags**: [keyboard, navigation, search]

---

## 1. Overview

### 1.1 Problem Statement

Users need keyboard shortcuts for navigation operations including search, zoom, pan, and view fitting. These are high-frequency operations during schematic exploration, and keyboard access significantly improves workflow efficiency.

### 1.2 Goals

- Implement `Ctrl+F` to open and focus search dialog
- Implement zoom shortcuts (`+`, `-`, `Ctrl+=`, `Ctrl+-`, `Ctrl+0`, `Ctrl+1`)
- Implement pan shortcuts (arrow keys)
- Implement view fit shortcuts (`Space`, `Ctrl+0`)
- Ensure shortcuts are registered via `ShortcutManager`

---

## 2. Technical Requirements

### 2.1 Search Shortcut

**Implementation in**: `src/ink/presentation/main_window.py`

```python
def _register_shortcuts(self) -> None:
    """Register all application shortcuts"""
    # Search
    self.shortcut_manager.register_shortcut(
        "search",
        SHORTCUTS["search"],  # Ctrl+F
        self._on_search_shortcut
    )

def _on_search_shortcut(self) -> None:
    """Handle Ctrl+F shortcut - open and focus search dialog"""
    if not self.search_panel.isVisible():
        self.search_panel.show()
    self.search_panel.focus_search_input()
```

**Update**: `src/ink/presentation/panels/search_panel.py`

```python
def focus_search_input(self) -> None:
    """Set focus to the search input field"""
    self.search_input.setFocus()
    self.search_input.selectAll()  # Select existing text for easy replacement
```

### 2.2 Zoom Shortcuts

**Implementation in**: `src/ink/presentation/main_window.py`

```python
def _register_shortcuts(self) -> None:
    # Zoom controls
    self.shortcut_manager.register_shortcut(
        "zoom_in",
        SHORTCUTS["zoom_in"],  # [Ctrl+=, +]
        self._on_zoom_in
    )

    self.shortcut_manager.register_shortcut(
        "zoom_out",
        SHORTCUTS["zoom_out"],  # [Ctrl+-, -]
        self._on_zoom_out
    )

    self.shortcut_manager.register_shortcut(
        "zoom_100",
        SHORTCUTS["zoom_100"],  # Ctrl+1
        self._on_zoom_100
    )

def _on_zoom_in(self) -> None:
    """Handle zoom in shortcut"""
    self.canvas.zoom_in()

def _on_zoom_out(self) -> None:
    """Handle zoom out shortcut"""
    self.canvas.zoom_out()

def _on_zoom_100(self) -> None:
    """Handle reset zoom to 100%"""
    self.canvas.reset_zoom()
```

**Update**: `src/ink/presentation/canvas/schematic_canvas.py`

```python
def zoom_in(self) -> None:
    """Zoom in by a fixed factor"""
    self.scale(1.2, 1.2)

def zoom_out(self) -> None:
    """Zoom out by a fixed factor"""
    self.scale(1 / 1.2, 1 / 1.2)

def reset_zoom(self) -> None:
    """Reset zoom to 100%"""
    self.resetTransform()
```

### 2.3 Pan Shortcuts

**Implementation in**: `src/ink/presentation/main_window.py`

```python
def _register_shortcuts(self) -> None:
    # Pan controls
    self.shortcut_manager.register_shortcut(
        "pan_up",
        SHORTCUTS["pan_up"],  # Up arrow
        self._on_pan_up
    )

    self.shortcut_manager.register_shortcut(
        "pan_down",
        SHORTCUTS["pan_down"],  # Down arrow
        self._on_pan_down
    )

    self.shortcut_manager.register_shortcut(
        "pan_left",
        SHORTCUTS["pan_left"],  # Left arrow
        self._on_pan_left
    )

    self.shortcut_manager.register_shortcut(
        "pan_right",
        SHORTCUTS["pan_right"],  # Right arrow
        self._on_pan_right
    )

def _on_pan_up(self) -> None:
    """Pan view up"""
    self.canvas.pan(0, -50)  # Negative Y moves view up

def _on_pan_down(self) -> None:
    """Pan view down"""
    self.canvas.pan(0, 50)

def _on_pan_left(self) -> None:
    """Pan view left"""
    self.canvas.pan(-50, 0)

def _on_pan_right(self) -> None:
    """Pan view right"""
    self.canvas.pan(50, 0)
```

**Update**: `src/ink/presentation/canvas/schematic_canvas.py`

```python
def pan(self, dx: int, dy: int) -> None:
    """
    Pan the view by the given deltas.

    Args:
        dx: Horizontal pan in pixels
        dy: Vertical pan in pixels
    """
    h_bar = self.horizontalScrollBar()
    v_bar = self.verticalScrollBar()
    h_bar.setValue(h_bar.value() + dx)
    v_bar.setValue(v_bar.value() + dy)
```

### 2.4 View Fit Shortcuts

**Implementation in**: `src/ink/presentation/main_window.py`

```python
def _register_shortcuts(self) -> None:
    # View fit controls
    self.shortcut_manager.register_shortcut(
        "fit_selection",
        SHORTCUTS["fit_selection"],  # Space
        self._on_fit_selection
    )

    self.shortcut_manager.register_shortcut(
        "fit_all",
        SHORTCUTS["fit_all"],  # Ctrl+0
        self._on_fit_all
    )

def _on_fit_selection(self) -> None:
    """Fit view to selected objects"""
    selected_items = self.canvas.scene().selectedItems()
    if selected_items:
        self.canvas.fit_items(selected_items)

def _on_fit_all(self) -> None:
    """Fit view to all visible objects"""
    self.canvas.fit_all()
```

**Update**: `src/ink/presentation/canvas/schematic_canvas.py`

```python
from PySide6.QtCore import QRectF
from typing import List

def fit_items(self, items: List[QGraphicsItem]) -> None:
    """
    Fit view to the given items with padding.

    Args:
        items: List of graphics items to fit
    """
    if not items:
        return

    # Calculate bounding rect of all items
    bounding_rect = QRectF()
    for item in items:
        bounding_rect = bounding_rect.united(item.sceneBoundingRect())

    # Add 10% padding
    padding = max(bounding_rect.width(), bounding_rect.height()) * 0.1
    bounding_rect.adjust(-padding, -padding, padding, padding)

    self.fitInView(bounding_rect, Qt.AspectRatioMode.KeepAspectRatio)

def fit_all(self) -> None:
    """Fit view to all items in the scene"""
    scene_rect = self.scene().itemsBoundingRect()
    if not scene_rect.isEmpty():
        # Add 10% padding
        padding = max(scene_rect.width(), scene_rect.height()) * 0.1
        scene_rect.adjust(-padding, -padding, padding, padding)
        self.fitInView(scene_rect, Qt.AspectRatioMode.KeepAspectRatio)
```

---

## 3. Dependencies

- **Upstream**:
  - E04-F04-T01 (Shortcut Manager - provides registration framework)
  - E05 (Search - search panel exists)
  - Canvas implementation (zoom, pan, fit methods)
- **Downstream**:
  - None

---

## 4. Acceptance Criteria

- [ ] `Ctrl+F` opens search panel and focuses search input
- [ ] `Ctrl+F` selects existing text in search input
- [ ] `+` and `-` zoom in/out
- [ ] `Ctrl+=` and `Ctrl+-` zoom in/out
- [ ] `Ctrl+1` resets zoom to 100%
- [ ] Up/Down/Left/Right arrow keys pan the view
- [ ] `Space` fits view to selected objects
- [ ] `Ctrl+0` fits view to all visible objects
- [ ] Zoom increments are consistent (1.2x factor)
- [ ] Pan distance is appropriate (50 pixels per key press)
- [ ] View fit includes 10% padding around objects
- [ ] Shortcuts work when canvas has focus
- [ ] Shortcuts work when main window has focus
- [ ] No conflicts with system shortcuts

---

## 5. Implementation Notes

### 5.1 Design Decisions

- **Zoom Factor**: Use 1.2x for consistent zoom steps
- **Pan Distance**: 50 pixels per key press (configurable in future)
- **Fit Padding**: 10% of bounding rect for comfortable view
- **Search Focus**: Select all text for easy replacement
- **Shortcut Context**: Use `WindowShortcut` to work across panels

### 5.2 Testing Strategy

```python
# tests/unit/presentation/test_navigation_shortcuts.py
def test_search_shortcut_opens_panel():
    # Test Ctrl+F opens search panel

def test_search_shortcut_focuses_input():
    # Test Ctrl+F focuses search input

def test_zoom_in_shortcut():
    # Test + and Ctrl+= zoom in

def test_zoom_out_shortcut():
    # Test - and Ctrl+- zoom out

def test_zoom_100_shortcut():
    # Test Ctrl+1 resets zoom

def test_pan_shortcuts():
    # Test arrow keys pan view

def test_fit_selection_shortcut():
    # Test Space fits to selection

def test_fit_all_shortcut():
    # Test Ctrl+0 fits to all items
```

### 5.3 Edge Cases

- Empty selection when pressing `Space`: No action
- No items in scene when pressing `Ctrl+0`: No action
- Search panel already open: Focus input
- Maximum/minimum zoom limits (prevent infinite zoom)

---

## 6. Testing Checklist

- [ ] Unit test: `Ctrl+F` opens search panel
- [ ] Unit test: Zoom in/out shortcuts
- [ ] Unit test: Pan shortcuts
- [ ] Unit test: Fit view shortcuts
- [ ] Manual test: All shortcuts work with canvas focus
- [ ] Manual test: Shortcuts work with main window focus
- [ ] Manual test: Zoom limits prevent infinite zoom
- [ ] Manual test: Pan works in all four directions
- [ ] Manual test: Fit includes appropriate padding

---

## Revision History

| Date | Version | Author | Changes |
|------|---------|--------|---------|
| 2025-12-26 | 0.1 | Claude | Initial task creation from E04-F04 auto-split |
