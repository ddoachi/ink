---
id: E04
title: Object Interaction
type: Epic
priority: P0 (MVP)
status: Draft
parent: PRD
prd_sections: ยง7.1 Selection, ยง7.2 Undo/Redo, ยง7.3 Keyboard Shortcuts
created: 2025-12-26
estimated_hours:
actual_hours:
effort:
tags: []
---

# Spec: E04 - Object Interaction

## 1. Overview

This epic covers how users interact with schematic objects - selecting, inspecting, and manipulating cells, pins, and nets. It also includes the undo/redo system and keyboard shortcuts for power users.

### 1.1 Problem Statement

Engineers need to efficiently navigate and inspect schematic elements. Selection must be intuitive, property inspection immediate, and operations undoable. Keyboard shortcuts accelerate common workflows.

### 1.2 Goals

- Single-click selection with multi-select support
- Property panel showing selected object details
- Full undo/redo for expansion and collapse operations
- Essential keyboard shortcuts for navigation and actions

---

## 2. User Stories

### US-E04-01: Single Selection
**As a** circuit designer
**I want to** click on a cell/pin/net to select it
**So that** I can inspect its properties

**Acceptance Criteria:**
- [ ] Single click selects object
- [ ] Previous selection is cleared
- [ ] Visual highlight indicates selection
- [ ] Property panel updates with object details

### US-E04-02: Multi-Selection
**As a** circuit designer
**I want to** select multiple objects
**So that** I can perform batch operations

**Acceptance Criteria:**
- [ ] Ctrl+click adds to selection
- [ ] Drag rectangle selects enclosed objects
- [ ] Shift+click selects range (if applicable)
- [ ] Selection count displayed in status

### US-E04-03: Property Inspection
**As a** circuit designer
**I want to** see details of selected objects
**So that** I can understand their attributes

**Acceptance Criteria:**
- [ ] Cell properties: name, type, pin count, sequential flag
- [ ] Pin properties: name, direction, connected net
- [ ] Net properties: name, fanout count, connected pins
- [ ] Port properties: name, direction, external connection

### US-E04-04: Undo/Redo
**As a** circuit designer
**I want to** undo and redo my actions
**So that** I can experiment without fear

**Acceptance Criteria:**
- [ ] Ctrl+Z undoes last expansion or collapse
- [ ] Ctrl+Shift+Z redoes last undone action
- [ ] Undo stack depth of at least 50 actions
- [ ] Undo/redo updates view immediately

### US-E04-05: Keyboard Shortcuts
**As a** power user
**I want to** use keyboard shortcuts
**So that** I can work efficiently

**Acceptance Criteria:**
- [ ] `Ctrl+F`: Open search dialog
- [ ] `Ctrl+Z`: Undo
- [ ] `Ctrl+Shift+Z`: Redo
- [ ] `Delete`/`Backspace`: Collapse selected
- [ ] `Space`: Fit view to selection
- [ ] `+`/`-` or `Ctrl+=/Ctrl+-`: Zoom in/out
- [ ] `Escape`: Clear selection

---

## 3. Technical Requirements

### 3.1 Selection Model

```python
class SelectionManager:
    selected_objects: List[SchematicObject]

    def select(self, obj: SchematicObject, mode: SelectMode):
        """Select object with mode: REPLACE, ADD, TOGGLE"""

    def select_rect(self, rect: QRectF):
        """Select all objects within rectangle"""

    def clear(self):
        """Clear all selections"""

    @property
    def selection_changed(self) -> Signal:
        """Emitted when selection changes"""
```

### 3.2 Property Panel Data

```python
@dataclass
class CellProperties:
    name: str
    cell_type: str
    pin_count: int
    is_sequential: bool
    input_pins: List[str]
    output_pins: List[str]

@dataclass
class NetProperties:
    name: str
    driver: Optional[Pin]
    fanout: List[Pin]
    fanout_count: int
```

### 3.3 Undo/Redo Architecture

```python
class UndoStack:
    def push(self, command: UndoableCommand):
        """Push command to undo stack"""

    def undo(self) -> bool:
        """Undo last command, return success"""

    def redo(self) -> bool:
        """Redo last undone command, return success"""

class ExpansionCommand(UndoableCommand):
    """Undoable expansion action"""
    cells_added: Set[str]
    nets_added: Set[str]

    def undo(self):
        """Remove added cells/nets"""

    def redo(self):
        """Re-add cells/nets"""
```

### 3.4 Shortcut Configuration

```python
SHORTCUTS = {
    "search": QKeySequence("Ctrl+F"),
    "undo": QKeySequence.Undo,
    "redo": QKeySequence.Redo,
    "delete": [QKeySequence.Delete, QKeySequence("Backspace")],
    "fit_selection": QKeySequence("Space"),
    "zoom_in": QKeySequence.ZoomIn,
    "zoom_out": QKeySequence.ZoomOut,
    "escape": QKeySequence.Cancel,
}
```

---

## 4. Dependencies

- **Upstream**:
  - E01 (Data Model - object properties)
  - E02 (Rendering - visual selection)
  - E03 (Expansion - undoable actions)
- **Downstream**: E05 (Search - Ctrl+F integration)

---

## 5. Risks & Mitigations

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| Undo stack memory growth | Medium | Medium | Limit stack size, compress old states |
| Multi-select performance | Low | Low | Optimize selection containment tests |
| Shortcut conflicts with OS | Low | Medium | Use standard Qt key sequences |

---

## 6. Acceptance Criteria (Epic Level)

- [ ] Selection visual feedback within 16ms
- [ ] Property panel update within 50ms
- [ ] Undo/redo within 100ms
- [ ] All listed shortcuts functional
- [ ] Undo stack handles 50+ actions

---

## 7. Child Specs

| ID | Feature | Status |
|----|---------|--------|
| [E04-F01](F01/E04-F01.spec.md) | Selection System | Created |
| [E04-F02](F02/E04-F02.spec.md) | Property Panel | Created |
| [E04-F03](F03/E04-F03.spec.md) | Undo/Redo System | Created |
| [E04-F04](F04/E04-F04.spec.md) | Keyboard Shortcuts | Created |

---

## Revision History

| Date | Version | Author | Changes |
|------|---------|--------|---------|
| 2025-12-26 | 0.1 | Claude | Initial epic creation from PRD split |
