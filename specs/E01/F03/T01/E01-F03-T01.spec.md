---
id: E01-F03-T01
title: Domain Model Entities
type: Task
priority: P0 (MVP)
status: Draft
parent: E01-F03
created: 2025-12-26
estimated_hours: 4
actual_hours:
effort: Small
tags:
  - domain-model
  - entities
  - dataclasses
clickup_task_id: '86evzm2fj'
---

# Spec: E01-F03-T01 - Domain Model Entities

## 1. Overview

### 1.1 Problem Statement
The graph construction feature requires core domain model entities to represent the netlist structure. These entities (Cell, Pin, Net, Port) must be immutable, type-safe, and follow DDD principles with no external dependencies.

### 1.2 Goals
- Define domain entities as frozen dataclasses
- Define value objects for identifiers and pin directions
- Implement entities in the domain layer with zero external dependencies
- Provide clear, type-hinted interfaces for all domain models
- Ensure immutability where appropriate for thread safety and clarity

---

## 2. Technical Requirements

### 2.1 File Structure

```
src/ink/domain/
├── model/
│   ├── __init__.py
│   ├── cell.py           # Cell entity
│   ├── pin.py            # Pin entity
│   ├── net.py            # Net entity
│   └── port.py           # Port entity
└── value_objects/
    ├── __init__.py
    ├── identifiers.py    # CellId, NetId, PinId, PortId
    └── pin_direction.py  # PinDirection enum
```

### 2.2 Value Objects

**File**: `src/ink/domain/value_objects/identifiers.py`

```python
from dataclasses import dataclass
from typing import NewType

# Type aliases for strong typing
CellId = NewType('CellId', str)
NetId = NewType('NetId', str)
PinId = NewType('PinId', str)
PortId = NewType('PortId', str)
```

**File**: `src/ink/domain/value_objects/pin_direction.py`

```python
from enum import Enum

class PinDirection(str, Enum):
    """Pin direction for circuit connectivity"""
    INPUT = "INPUT"
    OUTPUT = "OUTPUT"
    INOUT = "INOUT"

    def is_input(self) -> bool:
        return self in (PinDirection.INPUT, PinDirection.INOUT)

    def is_output(self) -> bool:
        return self in (PinDirection.OUTPUT, PinDirection.INOUT)
```

### 2.3 Domain Entities

**File**: `src/ink/domain/model/pin.py`

```python
from dataclasses import dataclass
from typing import Optional
from ..value_objects.identifiers import PinId, NetId
from ..value_objects.pin_direction import PinDirection

@dataclass(frozen=True)
class Pin:
    """Pin entity representing a connection point on a cell"""
    id: PinId
    name: str                    # Pin name (e.g., "A", "Y", "CLK")
    direction: PinDirection      # INPUT, OUTPUT, INOUT
    net_id: Optional[NetId]      # Connected net (None if floating)

    def is_connected(self) -> bool:
        """Check if pin is connected to a net"""
        return self.net_id is not None
```

**File**: `src/ink/domain/model/net.py`

```python
from dataclasses import dataclass, field
from typing import List
from ..value_objects.identifiers import NetId, PinId

@dataclass(frozen=True)
class Net:
    """Net entity representing a wire connecting multiple pins"""
    id: NetId
    name: str                    # Net name
    connected_pin_ids: List[PinId] = field(default_factory=list)

    def is_multi_fanout(self) -> bool:
        """Check if net has multiple driver pins"""
        return len(self.connected_pin_ids) > 1

    def pin_count(self) -> int:
        """Get number of connected pins"""
        return len(self.connected_pin_ids)
```

**File**: `src/ink/domain/model/cell.py`

```python
from dataclasses import dataclass, field
from typing import List
from ..value_objects.identifiers import CellId, PinId

@dataclass(frozen=True)
class Cell:
    """Cell entity representing a gate instance"""
    id: CellId
    name: str                    # Instance name (e.g., "XI1")
    cell_type: str               # Cell type (e.g., "INV_X1", "AND2_X1")
    pin_ids: List[PinId] = field(default_factory=list)
    is_sequential: bool = False  # True for latches/flip-flops

    def is_latch(self) -> bool:
        """Check if cell is a sequential element"""
        return self.is_sequential
```

**File**: `src/ink/domain/model/port.py`

```python
from dataclasses import dataclass
from typing import Optional
from ..value_objects.identifiers import PortId, NetId
from ..value_objects.pin_direction import PinDirection

@dataclass(frozen=True)
class Port:
    """Port entity representing top-level I/O"""
    id: PortId
    name: str                    # Port name
    direction: PinDirection      # INPUT, OUTPUT, INOUT
    net_id: Optional[NetId]      # Connected internal net

    def is_input_port(self) -> bool:
        """Check if port is an input"""
        return self.direction.is_input()

    def is_output_port(self) -> bool:
        """Check if port is an output"""
        return self.direction.is_output()
```

### 2.4 Module Exports

**File**: `src/ink/domain/value_objects/__init__.py`

```python
from .identifiers import CellId, NetId, PinId, PortId
from .pin_direction import PinDirection

__all__ = [
    'CellId',
    'NetId',
    'PinId',
    'PortId',
    'PinDirection',
]
```

**File**: `src/ink/domain/model/__init__.py`

```python
from .cell import Cell
from .pin import Pin
from .net import Net
from .port import Port

__all__ = [
    'Cell',
    'Pin',
    'Net',
    'Port',
]
```

---

## 3. Dependencies

- **Upstream**: None (pure domain layer)
- **Downstream**:
  - E01-F03-T02 (Design Aggregate) - uses these entities
  - E01-F03-T03 (Graph Builder) - maps these to graph nodes

---

## 4. Acceptance Criteria

- [ ] `CellId`, `NetId`, `PinId`, `PortId` type aliases defined
- [ ] `PinDirection` enum with INPUT/OUTPUT/INOUT values
- [ ] `Pin` entity with id, name, direction, net_id fields (frozen dataclass)
- [ ] `Net` entity with id, name, connected_pin_ids fields (frozen dataclass)
- [ ] `Cell` entity with id, name, cell_type, pin_ids, is_sequential fields (frozen dataclass)
- [ ] `Port` entity with id, name, direction, net_id fields (frozen dataclass)
- [ ] All entities are immutable (frozen=True)
- [ ] All entities have type hints for all fields
- [ ] Helper methods: `Pin.is_connected()`, `Net.is_multi_fanout()`, `Cell.is_latch()`, `Port.is_input_port()`
- [ ] No external dependencies in domain layer (pure Python)
- [ ] Module exports configured in `__init__.py` files
- [ ] Unit tests with 95%+ coverage

---

## Revision History

| Date | Version | Author | Changes |
|------|---------|--------|---------|
| 2025-12-26 | 0.1 | Claude | Initial task creation |
