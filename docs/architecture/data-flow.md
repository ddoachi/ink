# Data Flow Diagrams

## 1. Application Startup Flow

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           APPLICATION STARTUP                                    │
│                                                                                  │
│   ┌───────────┐                                                                 │
│   │  main()   │                                                                 │
│   └─────┬─────┘                                                                 │
│         │                                                                        │
│         ▼                                                                        │
│   ┌─────────────────────────────────────────────────────────────────────────┐   │
│   │  1. Initialize Qt Application                                            │   │
│   │     app = QApplication(sys.argv)                                         │   │
│   └─────────────────────────────────────┬───────────────────────────────────┘   │
│                                         │                                        │
│                                         ▼                                        │
│   ┌─────────────────────────────────────────────────────────────────────────┐   │
│   │  2. Create Infrastructure Implementations                                │   │
│   │     ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐    │   │
│   │     │ NetworkXAdapter  │  │ SugiyamaEngine   │  │ OrthogonalRouter │    │   │
│   │     └──────────────────┘  └──────────────────┘  └──────────────────┘    │   │
│   └─────────────────────────────────────┬───────────────────────────────────┘   │
│                                         │                                        │
│                                         ▼                                        │
│   ┌─────────────────────────────────────────────────────────────────────────┐   │
│   │  3. Create Application Services (inject infrastructure)                 │   │
│   │     ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐    │   │
│   │     │ ExpansionService │  │ SelectionService │  │ SearchService    │    │   │
│   │     └──────────────────┘  └──────────────────┘  └──────────────────┘    │   │
│   └─────────────────────────────────────┬───────────────────────────────────┘   │
│                                         │                                        │
│                                         ▼                                        │
│   ┌─────────────────────────────────────────────────────────────────────────┐   │
│   │  4. Create Main Window (inject application services)                    │   │
│   │     ┌──────────────────────────────────────────────────────────────┐    │   │
│   │     │                       MainWindow                              │    │   │
│   │     │  ┌────────────┐  ┌────────────┐  ┌────────────────────────┐  │    │   │
│   │     │  │ MenuBar    │  │ Toolbar    │  │ SchematicCanvas        │  │    │   │
│   │     │  └────────────┘  └────────────┘  └────────────────────────┘  │    │   │
│   │     │  ┌────────────┐  ┌────────────┐  ┌────────────────────────┐  │    │   │
│   │     │  │ Hierarchy  │  │ Properties │  │ SearchPanel            │  │    │   │
│   │     │  └────────────┘  └────────────┘  └────────────────────────┘  │    │   │
│   │     └──────────────────────────────────────────────────────────────┘    │   │
│   └─────────────────────────────────────┬───────────────────────────────────┘   │
│                                         │                                        │
│                                         ▼                                        │
│   ┌─────────────────────────────────────────────────────────────────────────┐   │
│   │  5. Show Window & Start Event Loop                                      │   │
│   │     window.show()                                                        │   │
│   │     app.exec()                                                           │   │
│   └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## 2. File Loading Flow

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              FILE LOADING FLOW                                   │
│                                                                                  │
│  USER                  PRESENTATION          APPLICATION         INFRASTRUCTURE │
│    │                        │                     │                     │        │
│    │  1. Open File Dialog   │                     │                     │        │
│    │───────────────────────►│                     │                     │        │
│    │                        │                     │                     │        │
│    │  2. Select .ckt file   │                     │                     │        │
│    │───────────────────────►│                     │                     │        │
│    │                        │                     │                     │        │
│    │                        │  3. load_design()   │                     │        │
│    │                        │────────────────────►│                     │        │
│    │                        │                     │                     │        │
│    │                        │                     │  4. parse_cdl()     │        │
│    │                        │                     │────────────────────►│        │
│    │                        │                     │                     │        │
│    │                        │                     │  ┌─────────────────┐│        │
│    │                        │                     │  │ CDL Parser      ││        │
│    │                        │                     │  │                 ││        │
│    │                        │                     │  │ • Read file     ││        │
│    │                        │                     │  │ • Parse SUBCKT  ││        │
│    │                        │                     │  │ • Parse X inst  ││        │
│    │                        │                     │  │ • Build cells   ││        │
│    │                        │                     │  └─────────────────┘│        │
│    │                        │                     │                     │        │
│    │                        │                     │◄────────────────────│        │
│    │                        │                     │  cells, nets, ports │        │
│    │                        │                     │                     │        │
│    │                        │                     │  5. parse_pindir()  │        │
│    │                        │                     │────────────────────►│        │
│    │                        │                     │                     │        │
│    │                        │                     │  ┌─────────────────┐│        │
│    │                        │                     │  │ PinDir Parser   ││        │
│    │                        │                     │  │                 ││        │
│    │                        │                     │  │ • Read file     ││        │
│    │                        │                     │  │ • Parse dirs    ││        │
│    │                        │                     │  └─────────────────┘│        │
│    │                        │                     │                     │        │
│    │                        │                     │◄────────────────────│        │
│    │                        │                     │  pin_directions     │        │
│    │                        │                     │                     │        │
│    │                        │                     │  ┌─────────────────┐│        │
│    │                        │                     │  │ 6. BUILD DOMAIN ││        │
│    │                        │                     │  │                 ││        │
│    │                        │                     │  │ Design(         ││        │
│    │                        │                     │  │   cells,        ││        │
│    │                        │                     │  │   nets,         ││        │
│    │                        │                     │  │   ports         ││        │
│    │                        │                     │  │ )               ││        │
│    │                        │                     │  └─────────────────┘│        │
│    │                        │                     │                     │        │
│    │                        │                     │  7. build_graph()   │        │
│    │                        │                     │────────────────────►│        │
│    │                        │                     │                     │        │
│    │                        │                     │  ┌─────────────────┐│        │
│    │                        │                     │  │ NetworkX Build  ││        │
│    │                        │                     │  │                 ││        │
│    │                        │                     │  │ • Add nodes     ││        │
│    │                        │                     │  │ • Add edges     ││        │
│    │                        │                     │  │ • Build index   ││        │
│    │                        │                     │  └─────────────────┘│        │
│    │                        │                     │                     │        │
│    │                        │                     │  8. build_index()   │        │
│    │                        │                     │────────────────────►│        │
│    │                        │                     │                     │        │
│    │                        │                     │  ┌─────────────────┐│        │
│    │                        │                     │  │ Search Index    ││        │
│    │                        │                     │  │                 ││        │
│    │                        │                     │  │ • Trie build    ││        │
│    │                        │                     │  │ • Hash maps     ││        │
│    │                        │                     │  └─────────────────┘│        │
│    │                        │                     │                     │        │
│    │                        │◄────────────────────│                     │        │
│    │                        │  DesignLoaded event │                     │        │
│    │                        │                     │                     │        │
│    │                        │  ┌─────────────────┐│                     │        │
│    │                        │  │ 9. UPDATE UI    ││                     │        │
│    │                        │  │                 ││                     │        │
│    │                        │  │ • Clear canvas  ││                     │        │
│    │                        │  │ • Show ports    ││                     │        │
│    │                        │  │ • Update status ││                     │        │
│    │                        │  └─────────────────┘│                     │        │
│    │                        │                     │                     │        │
│    │◄───────────────────────│                     │                     │        │
│    │  Design loaded message │                     │                     │        │
│    │                        │                     │                     │        │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. Expansion Flow (Core Feature)

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              EXPANSION FLOW                                      │
│                                                                                  │
│  USER              PRESENTATION        APPLICATION           DOMAIN             │
│    │                    │                   │                   │                │
│    │  1. Double-click   │                   │                   │                │
│    │     on cell        │                   │                   │                │
│    │───────────────────►│                   │                   │                │
│    │                    │                   │                   │                │
│    │                    │  ┌─────────────┐  │                   │                │
│    │                    │  │ Identify    │  │                   │                │
│    │                    │  │ clicked pin │  │                   │                │
│    │                    │  └─────────────┘  │                   │                │
│    │                    │                   │                   │                │
│    │                    │  2. expand_fanout(pin, hops=1)        │                │
│    │                    │──────────────────►│                   │                │
│    │                    │                   │                   │                │
│    │                    │                   │  3. get_fanout()  │                │
│    │                    │                   │──────────────────►│                │
│    │                    │                   │                   │                │
│    │                    │                   │  ┌─────────────────────────────┐   │
│    │                    │                   │  │ GRAPH TRAVERSER             │   │
│    │                    │                   │  │                             │   │
│    │                    │                   │  │ BFS from pin:               │   │
│    │                    │                   │  │   pin → net → sink_pins     │   │
│    │                    │                   │  │        → cells              │   │
│    │                    │                   │  │                             │   │
│    │                    │                   │  │ Returns: Set[Cell]          │   │
│    │                    │                   │  └─────────────────────────────┘   │
│    │                    │                   │                   │                │
│    │                    │                   │◄──────────────────│                │
│    │                    │                   │  downstream_cells │                │
│    │                    │                   │                   │                │
│    │                    │                   │  ┌─────────────────────────────┐   │
│    │                    │                   │  │ 4. FILTER VISIBLE           │   │
│    │                    │                   │  │                             │   │
│    │                    │                   │  │ new_cells = cells -         │   │
│    │                    │                   │  │   expansion_state.visible   │   │
│    │                    │                   │  │                             │   │
│    │                    │                   │  └─────────────────────────────┘   │
│    │                    │                   │                   │                │
│    │                    │                   │  5. compute_layout()              │
│    │                    │                   │──────────────────►│                │
│    │                    │                   │                   │                │
│    │                    │                   │  ┌─────────────────────────────┐   │
│    │                    │                   │  │ LAYOUT ENGINE               │   │
│    │                    │                   │  │                             │   │
│    │                    │                   │  │ Sugiyama algorithm:         │   │
│    │                    │                   │  │  1. Layer assignment        │   │
│    │                    │                   │  │  2. Crossing minimization   │   │
│    │                    │                   │  │  3. Coordinate assignment   │   │
│    │                    │                   │  │                             │   │
│    │                    │                   │  │ Returns: Dict[Cell,Position]│   │
│    │                    │                   │  └─────────────────────────────┘   │
│    │                    │                   │                   │                │
│    │                    │                   │◄──────────────────│                │
│    │                    │                   │  layout_result    │                │
│    │                    │                   │                   │                │
│    │                    │                   │  6. route_nets()  │                │
│    │                    │                   │──────────────────►│                │
│    │                    │                   │                   │                │
│    │                    │                   │  ┌─────────────────────────────┐   │
│    │                    │                   │  │ NET ROUTER                  │   │
│    │                    │                   │  │                             │   │
│    │                    │                   │  │ Orthogonal routing:         │   │
│    │                    │                   │  │  • Channel routing          │   │
│    │                    │                   │  │  • Minimize crossings       │   │
│    │                    │                   │  │  • Minimize bends           │   │
│    │                    │                   │  │                             │   │
│    │                    │                   │  │ Returns: List[RouteSegment] │   │
│    │                    │                   │  └─────────────────────────────┘   │
│    │                    │                   │                   │                │
│    │                    │                   │  7. Update ExpansionState         │
│    │                    │                   │  ┌─────────────────────────────┐   │
│    │                    │                   │  │ state.expand(new_cells)     │   │
│    │                    │                   │  │ state.push_undo(command)    │   │
│    │                    │                   │  └─────────────────────────────┘   │
│    │                    │                   │                   │                │
│    │                    │                   │  8. Emit CellsExpanded event      │
│    │                    │                   │──────────────────────────────────►│
│    │                    │                   │                   │                │
│    │                    │◄──────────────────│                   │                │
│    │                    │  new_cells,       │                   │                │
│    │                    │  positions, routes│                   │                │
│    │                    │                   │                   │                │
│    │                    │  ┌─────────────────────────────────┐  │                │
│    │                    │  │ 9. RENDER NEW ELEMENTS          │  │                │
│    │                    │  │                                 │  │                │
│    │                    │  │ for cell in new_cells:          │  │                │
│    │                    │  │   item = CellItem(cell, pos)    │  │                │
│    │                    │  │   scene.addItem(item)           │  │                │
│    │                    │  │                                 │  │                │
│    │                    │  │ for net in new_nets:            │  │                │
│    │                    │  │   item = NetItem(net, routes)   │  │                │
│    │                    │  │   scene.addItem(item)           │  │                │
│    │                    │  │                                 │  │                │
│    │                    │  │ animate_expansion()             │  │                │
│    │                    │  └─────────────────────────────────┘  │                │
│    │                    │                   │                   │                │
│    │◄───────────────────│                   │                   │                │
│    │  Schematic updated │                   │                   │                │
│    │                    │                   │                   │                │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Search Flow

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                               SEARCH FLOW                                        │
│                                                                                  │
│  USER              PRESENTATION        APPLICATION         INFRASTRUCTURE       │
│    │                    │                   │                   │                │
│    │  1. Ctrl+F         │                   │                   │                │
│    │───────────────────►│                   │                   │                │
│    │                    │                   │                   │                │
│    │                    │  ┌─────────────┐  │                   │                │
│    │                    │  │ Open Search │  │                   │                │
│    │                    │  │ Panel       │  │                   │                │
│    │                    │  └─────────────┘  │                   │                │
│    │                    │                   │                   │                │
│    │  2. Type query     │                   │                   │                │
│    │     "*clk*"        │                   │                   │                │
│    │───────────────────►│                   │                   │                │
│    │                    │                   │                   │                │
│    │                    │  3. search(query, filters)            │                │
│    │                    │──────────────────►│                   │                │
│    │                    │                   │                   │                │
│    │                    │                   │  4. parse_pattern() │              │
│    │                    │                   │  ┌─────────────────────────────┐   │
│    │                    │                   │  │ Convert "*clk*" to regex:  │   │
│    │                    │                   │  │ .*clk.*                     │   │
│    │                    │                   │  └─────────────────────────────┘   │
│    │                    │                   │                   │                │
│    │                    │                   │  5. query_index()  │               │
│    │                    │                   │────────────────────►               │
│    │                    │                   │                   │                │
│    │                    │                   │  ┌─────────────────────────────┐   │
│    │                    │                   │  │ SEARCH INDEX                │   │
│    │                    │                   │  │                             │   │
│    │                    │                   │  │ Trie prefix search +        │   │
│    │                    │                   │  │ regex filter                │   │
│    │                    │                   │  │                             │   │
│    │                    │                   │  │ Matches:                    │   │
│    │                    │                   │  │  - clk (port)               │   │
│    │                    │                   │  │  - clk_buf_1 (cell)         │   │
│    │                    │                   │  │  - clk_net (net)            │   │
│    │                    │                   │  └─────────────────────────────┘   │
│    │                    │                   │                   │                │
│    │                    │                   │◄──────────────────│                │
│    │                    │                   │  search_results   │                │
│    │                    │                   │                   │                │
│    │                    │  6. Limit to max_results              │                │
│    │                    │◄──────────────────│                   │                │
│    │                    │  List[SearchResult]                   │                │
│    │                    │                   │                   │                │
│    │                    │  ┌─────────────────────────────────┐  │                │
│    │                    │  │ 7. UPDATE RESULTS LIST          │  │                │
│    │                    │  │                                 │  │                │
│    │                    │  │ results_list.clear()            │  │                │
│    │                    │  │ for result in results:          │  │                │
│    │                    │  │   results_list.addItem(result)  │  │                │
│    │                    │  └─────────────────────────────────┘  │                │
│    │                    │                   │                   │                │
│    │◄───────────────────│                   │                   │                │
│    │  Results displayed │                   │                   │                │
│    │                    │                   │                   │                │
│    │  8. Click result   │                   │                   │                │
│    │───────────────────►│                   │                   │                │
│    │                    │                   │                   │                │
│    │                    │  9. navigate_to(object_id)            │                │
│    │                    │──────────────────►│                   │                │
│    │                    │                   │                   │                │
│    │                    │                   │  ┌─────────────────────────────┐   │
│    │                    │                   │  │ 10. NAVIGATION              │   │
│    │                    │                   │  │                             │   │
│    │                    │                   │  │ if not visible:             │   │
│    │                    │                   │  │   expand_to_show(object)    │   │
│    │                    │                   │  │ select(object)              │   │
│    │                    │                   │  └─────────────────────────────┘   │
│    │                    │                   │                   │                │
│    │                    │◄──────────────────│                   │                │
│    │                    │  object, position │                   │                │
│    │                    │                   │                   │                │
│    │                    │  ┌─────────────────────────────────┐  │                │
│    │                    │  │ 11. PAN & ZOOM                  │  │                │
│    │                    │  │                                 │  │                │
│    │                    │  │ canvas.centerOn(position)       │  │                │
│    │                    │  │ canvas.zoomTo(appropriate_level)│  │                │
│    │                    │  │ canvas.select(object)           │  │                │
│    │                    │  └─────────────────────────────────┘  │                │
│    │                    │                   │                   │                │
│    │◄───────────────────│                   │                   │                │
│    │  View navigated    │                   │                   │                │
│    │                    │                   │                   │                │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## 5. Undo/Redo Flow

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              UNDO/REDO FLOW                                      │
│                                                                                  │
│                                                                                  │
│   ┌─────────────────────────────────────────────────────────────────────────┐   │
│   │                       EXPANSION STATE                                    │   │
│   │                                                                          │   │
│   │   visible_cells: {C1, C2, C3, C4, C5}                                   │   │
│   │   visible_nets:  {N1, N2, N3, N4}                                       │   │
│   │                                                                          │   │
│   │   undo_stack:                        redo_stack:                         │   │
│   │   ┌─────────────────────────┐        ┌─────────────────────────┐        │   │
│   │   │ Cmd3: Expand C4,C5     │        │ (empty)                  │        │   │
│   │   │ Cmd2: Expand C3        │        │                          │        │   │
│   │   │ Cmd1: Expand C1,C2     │        │                          │        │   │
│   │   └─────────────────────────┘        └─────────────────────────┘        │   │
│   └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
│                                                                                  │
│   USER PRESSES Ctrl+Z (UNDO)                                                    │
│   ─────────────────────────────                                                 │
│                                                                                  │
│   ┌─────────────────────────────────────────────────────────────────────────┐   │
│   │  1. Pop from undo_stack                                                  │   │
│   │     cmd = Cmd3 (Expand C4, C5)                                          │   │
│   │                                                                          │   │
│   │  2. Execute inverse                                                      │   │
│   │     visible_cells.remove({C4, C5})                                       │   │
│   │     visible_nets.remove({N4})                                            │   │
│   │                                                                          │   │
│   │  3. Push to redo_stack                                                   │   │
│   │     redo_stack.push(Cmd3)                                                │   │
│   │                                                                          │   │
│   │  4. Emit CellsCollapsed event                                            │   │
│   │     → UI removes C4, C5 from canvas                                      │   │
│   └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
│   AFTER UNDO:                                                                   │
│   ───────────                                                                   │
│                                                                                  │
│   ┌─────────────────────────────────────────────────────────────────────────┐   │
│   │                       EXPANSION STATE                                    │   │
│   │                                                                          │   │
│   │   visible_cells: {C1, C2, C3}                                           │   │
│   │   visible_nets:  {N1, N2, N3}                                           │   │
│   │                                                                          │   │
│   │   undo_stack:                        redo_stack:                         │   │
│   │   ┌─────────────────────────┐        ┌─────────────────────────┐        │   │
│   │   │ Cmd2: Expand C3        │        │ Cmd3: Expand C4,C5     │        │   │
│   │   │ Cmd1: Expand C1,C2     │        │                          │        │   │
│   │   └─────────────────────────┘        └─────────────────────────┘        │   │
│   └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
│                                                                                  │
│   USER PRESSES Ctrl+Shift+Z (REDO)                                              │
│   ────────────────────────────────                                              │
│                                                                                  │
│   ┌─────────────────────────────────────────────────────────────────────────┐   │
│   │  1. Pop from redo_stack                                                  │   │
│   │     cmd = Cmd3 (Expand C4, C5)                                          │   │
│   │                                                                          │   │
│   │  2. Re-execute command                                                   │   │
│   │     visible_cells.add({C4, C5})                                          │   │
│   │     visible_nets.add({N4})                                               │   │
│   │                                                                          │   │
│   │  3. Push back to undo_stack                                              │   │
│   │     undo_stack.push(Cmd3)                                                │   │
│   │                                                                          │   │
│   │  4. Emit CellsExpanded event                                             │   │
│   │     → UI adds C4, C5 back to canvas                                      │   │
│   └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## 6. Event Flow Summary

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              EVENT FLOW                                          │
│                                                                                  │
│                                                                                  │
│   DOMAIN EVENTS                          UI UPDATES                              │
│   ─────────────                          ──────────                              │
│                                                                                  │
│   ┌─────────────────┐                    ┌─────────────────────────────────┐    │
│   │ DesignLoaded    │───────────────────►│ • Clear canvas                  │    │
│   │                 │                    │ • Update status bar             │    │
│   │ cell_count      │                    │ • Enable menu items             │    │
│   │ net_count       │                    │ • Build hierarchy panel         │    │
│   └─────────────────┘                    └─────────────────────────────────┘    │
│                                                                                  │
│   ┌─────────────────┐                    ┌─────────────────────────────────┐    │
│   │ CellsExpanded   │───────────────────►│ • Add cell items to scene       │    │
│   │                 │                    │ • Add net items to scene        │    │
│   │ cells           │                    │ • Animate expansion             │    │
│   │ nets            │                    │ • Update status bar             │    │
│   │ origin          │                    │                                 │    │
│   └─────────────────┘                    └─────────────────────────────────┘    │
│                                                                                  │
│   ┌─────────────────┐                    ┌─────────────────────────────────┐    │
│   │ CellsCollapsed  │───────────────────►│ • Remove cell items from scene  │    │
│   │                 │                    │ • Remove net items from scene   │    │
│   │ cells           │                    │ • Animate collapse              │    │
│   │ nets            │                    │ • Update status bar             │    │
│   └─────────────────┘                    └─────────────────────────────────┘    │
│                                                                                  │
│   ┌─────────────────┐                    ┌─────────────────────────────────┐    │
│   │ SelectionChanged│───────────────────►│ • Highlight selected items      │    │
│   │                 │                    │ • Update property panel         │    │
│   │ selected        │                    │ • Update status bar             │    │
│   │ previously      │                    │                                 │    │
│   └─────────────────┘                    └─────────────────────────────────┘    │
│                                                                                  │
│   ┌─────────────────┐                    ┌─────────────────────────────────┐    │
│   │ LayoutUpdated   │───────────────────►│ • Reposition cell items         │    │
│   │                 │                    │ • Reroute net items             │    │
│   │ positions       │                    │ • Animate transitions           │    │
│   │ routes          │                    │                                 │    │
│   └─────────────────┘                    └─────────────────────────────────┘    │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

*See [Component Specifications](./components.md) for detailed component documentation.*
